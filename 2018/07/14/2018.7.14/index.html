<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>Node.js基础 | ZhangYang&#39;s Blog</title>
  <meta name="keywords" content=" node.js ">
  <meta name="description" content="Node.js基础 | ZhangYang&#39;s Blog">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
<meta name="description" content="懂一点java、算法、数据库、命令行、有两年设计经验的小前端">
<meta property="og:type" content="website">
<meta property="og:title" content="分类">
<meta property="og:url" content="http://yoursite.com/categories/index.html">
<meta property="og:site_name" content="ZhangYang's Blog">
<meta property="og:description" content="懂一点java、算法、数据库、命令行、有两年设计经验的小前端">
<meta property="og:updated_time" content="2017-02-20T02:58:28.000Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="分类">
<meta name="twitter:description" content="懂一点java、算法、数据库、命令行、有两年设计经验的小前端">


<link rel="icon" href="/img/avatar.jpg">

<link href="/css/style.css?v=1.0.1" rel="stylesheet">

<link href="/css/hl_theme/atom-light.css?v=1.0.1" rel="stylesheet">

<link href="//cdn.bootcss.com/animate.css/3.5.2/animate.min.css" rel="stylesheet">
<link href="//cdn.bootcss.com/font-awesome/4.7.0/css/font-awesome.min.css" rel="stylesheet">

<script src="//cdn.bootcss.com/jquery/2.2.4/jquery.min.js"></script>
<script src="/js/jquery.autocomplete.min.js?v=1.0.1" ></script>

<script src="//cdn.bootcss.com/highlight.js/9.12.0/highlight.min.js"></script>
<script>
    hljs.initHighlightingOnLoad();
</script>

<script src="//cdn.bootcss.com/nprogress/0.2.0/nprogress.min.js"></script>



<script src="//cdn.bootcss.com/jquery-cookie/1.4.1/jquery.cookie.min.js" ></script>

<script src="/js/iconfont.js?v=1.0.1" ></script>

</head>
<div style="display: none">
  <input class="theme_disqus_on" value="false">
  <input class="theme_preload_comment" value="false">
  <input class="theme_blog_path" value="">
</div>

<body>
<aside class="nav">
    <div class="nav-left">
        <a href="/" class="avatar_target">
    <img class="avatar" src="/img/avatar.jpg" />
</a>
<div class="author">
    <span>ZhangYang</span>
</div>

<div class="icon">
    
        
        <a title="rss" href="/atom.xml" target="_blank">
            
                <svg class="iconfont-svg" aria-hidden="true">
                    <use xlink:href="#icon-rss"></use>
                </svg>
            
        </a>
        
    
        
        <a title="github" href="https://github.com/yelog" target="_blank">
            
                <svg class="iconfont-svg" aria-hidden="true">
                    <use xlink:href="#icon-github"></use>
                </svg>
            
        </a>
        
    
        
        <a title="facebook" href="https://www.facebook.com/faker.tops" target="_blank">
            
                <svg class="iconfont-svg" aria-hidden="true">
                    <use xlink:href="#icon-facebook"></use>
                </svg>
            
        </a>
        
    
        
    
        
    
        
        <a title="instagram" href="https://www.facebook.com/faker.tops" target="_blank">
            
                <svg class="iconfont-svg" aria-hidden="true">
                    <use xlink:href="#icon-instagram"></use>
                </svg>
            
        </a>
        
    
        
        <a title="reddit" href="https://www.reddit.com/user/yelog/" target="_blank">
            
                <svg class="iconfont-svg" aria-hidden="true">
                    <use xlink:href="#icon-reddit"></use>
                </svg>
            
        </a>
        
    
        
        <a title="weibo" href="http://weibo.com/u/2307534817" target="_blank">
            
                <svg class="iconfont-svg" aria-hidden="true">
                    <use xlink:href="#icon-weibo"></use>
                </svg>
            
        </a>
        
    
        
        <a title="jianshu" href="https://www.jianshu.com/u/ff56736de7cf" target="_blank">
            
                <svg class="iconfont-svg" aria-hidden="true">
                    <use xlink:href="#icon-jianshu"></use>
                </svg>
            
        </a>
        
    
        
        <a title="zhihu" href="https://www.zhihu.com/people/jaytp/activities" target="_blank">
            
                <svg class="iconfont-svg" aria-hidden="true">
                    <use xlink:href="#icon-zhihu"></use>
                </svg>
            
        </a>
        
    
        
    
        
        <a title="oschina" href="https://my.oschina.net/yelog" target="_blank">
            
                <svg class="iconfont-svg" aria-hidden="true">
                    <use xlink:href="#icon-oschina"></use>
                </svg>
            
        </a>
        
    
        
    
        
        <a title="email" href="mailto:jaytp@qq.com" target="_blank">
            
                <svg class="iconfont-svg" aria-hidden="true">
                    <use xlink:href="#icon-email"></use>
                </svg>
            
        </a>
        
    
        
        <a title="qq" href="http://wpa.qq.com/msgrd?v=3&uin=872336115&site=qq&menu=yes" target="_blank">
            
                <svg class="iconfont-svg" aria-hidden="true">
                    <use xlink:href="#icon-qq"></use>
                </svg>
            
        </a>
        
    
        
        <a title="kugou" href="https://www.kugou.com/" target="_blank">
            
                <svg class="iconfont-svg" aria-hidden="true">
                    <use xlink:href="#icon-kugou"></use>
                </svg>
            
        </a>
        
    
        
        <a title="neteasemusic" href="https://music.163.com/#/user/home?id=88151013" target="_blank">
            
                <svg class="iconfont-svg" aria-hidden="true">
                    <use xlink:href="#icon-neteasemusic"></use>
                </svg>
            
        </a>
        
    
</div>




<ul>
    <li><div class="all active">全部文章<small>(87)</small></div></li>
    
        
            
            <li><div data-rel="lifes">lifes<small>(9)</small></div>
                
            </li>
            
        
    
        
            
            <li><div data-rel="JavaScript">JavaScript<small>(41)</small></div>
                
            </li>
            
        
    
        
            
            <li><div data-rel="others">others<small>(7)</small></div>
                
            </li>
            
        
    
        
            
            <li><div data-rel="HTML/CSS">HTML/CSS<small>(14)</small></div>
                
            </li>
            
        
    
        
            
            <li><div data-rel="BackEnd">BackEnd<small>(7)</small></div>
                
            </li>
            
        
    
        
            
            <li><div data-rel="CommandLink">CommandLink<small>(1)</small></div>
                
            </li>
            
        
    
        
            
            <li><div data-rel="Node.js">Node.js<small>(8)</small></div>
                
            </li>
            
        
    
</ul>
<div class="left-bottom">
    <div class="menus">
    
    
    
    
    </div>
    <div><a class="about  hasFriend  site_url"  href="/about">关于</a><a style="width: 50%"  class="friends">友链</a></div>
</div>
<input type="hidden" id="yelog_site_posts_number" value="87">

<div style="display: none">
    <span id="busuanzi_value_site_uv"></span>
    <span id="busuanzi_value_site_pv"></span>
</div>

    </div>
    <div class="nav-right">
        <div class="friends-area">
    <div class="friends-title">
        友情链接
        <i class="back-title-list"></i>
    </div>
    <div class="friends-content">
        <ul>
            
            <li><a target="_blank" href="http://yelog.org/">叶落阁</a></li>
            
        </ul>
    </div>
</div>
        <div class="title-list">
    <form onkeydown="if(event.keyCode==13){return false;}">
        <input class="search" type="text" placeholder="Search..." autocomplete="off"id="local-search-input" >
        <i class="cross"></i>
        <span>
            <label for="tagswitch">Tags:</label>
            <input id="tagswitch" type="checkbox" style="display: none" />
            <i id="tagsWitchIcon"></i>
        </span>
    </form>
    <div class="tags-list">
    
    <li class="article-tag-list-item">
        <a href="javascript:" class="color5">学习方法</a>
    </li>
    
    <li class="article-tag-list-item">
        <a href="javascript:" class="color5">个人总结</a>
    </li>
    
    <li class="article-tag-list-item">
        <a href="javascript:" class="color1">JavaScript</a>
    </li>
    
    <li class="article-tag-list-item">
        <a href="javascript:" class="color5">网页性能</a>
    </li>
    
    <li class="article-tag-list-item">
        <a href="javascript:" class="color4">CSS</a>
    </li>
    
    <li class="article-tag-list-item">
        <a href="javascript:" class="color4">MVC</a>
    </li>
    
    <li class="article-tag-list-item">
        <a href="javascript:" class="color1">Redux</a>
    </li>
    
    <li class="article-tag-list-item">
        <a href="javascript:" class="color4">PHP</a>
    </li>
    
    <li class="article-tag-list-item">
        <a href="javascript:" class="color3">英语</a>
    </li>
    
    <li class="article-tag-list-item">
        <a href="javascript:" class="color1">MySQL</a>
    </li>
    
    <li class="article-tag-list-item">
        <a href="javascript:" class="color3">React Router</a>
    </li>
    
    <li class="article-tag-list-item">
        <a href="javascript:" class="color1">React</a>
    </li>
    
    <li class="article-tag-list-item">
        <a href="javascript:" class="color3">angular</a>
    </li>
    
    <li class="article-tag-list-item">
        <a href="javascript:" class="color5">bootstrap</a>
    </li>
    
    <li class="article-tag-list-item">
        <a href="javascript:" class="color3">算法</a>
    </li>
    
    <li class="article-tag-list-item">
        <a href="javascript:" class="color4">vim</a>
    </li>
    
    <li class="article-tag-list-item">
        <a href="javascript:" class="color1">linux</a>
    </li>
    
    <li class="article-tag-list-item">
        <a href="javascript:" class="color4">git</a>
    </li>
    
    <li class="article-tag-list-item">
        <a href="javascript:" class="color5">HTTP</a>
    </li>
    
    <li class="article-tag-list-item">
        <a href="javascript:" class="color4">ES6</a>
    </li>
    
    <li class="article-tag-list-item">
        <a href="javascript:" class="color5">HTML</a>
    </li>
    
    <li class="article-tag-list-item">
        <a href="javascript:" class="color4">CMD</a>
    </li>
    
    <li class="article-tag-list-item">
        <a href="javascript:" class="color4">AMD</a>
    </li>
    
    <li class="article-tag-list-item">
        <a href="javascript:" class="color5">Common.js</a>
    </li>
    
    <li class="article-tag-list-item">
        <a href="javascript:" class="color1">require.js</a>
    </li>
    
    <li class="article-tag-list-item">
        <a href="javascript:" class="color5">r.js</a>
    </li>
    
    <li class="article-tag-list-item">
        <a href="javascript:" class="color3">node.js</a>
    </li>
    
    <li class="article-tag-list-item">
        <a href="javascript:" class="color5">设计模式</a>
    </li>
    
    <li class="article-tag-list-item">
        <a href="javascript:" class="color4">响应式</a>
    </li>
    
    <li class="article-tag-list-item">
        <a href="javascript:" class="color5">媒体查询</a>
    </li>
    
    <li class="article-tag-list-item">
        <a href="javascript:" class="color5">栅格系统</a>
    </li>
    
    <li class="article-tag-list-item">
        <a href="javascript:" class="color4">Vue</a>
    </li>
    
    <li class="article-tag-list-item">
        <a href="javascript:" class="color5">面向对象</a>
    </li>
    
    <li class="article-tag-list-item">
        <a href="javascript:" class="color4">npm</a>
    </li>
    
    <li class="article-tag-list-item">
        <a href="javascript:" class="color5">npmscript</a>
    </li>
    
    <li class="article-tag-list-item">
        <a href="javascript:" class="color5">gulp</a>
    </li>
    
    <li class="article-tag-list-item">
        <a href="javascript:" class="color3">webpack</a>
    </li>
    
    <li class="article-tag-list-item">
        <a href="javascript:" class="color2">flex布局</a>
    </li>
    
    <li class="article-tag-list-item">
        <a href="javascript:" class="color4">php</a>
    </li>
    
    <li class="article-tag-list-item">
        <a href="javascript:" class="color1">xmapp</a>
    </li>
    
    <li class="article-tag-list-item">
        <a href="javascript:" class="color5">前端职责</a>
    </li>
    
    <li class="article-tag-list-item">
        <a href="javascript:" class="color5">ajax</a>
    </li>
    
    <li class="article-tag-list-item">
        <a href="javascript:" class="color5">json</a>
    </li>
    
    <li class="article-tag-list-item">
        <a href="javascript:" class="color1">jsonp</a>
    </li>
    
    <li class="article-tag-list-item">
        <a href="javascript:" class="color5">Handlerbars.js</a>
    </li>
    
    <li class="article-tag-list-item">
        <a href="javascript:" class="color5">模板引擎</a>
    </li>
    
    <li class="article-tag-list-item">
        <a href="javascript:" class="color4">柯里化</a>
    </li>
    
    <li class="article-tag-list-item">
        <a href="javascript:" class="color3">Express</a>
    </li>
    
    <li class="article-tag-list-item">
        <a href="javascript:" class="color3">Node.js</a>
    </li>
    
    <li class="article-tag-list-item">
        <a href="javascript:" class="color3">Promise</a>
    </li>
    
    <li class="article-tag-list-item">
        <a href="javascript:" class="color3">CacheControl</a>
    </li>
    
    <li class="article-tag-list-item">
        <a href="javascript:" class="color4">MD5</a>
    </li>
    
    <li class="article-tag-list-item">
        <a href="javascript:" class="color2">Cookie</a>
    </li>
    
    <li class="article-tag-list-item">
        <a href="javascript:" class="color3">Session</a>
    </li>
    
    <li class="article-tag-list-item">
        <a href="javascript:" class="color2">Canvas</a>
    </li>
    
    <div class="clearfix"></div>
</div>

    
    <nav id="title-list-nav">
        
        <a  class="others "
           href="/2018/06/12/2018.6.12/"
           data-tag="学习方法"
           data-author="" >
            <span class="post-title" title="最好的学习方法">最好的学习方法</span>
            <span class="post-date" title="2018-06-12 12:40:15">2018/06/12</span>
        </a>
        
        <a  class="lifes "
           href="/2018/06/01/2018.4&5summary/"
           data-tag="个人总结"
           data-author="" >
            <span class="post-title" title="【总结】2018年4&amp;5月份个人总结">【总结】2018年4&amp;5月份个人总结</span>
            <span class="post-date" title="2018-06-01 00:40:15">2018/06/01</span>
        </a>
        
        <a  class="lifes "
           href="/2018/03/11/2017summary/"
           data-tag="个人总结"
           data-author="" >
            <span class="post-title" title="【总结】2017年个人年度总结">【总结】2017年个人年度总结</span>
            <span class="post-date" title="2018-03-11 00:40:15">2018/03/11</span>
        </a>
        
        <a  class="JavaScript "
           href="/2018/06/02/2018.6.2-1/"
           data-tag="JavaScript"
           data-author="" >
            <span class="post-title" title="JavaScript的10个设计缺陷">JavaScript的10个设计缺陷</span>
            <span class="post-date" title="2018-06-02 02:40:15">2018/06/02</span>
        </a>
        
        <a  class="JavaScript "
           href="/2018/06/19/2018.6.19/"
           data-tag="JavaScript"
           data-author="" >
            <span class="post-title" title="ES5数组扩展方法源代码">ES5数组扩展方法源代码</span>
            <span class="post-date" title="2018-06-19 12:40:15">2018/06/19</span>
        </a>
        
        <a  class="others "
           href="/2018/06/21/2018.6.21/"
           data-tag="网页性能"
           data-author="" >
            <span class="post-title" title="网页性能优化">网页性能优化</span>
            <span class="post-date" title="2018-06-21 12:40:15">2018/06/21</span>
        </a>
        
        <a  class="HTML/CSS "
           href="/2018/06/15/2018.6.15/"
           data-tag="CSS"
           data-author="" >
            <span class="post-title" title="CSS动画简介">CSS动画简介</span>
            <span class="post-date" title="2018-06-15 12:40:15">2018/06/15</span>
        </a>
        
        <a  class="JavaScript "
           href="/2018/06/25/2018.6.25/"
           data-tag="JavaScript"
           data-author="" >
            <span class="post-title" title="JavaScript语言精粹">JavaScript语言精粹</span>
            <span class="post-date" title="2018-06-25 12:40:15">2018/06/25</span>
        </a>
        
        <a  class="JavaScript "
           href="/2018/06/04/2018.6.4/"
           data-tag="JavaScript"
           data-author="" >
            <span class="post-title" title="JavaScript实现异步">JavaScript实现异步</span>
            <span class="post-date" title="2018-06-04 13:40:15">2018/06/04</span>
        </a>
        
        <a  class="JavaScript "
           href="/2018/06/07/2018.6.7/"
           data-tag="JavaScript,MVC"
           data-author="" >
            <span class="post-title" title="前端MVC设计模式">前端MVC设计模式</span>
            <span class="post-date" title="2018-06-07 13:40:15">2018/06/07</span>
        </a>
        
        <a  class="JavaScript "
           href="/2018/06/08/2018.6.8/"
           data-tag="JavaScript"
           data-author="" >
            <span class="post-title" title="JavaScript的this值">JavaScript的this值</span>
            <span class="post-date" title="2018-06-08 13:40:15">2018/06/08</span>
        </a>
        
        <a  class="JavaScript "
           href="/2018/06/09/2018.6.9/"
           data-tag="JavaScript"
           data-author="" >
            <span class="post-title" title="JavaScript的new">JavaScript的new</span>
            <span class="post-date" title="2018-06-09 13:40:15">2018/06/09</span>
        </a>
        
        <a  class="JavaScript "
           href="/2018/07/11/2018.7.11/"
           data-tag="Redux"
           data-author="" >
            <span class="post-title" title="Redux">Redux</span>
            <span class="post-date" title="2018-07-11 23:16:41">2018/07/11</span>
        </a>
        
        <a  class="lifes "
           href="/2018/06/28/2018.6summary/"
           data-tag="个人总结"
           data-author="" >
            <span class="post-title" title="【总结】2018年6月份个人总结">【总结】2018年6月份个人总结</span>
            <span class="post-date" title="2018-06-28 00:40:15">2018/06/28</span>
        </a>
        
        <a  class="BackEnd "
           href="/2018/07/18/2018.7.18/"
           data-tag="PHP"
           data-author="" >
            <span class="post-title" title="PHP面向对象">PHP面向对象</span>
            <span class="post-date" title="2018-07-18 23:16:41">2018/07/18</span>
        </a>
        
        <a  class="others "
           href="/2018/07/20/2018.7.20/"
           data-tag="英语"
           data-author="" >
            <span class="post-title" title="英语(一）">英语(一）</span>
            <span class="post-date" title="2018-07-20 23:16:41">2018/07/20</span>
        </a>
        
        <a  class="BackEnd "
           href="/2018/07/23/2018.7.23/"
           data-tag="PHP"
           data-author="" >
            <span class="post-title" title="PHP表单">PHP表单</span>
            <span class="post-date" title="2018-07-23 23:16:41">2018/07/23</span>
        </a>
        
        <a  class="BackEnd "
           href="/2018/07/25/2018.7.25/"
           data-tag="MySQL"
           data-author="" >
            <span class="post-title" title="MySQL数据库">MySQL数据库</span>
            <span class="post-date" title="2018-07-25 23:16:41">2018/07/25</span>
        </a>
        
        <a  class="lifes "
           href="/2018/07/31/2018.7summary/"
           data-tag="个人总结"
           data-author="" >
            <span class="post-title" title="【总结】2018年7月份个人总结">【总结】2018年7月份个人总结</span>
            <span class="post-date" title="2018-07-31 23:40:15">2018/07/31</span>
        </a>
        
        <a  class="JavaScript "
           href="/2018/07/08/2018.7.8/"
           data-tag="React Router"
           data-author="" >
            <span class="post-title" title="React Router">React Router</span>
            <span class="post-date" title="2018-07-08 23:16:41">2018/07/08</span>
        </a>
        
        <a  class="BackEnd "
           href="/2018/07/28/2018.7.28/"
           data-tag="PHP,MySQL"
           data-author="" >
            <span class="post-title" title="PHP数据库">PHP数据库</span>
            <span class="post-date" title="2018-07-28 23:16:41">2018/07/28</span>
        </a>
        
        <a  class="JavaScript "
           href="/2018/07/01/2018.7.1/"
           data-tag="React"
           data-author="" >
            <span class="post-title" title="React">React</span>
            <span class="post-date" title="2018-07-01 23:16:41">2018/07/01</span>
        </a>
        
        <a  class="JavaScript "
           href="/2017/10/04/angular/"
           data-tag="angular"
           data-author="" >
            <span class="post-title" title="Angular">Angular</span>
            <span class="post-date" title="2017-10-04 23:16:41">2017/10/04</span>
        </a>
        
        <a  class="BackEnd "
           href="/2018/07/05/2018.7.5/"
           data-tag="PHP"
           data-author="" >
            <span class="post-title" title="PHP基础">PHP基础</span>
            <span class="post-date" title="2018-07-05 23:16:41">2018/07/05</span>
        </a>
        
        <a  class="HTML/CSS "
           href="/2017/03/30/cs/"
           data-tag="CSS"
           data-author="" >
            <span class="post-title" title="CSS项目">CSS项目</span>
            <span class="post-date" title="2017-03-30 23:16:10">2017/03/30</span>
        </a>
        
        <a  class="JavaScript "
           href="/2017/11/05/bootstrap/"
           data-tag="bootstrap"
           data-author="" >
            <span class="post-title" title="bootstrap">bootstrap</span>
            <span class="post-date" title="2017-11-05 22:16:41">2017/11/05</span>
        </a>
        
        <a  class="others "
           href="/2017/12/05/arithmetic/"
           data-tag="算法"
           data-author="" >
            <span class="post-title" title="算法">算法</span>
            <span class="post-date" title="2017-12-05 22:16:41">2017/12/05</span>
        </a>
        
        <a  class="CommandLink "
           href="/2017/02/25/gitlinuxvim/"
           data-tag="vim,linux,git"
           data-author="" >
            <span class="post-title" title="vim、linux、git命令行">vim、linux、git命令行</span>
            <span class="post-date" title="2017-02-25 01:58:48">2017/02/25</span>
        </a>
        
        <a  class="others "
           href="/2017/06/05/http/"
           data-tag="HTTP"
           data-author="" >
            <span class="post-title" title="HTTP基础">HTTP基础</span>
            <span class="post-date" title="2017-06-05 23:13:10">2017/06/05</span>
        </a>
        
        <a  class="JavaScript "
           href="/2017/09/05/es6/"
           data-tag="JavaScript,ES6"
           data-author="" >
            <span class="post-title" title="ES6核心">ES6核心</span>
            <span class="post-date" title="2017-09-05 15:33:44">2017/09/05</span>
        </a>
        
        <a  class="HTML/CSS "
           href="/2017/06/28/html5/"
           data-tag="HTML"
           data-author="" >
            <span class="post-title" title="HTML5基础">HTML5基础</span>
            <span class="post-date" title="2017-06-28 23:14:31">2017/06/28</span>
        </a>
        
        <a  class="HTML/CSS "
           href="/2017/03/01/html/"
           data-tag="HTML"
           data-author="" >
            <span class="post-title" title="HTML基础">HTML基础</span>
            <span class="post-date" title="2017-03-01 01:42:52">2017/03/01</span>
        </a>
        
        <a  class="JavaScript "
           href="/2017/05/04/jquery/"
           data-tag="JavaScript"
           data-author="" >
            <span class="post-title" title="jQuery">jQuery</span>
            <span class="post-date" title="2017-05-04 02:02:02">2017/05/04</span>
        </a>
        
        <a  class="JavaScript "
           href="/2018/04/05/jquerydemo/"
           data-tag="JavaScript"
           data-author="" >
            <span class="post-title" title="【实战】封装模拟jQuery的DOM库">【实战】封装模拟jQuery的DOM库</span>
            <span class="post-date" title="2018-04-05 22:16:41">2018/04/05</span>
        </a>
        
        <a  class="JavaScript "
           href="/2017/05/16/js/"
           data-tag="JavaScript"
           data-author="" >
            <span class="post-title" title="原生js造轮子">原生js造轮子</span>
            <span class="post-date" title="2017-05-16 23:16:10">2017/05/16</span>
        </a>
        
        <a  class="JavaScript "
           href="/2017/06/12/modular/"
           data-tag="CMD,AMD,Common.js,require.js,r.js"
           data-author="" >
            <span class="post-title" title="模块化基础">模块化基础</span>
            <span class="post-date" title="2017-06-12 23:14:17">2017/06/12</span>
        </a>
        
        <a  class="JavaScript "
           href="/2017/05/30/jq/"
           data-tag="JavaScript"
           data-author="" >
            <span class="post-title" title="jQuery实例及插件">jQuery实例及插件</span>
            <span class="post-date" title="2017-05-30 23:16:25">2017/05/30</span>
        </a>
        
        <a  class="Node.js "
           href="/2018/05/11/node-server/"
           data-tag="node.js"
           data-author="" >
            <span class="post-title" title="Node.js后端服务器框架">Node.js后端服务器框架</span>
            <span class="post-date" title="2018-05-11 22:16:41">2018/05/11</span>
        </a>
        
        <a  class="JavaScript "
           href="/2017/06/25/jsproject/"
           data-tag="设计模式"
           data-author="" >
            <span class="post-title" title="前端设计模式">前端设计模式</span>
            <span class="post-date" title="2017-06-25 23:13:19">2017/06/25</span>
        </a>
        
        <a  class="HTML/CSS "
           href="/2017/08/10/phone/"
           data-tag="响应式,媒体查询"
           data-author="" >
            <span class="post-title" title="媒体查询(Media Queries)">媒体查询(Media Queries)</span>
            <span class="post-date" title="2017-08-10 23:17:50">2017/08/10</span>
        </a>
        
        <a  class="JavaScript "
           href="/2017/07/25/vue/"
           data-tag="Vue"
           data-author="" >
            <span class="post-title" title="Vue.js">Vue.js</span>
            <span class="post-date" title="2017-07-25 23:16:41">2017/07/25</span>
        </a>
        
        <a  class="JavaScript "
           href="/2017/05/12/object/"
           data-tag="面向对象"
           data-author="" >
            <span class="post-title" title="面向对象基础">面向对象基础</span>
            <span class="post-date" title="2017-05-12 23:13:02">2017/05/12</span>
        </a>
        
        <a  class="Node.js "
           href="/2017/06/20/npm/"
           data-tag="node.js,npm,npmscript"
           data-author="" >
            <span class="post-title" title="npm-npmscript">npm-npmscript</span>
            <span class="post-date" title="2017-06-20 23:13:19">2017/06/20</span>
        </a>
        
        <a  class="HTML/CSS "
           href="/2017/08/18/ydnjs/"
           data-tag="flex布局"
           data-author="" >
            <span class="post-title" title="flex布局">flex布局</span>
            <span class="post-date" title="2017-08-18 11:40:15">2017/08/18</span>
        </a>
        
        <a  class="BackEnd "
           href="/2017/05/08/node/"
           data-tag="php,xmapp"
           data-author="" >
            <span class="post-title" title="后端基础">后端基础</span>
            <span class="post-date" title="2017-05-08 23:12:44">2017/05/08</span>
        </a>
        
        <a  class="others "
           href="/2017/02/20/web/"
           data-tag="前端职责"
           data-author="" >
            <span class="post-title" title="自学准备工作">自学准备工作</span>
            <span class="post-date" title="2017-02-20 01:39:17">2017/02/20</span>
        </a>
        
        <a  class="HTML/CSS "
           href="/2017/07/05/css3/"
           data-tag="CSS"
           data-author="" >
            <span class="post-title" title="CSS3基础">CSS3基础</span>
            <span class="post-date" title="2017-07-05 23:14:44">2017/07/05</span>
        </a>
        
        <a  class="Node.js "
           href="/2018/07/14/2018.7.14/"
           data-tag="node.js"
           data-author="" >
            <span class="post-title" title="Node.js基础">Node.js基础</span>
            <span class="post-date" title="2018-07-14 23:16:41">2018/07/14</span>
        </a>
        
        <a  class="HTML/CSS "
           href="/2017/03/25/css/"
           data-tag="CSS"
           data-author="" >
            <span class="post-title" title="CSS基础">CSS基础</span>
            <span class="post-date" title="2017-03-25 01:48:30">2017/03/25</span>
        </a>
        
        <a  class="JavaScript "
           href="/2017/04/29/javascript/"
           data-tag="JavaScript,ajax,json,jsonp"
           data-author="" >
            <span class="post-title" title="JavaScript基础">JavaScript基础</span>
            <span class="post-date" title="2017-04-29 02:01:41">2017/04/29</span>
        </a>
        
        <a  class="JavaScript "
           href="/2018/08/03/2018.8.3/"
           data-tag="React"
           data-author="" >
            <span class="post-title" title="【实战】React调色板">【实战】React调色板</span>
            <span class="post-date" title="2018-08-03 23:16:41">2018/08/03</span>
        </a>
        
        <a  class="JavaScript "
           href="/2018/08/06/2018.8.6/"
           data-tag="JavaScript"
           data-author="" >
            <span class="post-title" title="正则表达式">正则表达式</span>
            <span class="post-date" title="2018-08-06 23:16:41">2018/08/06</span>
        </a>
        
        <a  class="BackEnd "
           href="/2018/08/09/2018.8.9/"
           data-tag="PHP"
           data-author="" >
            <span class="post-title" title="【实战】PHP + MySQL新闻网">【实战】PHP + MySQL新闻网</span>
            <span class="post-date" title="2018-08-09 23:16:41">2018/08/09</span>
        </a>
        
        <a  class="HTML/CSS "
           href="/2018/08/13/2018.8.13/"
           data-tag="HTML"
           data-author="" >
            <span class="post-title" title="form、a、iframe 和 table 详解">form、a、iframe 和 table 详解</span>
            <span class="post-date" title="2018-08-13 23:16:41">2018/08/13</span>
        </a>
        
        <a  class="HTML/CSS "
           href="/2018/08/16/2018.8.16/"
           data-tag="响应式"
           data-author="" >
            <span class="post-title" title="【实战】一个响应式页面">【实战】一个响应式页面</span>
            <span class="post-date" title="2018-08-16 23:16:41">2018/08/16</span>
        </a>
        
        <a  class="JavaScript "
           href="/2018/08/19/2018.8.19/"
           data-tag="JavaScript"
           data-author="" >
            <span class="post-title" title="JavaScript assert">JavaScript assert</span>
            <span class="post-date" title="2018-08-19 23:16:41">2018/08/19</span>
        </a>
        
        <a  class="lifes "
           href="/2018/08/31/2018.8.31/"
           data-tag="个人总结"
           data-author="" >
            <span class="post-title" title="【总结】2018年8月份个人总结">【总结】2018年8月份个人总结</span>
            <span class="post-date" title="2018-08-31 23:16:41">2018/08/31</span>
        </a>
        
        <a  class="JavaScript "
           href="/2018/08/23/2018.8.23/"
           data-tag="JavaScript"
           data-author="" >
            <span class="post-title" title="【实战】JS语音生成器">【实战】JS语音生成器</span>
            <span class="post-date" title="2018-08-23 23:16:41">2018/08/23</span>
        </a>
        
        <a  class="JavaScript "
           href="/2018/08/26/2018.8.26/"
           data-tag="JavaScript"
           data-author="" >
            <span class="post-title" title="前端调试">前端调试</span>
            <span class="post-date" title="2018-08-26 23:16:41">2018/08/26</span>
        </a>
        
        <a  class="JavaScript "
           href="/2018/09/03/2018.9.3/"
           data-tag="JavaScript"
           data-author="" >
            <span class="post-title" title="【实战】IFE的JavaScript编码">【实战】IFE的JavaScript编码</span>
            <span class="post-date" title="2018-09-03 23:16:41">2018/09/03</span>
        </a>
        
        <a  class="Node.js "
           href="/2018/09/06/2018.9.6/"
           data-tag="node.js"
           data-author="" >
            <span class="post-title" title="【实战】速卖通产品页列表nodejs爬虫">【实战】速卖通产品页列表nodejs爬虫</span>
            <span class="post-date" title="2018-09-06 23:16:41">2018/09/06</span>
        </a>
        
        <a  class="Node.js "
           href="/2018/09/14/2018.9.14/"
           data-tag="node.js"
           data-author="" >
            <span class="post-title" title="【实战】亚马逊产品详情页nodejs爬虫">【实战】亚马逊产品详情页nodejs爬虫</span>
            <span class="post-date" title="2018-09-14 23:16:41">2018/09/14</span>
        </a>
        
        <a  class="Node.js "
           href="/2018/09/18/2018.9.18/"
           data-tag="node.js"
           data-author="" >
            <span class="post-title" title="【实战】Ozon产品列表页及产品详情页nodejs爬虫">【实战】Ozon产品列表页及产品详情页nodejs爬虫</span>
            <span class="post-date" title="2018-09-18 23:16:41">2018/09/18</span>
        </a>
        
        <a  class="JavaScript "
           href="/2018/09/10/2018.9.10/"
           data-tag="JavaScript"
           data-author="" >
            <span class="post-title" title="【实战】IFE的JavaScript练习">【实战】IFE的JavaScript练习</span>
            <span class="post-date" title="2018-09-10 23:16:41">2018/09/10</span>
        </a>
        
        <a  class="JavaScript "
           href="/2018/09/23/2018.9.23/"
           data-tag="JavaScript"
           data-author="" >
            <span class="post-title" title="【实战】IFE的JavaScript和树">【实战】IFE的JavaScript和树</span>
            <span class="post-date" title="2018-09-23 23:16:41">2018/09/23</span>
        </a>
        
        <a  class="JavaScript "
           href="/2018/09/28/2018.9.28/"
           data-tag="JavaScript"
           data-author="" >
            <span class="post-title" title="【实战】封装获取url的querystring参数">【实战】封装获取url的querystring参数</span>
            <span class="post-date" title="2018-09-28 23:16:41">2018/09/28</span>
        </a>
        
        <a  class="lifes "
           href="/2018/09/30/2018.9.30/"
           data-tag="个人总结"
           data-author="" >
            <span class="post-title" title="【总结】2018年9月份个人总结">【总结】2018年9月份个人总结</span>
            <span class="post-date" title="2018-09-30 23:16:41">2018/09/30</span>
        </a>
        
        <a  class="HTML/CSS "
           href="/2018/10/04/2018.10.4/"
           data-tag="CSS"
           data-author="" >
            <span class="post-title" title="【实战】IFE的HTML及CSS布局实例">【实战】IFE的HTML及CSS布局实例</span>
            <span class="post-date" title="2018-10-04 23:16:41">2018/10/04</span>
        </a>
        
        <a  class="HTML/CSS "
           href="/2018/10/20/2018.10.20/"
           data-tag="响应式,栅格系统"
           data-author="" >
            <span class="post-title" title="栅格系统(CSS grid)">栅格系统(CSS grid)</span>
            <span class="post-date" title="2018-10-20 23:17:50">2018/10/20</span>
        </a>
        
        <a  class="lifes "
           href="/2018/12/30/2018.10.31/"
           data-tag="个人总结"
           data-author="" >
            <span class="post-title" title="【总结】2018年10&amp;11&amp;12月份个人总结">【总结】2018年10&amp;11&amp;12月份个人总结</span>
            <span class="post-date" title="2018-12-30 23:17:50">2018/12/30</span>
        </a>
        
        <a  class="JavaScript "
           href="/2018/11/05/2018.11.5/"
           data-tag="JavaScript,Node.js"
           data-author="" >
            <span class="post-title" title="【实战】js+node.js实现注册登录">【实战】js+node.js实现注册登录</span>
            <span class="post-date" title="2018-11-05 23:17:50">2018/11/05</span>
        </a>
        
        <a  class="JavaScript "
           href="/2018/11/12/2018.11.12/"
           data-tag="JavaScript"
           data-author="" >
            <span class="post-title" title="【实战】js+leancloud实现注册登录">【实战】js+leancloud实现注册登录</span>
            <span class="post-date" title="2018-11-12 23:17:50">2018/11/12</span>
        </a>
        
        <a  class="JavaScript "
           href="/2018/11/18/2018.11.18/"
           data-tag="JavaScript,Handlerbars.js,模板引擎,柯里化"
           data-author="" >
            <span class="post-title" title="Handlerbars.js模板引擎">Handlerbars.js模板引擎</span>
            <span class="post-date" title="2018-11-18 23:17:50">2018/11/18</span>
        </a>
        
        <a  class="JavaScript "
           href="/2018/12/05/2018.12.5/"
           data-tag="JavaScript,Promise"
           data-author="" >
            <span class="post-title" title="Promise解决回调地狱">Promise解决回调地狱</span>
            <span class="post-date" title="2018-12-05 23:17:50">2018/12/05</span>
        </a>
        
        <a  class="others "
           href="/2018/12/15/2018.12.15/"
           data-tag="CacheControl"
           data-author="" >
            <span class="post-title" title="缓存">缓存</span>
            <span class="post-date" title="2018-12-15 23:17:50">2018/12/15</span>
        </a>
        
        <a  class="JavaScript "
           href="/2018/12/23/2018.12.23/"
           data-tag="JavaScript"
           data-author="" >
            <span class="post-title" title="【实战】js+Leancloud实现留言板">【实战】js+Leancloud实现留言板</span>
            <span class="post-date" title="2018-12-23 23:17:50">2018/12/23</span>
        </a>
        
        <a  class="HTML/CSS "
           href="/2018/11/10/2018.11.10/"
           data-tag="响应式"
           data-author="" >
            <span class="post-title" title="手机移动端页面">手机移动端页面</span>
            <span class="post-date" title="2018-11-10 23:16:41">2018/11/10</span>
        </a>
        
        <a  class="JavaScript "
           href="/2019/01/22/2019.1.22/"
           data-tag="JavaScript"
           data-author="" >
            <span class="post-title" title="Event Loop">Event Loop</span>
            <span class="post-date" title="2019-01-22 23:17:50">2019/01/22</span>
        </a>
        
        <a  class="lifes "
           href="/2019/01/31/2019.1.31/"
           data-tag="个人总结"
           data-author="" >
            <span class="post-title" title="【总结】2018年个人年度总结">【总结】2018年个人年度总结</span>
            <span class="post-date" title="2019-01-31 23:17:50">2019/01/31</span>
        </a>
        
        <a  class="Node.js "
           href="/2019/01/10/2019.1.10/"
           data-tag="JavaScript,Express,Node.js"
           data-author="" >
            <span class="post-title" title="Express + js 分页器">Express + js 分页器</span>
            <span class="post-date" title="2019-01-10 23:17:50">2019/01/10</span>
        </a>
        
        <a  class="HTML/CSS "
           href="/2018/10/15/2018.10.15/"
           data-tag="CSS"
           data-author="" >
            <span class="post-title" title="【实战】IFE的HTML及CSS模拟报纸及产品官网布局">【实战】IFE的HTML及CSS模拟报纸及产品官网布局</span>
            <span class="post-date" title="2018-10-15 23:16:41">2018/10/15</span>
        </a>
        
        <a  class="JavaScript "
           href="/2019/02/14/2019.2.14/"
           data-tag="Vue"
           data-author="" >
            <span class="post-title" title="Vue.js造轮子系列">Vue.js造轮子系列</span>
            <span class="post-date" title="2019-02-14 23:17:50">2019/02/14</span>
        </a>
        
        <a  class="Node.js "
           href="/2019/02/18/2019.2.20/"
           data-tag="node.js,gulp,webpack"
           data-author="" >
            <span class="post-title" title="gulp&amp;Wepback打包">gulp&amp;Wepback打包</span>
            <span class="post-date" title="2019-02-18 23:17:50">2019/02/18</span>
        </a>
        
        <a  class="JavaScript "
           href="/2019/02/24/2019.2.24/"
           data-tag="JavaScript,MVC"
           data-author="" >
            <span class="post-title" title="JavaScript实现MVC">JavaScript实现MVC</span>
            <span class="post-date" title="2019-02-24 23:17:50">2019/02/24</span>
        </a>
        
        <a  class="lifes "
           href="/2019/02/28/2019.2.27/"
           data-tag="个人总结"
           data-author="" >
            <span class="post-title" title="【总结】2019年2月份个人总结">【总结】2019年2月份个人总结</span>
            <span class="post-date" title="2019-02-28 23:17:50">2019/02/28</span>
        </a>
        
        <a  class="JavaScript "
           href="/2019/03/10/2019.3.10/"
           data-tag="Canvas"
           data-author="" >
            <span class="post-title" title="【实战】Canvas画板">【实战】Canvas画板</span>
            <span class="post-date" title="2019-03-10 23:17:50">2019/03/10</span>
        </a>
        
        <a  class="JavaScript "
           href="/2019/03/16/2019.3.16/"
           data-tag="JavaScript"
           data-author="" >
            <span class="post-title" title="forEach和sort的实现">forEach和sort的实现</span>
            <span class="post-date" title="2019-03-16 23:17:50">2019/03/16</span>
        </a>
        
    </nav>
</div>
    </div>
    <div class="hide-list">
        <div class="semicircle">
            <div class="brackets first"><</div>
            <div class="brackets">&gt;</div>
        </div>
    </div>
</aside>
<div class="post">
    <div class="pjax">
        <article id="post-2018.7.14" class="article article-type-post" itemscope itemprop="blogPost">
    
        <h1 class="article-title">Node.js基础</h1>
    
    <div class="article-meta">
        
        
        
        <span class="book">
            
                <a href="javascript:" data-rel="Node.js">Node.js</a>
            
        </span>
        
        
        <span class="tag">
            
            <a href="javascript:" class="color3">node.js</a>
            
        </span>
        
    </div>
    <div class="article-meta">
        
        创建时间:<time class="date" title='更新时间: 2018-10-10 21:03:36'>2018-07-14 23:16</time>
        
    </div>
    <div class="article-meta">
        
        
        <span id="busuanzi_container_page_pv">
            阅读:<span id="busuanzi_value_page_pv">
                <span class="count-comment">
                    <span class="spinner">
                      <div class="cube1"></div>
                      <div class="cube2"></div>
                    </span>
                </span>
            </span>
        </span>
        
        
    </div>
    
    <div class="toc-ref">
    
        <ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#简介"><span class="toc-text">简介</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#创建第一个应用"><span class="toc-text">创建第一个应用</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#脚本模式"><span class="toc-text">脚本模式</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#交货模式"><span class="toc-text">交货模式</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#NPM-使用介绍"><span class="toc-text">NPM 使用介绍</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#使用-npm-命令安装模块"><span class="toc-text">使用 npm 命令安装模块</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#全局安装与本地安装"><span class="toc-text">全局安装与本地安装</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#使用-package-json"><span class="toc-text">使用 package.json</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#卸载模块"><span class="toc-text">卸载模块</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#更新模块"><span class="toc-text">更新模块</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#搜索模块"><span class="toc-text">搜索模块</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#创建模块"><span class="toc-text">创建模块</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#NPM-常用命令"><span class="toc-text">NPM 常用命令</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#使用淘宝-NPM-镜像"><span class="toc-text">使用淘宝 NPM 镜像</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#REPL-交互式解释器"><span class="toc-text">REPL(交互式解释器)</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#简单的表达式运算"><span class="toc-text">简单的表达式运算</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#使用变量"><span class="toc-text">使用变量</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#多行表达式"><span class="toc-text">多行表达式</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#下划线-变量"><span class="toc-text">下划线(_)变量</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#REPL-命令"><span class="toc-text">REPL 命令</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#停止-REPL"><span class="toc-text">停止 REPL</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#回调函数"><span class="toc-text">回调函数</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#阻塞代码实例"><span class="toc-text">阻塞代码实例</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#非阻塞代码实例"><span class="toc-text">非阻塞代码实例</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#事件循环"><span class="toc-text">事件循环</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#事件驱动程序"><span class="toc-text">事件驱动程序</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#实例"><span class="toc-text">实例</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#应用程序工作机制"><span class="toc-text">应用程序工作机制</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#EventEmitter"><span class="toc-text">EventEmitter</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#EventEmitter-类"><span class="toc-text">EventEmitter 类</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#方法"><span class="toc-text">方法</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#类方法"><span class="toc-text">类方法</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#事件"><span class="toc-text">事件</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#实例-1"><span class="toc-text">实例</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#error-事件"><span class="toc-text">error 事件</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#继承-EventEmitter"><span class="toc-text">继承 EventEmitter</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Buffer-缓冲区"><span class="toc-text">Buffer(缓冲区)</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#Buffer-与字符编码"><span class="toc-text">Buffer 与字符编码</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#创建-Buffer-类"><span class="toc-text">创建 Buffer 类</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#写入缓冲区"><span class="toc-text">写入缓冲区</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#从缓冲区读取数据"><span class="toc-text">从缓冲区读取数据</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#将-Buffer-转换为-JSON-对象"><span class="toc-text">将 Buffer 转换为 JSON 对象</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#缓冲区合并"><span class="toc-text">缓冲区合并</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#缓冲区比较"><span class="toc-text">缓冲区比较</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#拷贝缓冲区"><span class="toc-text">拷贝缓冲区</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#缓冲区裁剪"><span class="toc-text">缓冲区裁剪</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#缓冲区长度"><span class="toc-text">缓冲区长度</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Stream-流"><span class="toc-text">Stream(流)</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#从流中读取数据"><span class="toc-text">从流中读取数据</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#写入流"><span class="toc-text">写入流</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#管道流"><span class="toc-text">管道流</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#链式流"><span class="toc-text">链式流</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#模块系统"><span class="toc-text">模块系统</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#创建模块-1"><span class="toc-text">创建模块</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#服务端的模块加载"><span class="toc-text">服务端的模块加载</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#函数"><span class="toc-text">函数</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#匿名函数"><span class="toc-text">匿名函数</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#HTTP服务器工作机制"><span class="toc-text">HTTP服务器工作机制</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#路由"><span class="toc-text">路由</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#全局对象"><span class="toc-text">全局对象</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#filename"><span class="toc-text">__filename</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#dirname"><span class="toc-text">__dirname</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#process"><span class="toc-text">process</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#常用工具"><span class="toc-text">常用工具</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#util-inherits"><span class="toc-text">util.inherits</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#util-inspect"><span class="toc-text">util.inspect</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#util-isArray-object"><span class="toc-text">util.isArray(object)</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#util-isRegExp-object"><span class="toc-text">util.isRegExp(object)</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#util-isDate-object"><span class="toc-text">util.isDate(object)</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#util-isError-object"><span class="toc-text">util.isError(object)</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#文件系统"><span class="toc-text">文件系统</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#异步和同步"><span class="toc-text">异步和同步</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#打开文件"><span class="toc-text">打开文件</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#获取文件信息"><span class="toc-text">获取文件信息</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#写入文件"><span class="toc-text">写入文件</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#读取文件"><span class="toc-text">读取文件</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#关闭文件"><span class="toc-text">关闭文件</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#截取文件"><span class="toc-text">截取文件</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#删除文件"><span class="toc-text">删除文件</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#创建目录"><span class="toc-text">创建目录</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#读取目录"><span class="toc-text">读取目录</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#删除目录"><span class="toc-text">删除目录</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#GET-POST请求"><span class="toc-text">GET/POST请求</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#获取GET请求内容"><span class="toc-text">获取GET请求内容</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#获取-POST-请求内容"><span class="toc-text">获取 POST 请求内容</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#工具模块"><span class="toc-text">工具模块</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#OS模块"><span class="toc-text">OS模块</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Path-模块"><span class="toc-text">Path 模块</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Net-模块"><span class="toc-text">Net 模块</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#DNS-模块"><span class="toc-text">DNS 模块</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Domain-模块"><span class="toc-text">Domain 模块</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Web-模块"><span class="toc-text">Web 模块</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#Web-应用架构"><span class="toc-text">Web 应用架构</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Node-创建-Web-服务器"><span class="toc-text">Node 创建 Web 服务器</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Node-创建-Web-客户端"><span class="toc-text">Node 创建 Web 客户端</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#RESTful-API"><span class="toc-text">RESTful API</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#RESTful-Web-Services"><span class="toc-text">RESTful Web Services</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#创建-RESTful"><span class="toc-text">创建 RESTful</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#获取用户列表"><span class="toc-text">获取用户列表</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#添加用户"><span class="toc-text">添加用户</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#显示用户详情"><span class="toc-text">显示用户详情</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#删除用户"><span class="toc-text">删除用户</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#多进程"><span class="toc-text">多进程</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#exec-方法"><span class="toc-text">exec() 方法</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#spawn-方法"><span class="toc-text">spawn() 方法</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#fork-方法"><span class="toc-text">fork 方法</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#JXcore打包"><span class="toc-text">JXcore打包</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#JXcore安装"><span class="toc-text">JXcore安装</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#包代码"><span class="toc-text">包代码</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#载入-JX-文件"><span class="toc-text">载入 JX 文件</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#连接-MySQL"><span class="toc-text">连接 MySQL</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#连接-MongoDB"><span class="toc-text">连接 MongoDB</span></a></li></ol>
    
<style>
    .left-col .switch-btn,
    .left-col .switch-area {
        display: none;
    }
    .toc-level-3 i,
    .toc-level-3 ol {
        display: none !important;
    }
</style>
</div>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h1 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h1><p>Node.js 就是运行在服务端的 JavaScript,是一个平台,提供I/O接口,基于Google的V8引擎</p>
<h1 id="创建第一个应用"><a href="#创建第一个应用" class="headerlink" title="创建第一个应用"></a>创建第一个应用</h1><h2 id="脚本模式"><a href="#脚本模式" class="headerlink" title="脚本模式"></a>脚本模式</h2><p>保存该文件，文件名为 helloworld.js<br><a id="more"></a></p>
<figure class="highlight abnf"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">console.log(<span class="string">"Hello World"</span>)<span class="comment">;</span></div></pre></td></tr></table></figure>
<p> 并通过 node命令来执行,输出Hello World!</p>
<figure class="highlight crmsh"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">node</span> <span class="title">helloworld</span>.js</div></pre></td></tr></table></figure>
<h2 id="交货模式"><a href="#交货模式" class="headerlink" title="交货模式"></a>交货模式</h2><p>打开终端，键入node进入命令交互模式，可以输入一条代码语句后立即执行并显示结果</p>
<figure class="highlight crmsh"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">$ <span class="keyword">node</span></div><div class="line"><span class="title">&gt; console</span>.log('Hello World!');</div><div class="line">Hello World!</div></pre></td></tr></table></figure>
<h1 id="NPM-使用介绍"><a href="#NPM-使用介绍" class="headerlink" title="NPM 使用介绍"></a>NPM 使用介绍</h1><p>NPM是随同NodeJS一起安装的包管理工具，能解决NodeJS代码部署上的很多问题，常见的使用场景</p>
<ul>
<li>允许用户从NPM服务器下载别人编写的第三方包到本地使用</li>
<li>允许用户从NPM服务器下载并安装别人编写的命令行程序到本地使用</li>
<li>允许用户将自己编写的包或命令行程序上传到NPM服务器供别人使用</li>
</ul>
<h2 id="使用-npm-命令安装模块"><a href="#使用-npm-命令安装模块" class="headerlink" title="使用 npm 命令安装模块"></a>使用 npm 命令安装模块</h2><p>使用 npm 命令安装常用的 Node.js web框架模块 express</p>
<figure class="highlight cmake"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">npm <span class="keyword">install</span> express</div></pre></td></tr></table></figure>
<p>安装好之后，express 包就放在了工程目录下的 node_modules 目录中</p>
<p>因此在代码中只需要通过 require(‘express’) 的方式就好，无需指定第三方包路径</p>
<figure class="highlight ebnf"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="attribute">var express</span> = require(<span class="string">'express'</span>);</div></pre></td></tr></table></figure>
<h2 id="全局安装与本地安装"><a href="#全局安装与本地安装" class="headerlink" title="全局安装与本地安装"></a>全局安装与本地安装</h2><p>npm 的包安装分为本地安装、全局安装</p>
<figure class="highlight cmake"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">npm <span class="keyword">install</span> express      <span class="comment"># 本地安装</span></div><div class="line">npm <span class="keyword">install</span> express -g   <span class="comment"># 全局安装</span></div></pre></td></tr></table></figure>
<p>本地安装</p>
<ul>
<li>将安装包放在 ./node_modules 下，如果没有 node_modules 目录</li>
<li>可以通过 require() 来引入本地安装的包</li>
</ul>
<p>全局安装</p>
<ul>
<li>将安装包放在 /usr/local 下或者你 node 的安装目录。</li>
<li>可以直接在命令行里使用</li>
</ul>
<h2 id="使用-package-json"><a href="#使用-package-json" class="headerlink" title="使用 package.json"></a>使用 package.json</h2><p>package.json 位于模块的目录下，用于定义包的属性,属性说明</p>
<ul>
<li>name - 包名</li>
<li>version - 包的版本号</li>
<li>description - 包的描述</li>
<li>homepage - 包的官网 url</li>
<li>author - 包的作者姓名</li>
<li>contributors - 包的其他贡献者姓名</li>
<li>dependencies - 依赖包列表。如果依赖包没有安装，npm 会自动将依赖包安装在 node_module 目录下</li>
<li>repository - 包代码存放的地方的类型，可以是 git 或 svn，git 可在 Github 上</li>
<li>main - main 字段指定了程序的主入口文件，require(‘moduleName’) 就会加载这个文件。这个字段的默认值是模块根目录下面的 index.js</li>
<li>keywords - 关键字</li>
</ul>
<h2 id="卸载模块"><a href="#卸载模块" class="headerlink" title="卸载模块"></a>卸载模块</h2><p>使用以下命令来卸载 Node.js 模块</p>
<figure class="highlight coffeescript"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="built_in">npm</span> uninstall express</div></pre></td></tr></table></figure>
<h2 id="更新模块"><a href="#更新模块" class="headerlink" title="更新模块"></a>更新模块</h2><p>使用以下命令更新模块</p>
<figure class="highlight coffeescript"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="built_in">npm</span> update express</div></pre></td></tr></table></figure>
<h2 id="搜索模块"><a href="#搜索模块" class="headerlink" title="搜索模块"></a>搜索模块</h2><p>使用以下来搜索模块</p>
<figure class="highlight coffeescript"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="built_in">npm</span> search express</div></pre></td></tr></table></figure>
<h2 id="创建模块"><a href="#创建模块" class="headerlink" title="创建模块"></a>创建模块</h2><p>创建模块，package.json 文件是必不可少的</p>
<figure class="highlight coffeescript"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="built_in">npm</span> init</div></pre></td></tr></table></figure>
<p>使用以下命令在 npm 资源库中注册用户（使用邮箱注册）</p>
<figure class="highlight groovy"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">npm adduser</div><div class="line"><span class="string">Username:</span> mcmohd</div><div class="line"><span class="string">Password:</span></div><div class="line"><span class="string">Email:</span> (<span class="keyword">this</span> IS <span class="keyword">public</span>) mcmohd<span class="meta">@gmail</span>.com</div></pre></td></tr></table></figure>
<p>用以下命令来发布模块</p>
<figure class="highlight coffeescript"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="built_in">npm</span> publish</div></pre></td></tr></table></figure>
<h2 id="NPM-常用命令"><a href="#NPM-常用命令" class="headerlink" title="NPM 常用命令"></a>NPM 常用命令</h2><p>NPM提供了很多命令，例如install和publish，使用npm help可查看所有命令</p>
<ul>
<li>使用npm help <command>可查看某条命令的详细帮助，例如npm help install</li>
<li>在package.json所在目录下使用npm install . -g可先在本地安装当前命令行程序，可用于发布前的本地测试</li>
<li>使用npm update <package>可以把当前目录下node_modules子目录里边的对应模块更新至最新版本</package></li>
<li>使用npm update <package> -g可以把全局安装的对应命令行程序更新至最新版</package></li>
<li>使用npm cache clear可以清空NPM本地缓存，用于对付使用相同版本号发布新版本代码的人</li>
<li>使用npm unpublish <package>@<version>可以撤销发布自己发布过的某个版本代码</version></package></li>
</ul>
<h2 id="使用淘宝-NPM-镜像"><a href="#使用淘宝-NPM-镜像" class="headerlink" title="使用淘宝 NPM 镜像"></a>使用淘宝 NPM 镜像</h2><figure class="highlight groovy"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// 使用淘宝定制的 cnpm (gzip 压缩支持) 命令行工具代替默认的 npm</span></div><div class="line">npm install -g cnpm --registry=<span class="string">https:</span><span class="comment">//registry.npm.taobao.org</span></div><div class="line"></div><div class="line"><span class="comment">// 使用 cnpm 命令来安装模块</span></div><div class="line"><span class="comment">// cnpm install [name]</span></div></pre></td></tr></table></figure>
<h1 id="REPL-交互式解释器"><a href="#REPL-交互式解释器" class="headerlink" title="REPL(交互式解释器)"></a>REPL(交互式解释器)</h1><p>Node 自带了交互式解释器，可以执行以下任务</p>
<ul>
<li>读取 - 读取用户输入，解析输入了Javascript 数据结构并存储在内存中。</li>
<li>执行 - 执行输入的数据结构</li>
<li>打印 - 输出结果</li>
<li>循环 - 循环操作以上步骤直到用户两次按下 ctrl-c 按钮退出</li>
</ul>
<p>输入以下命令来启动 Node 的终端</p>
<figure class="highlight crmsh"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">node</span></div><div class="line"><span class="title">&gt;</span></div></pre></td></tr></table></figure>
<h2 id="简单的表达式运算"><a href="#简单的表达式运算" class="headerlink" title="简单的表达式运算"></a>简单的表达式运算</h2><figure class="highlight lsl"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line">$ node</div><div class="line">&gt; <span class="number">1</span> +<span class="number">4</span></div><div class="line"><span class="number">5</span></div><div class="line">&gt; <span class="number">5</span> / <span class="number">2</span></div><div class="line"><span class="number">2.5</span></div><div class="line">&gt; <span class="number">3</span> * <span class="number">6</span></div><div class="line"><span class="number">18</span></div><div class="line">&gt; <span class="number">4</span> - <span class="number">1</span></div><div class="line"><span class="number">3</span></div><div class="line">&gt; <span class="number">1</span> + ( <span class="number">2</span> * <span class="number">3</span> ) - <span class="number">4</span></div><div class="line"><span class="number">3</span></div><div class="line">&gt;</div></pre></td></tr></table></figure>
<h2 id="使用变量"><a href="#使用变量" class="headerlink" title="使用变量"></a>使用变量</h2><p>将数据存储在变量中，并在你需要的时候使用它</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line">$ node</div><div class="line">&gt; x = <span class="number">10</span></div><div class="line"><span class="number">10</span></div><div class="line">&gt; <span class="keyword">var</span> y = <span class="number">10</span></div><div class="line"><span class="literal">undefined</span></div><div class="line">&gt; x + y</div><div class="line"><span class="number">20</span></div><div class="line">&gt; <span class="built_in">console</span>.log(<span class="string">"Hello World"</span>)</div><div class="line">Hello World</div><div class="line"><span class="literal">undefined</span></div><div class="line">&gt; <span class="built_in">console</span>.log(<span class="string">"www.runoob.com"</span>)</div><div class="line">www.runoob.com</div><div class="line"><span class="literal">undefined</span></div></pre></td></tr></table></figure>
<h2 id="多行表达式"><a href="#多行表达式" class="headerlink" title="多行表达式"></a>多行表达式</h2><p>Node REPL 支持输入多行表达式，这就有点类似 JavaScript</p>
<figure class="highlight llvm"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line">// 三个点的符号是系统自动生成的，你回车换行后即可。Node 会自动检测是否为连续的表达式</div><div class="line"></div><div class="line">node</div><div class="line">&gt; var <span class="keyword">x</span> = <span class="number">0</span></div><div class="line">undefined</div><div class="line">&gt; do &#123;</div><div class="line">... <span class="keyword">x</span>++<span class="comment">;</span></div><div class="line">... console.log(<span class="string">"x: "</span> + <span class="keyword">x</span>)<span class="comment">;</span></div><div class="line">... &#125; while ( <span class="keyword">x</span> &lt; <span class="number">5</span> )<span class="comment">;</span></div><div class="line"><span class="keyword">x</span>: <span class="number">1</span></div><div class="line"><span class="keyword">x</span>: <span class="number">2</span></div><div class="line"><span class="keyword">x</span>: <span class="number">3</span></div><div class="line"><span class="keyword">x</span>: <span class="number">4</span></div><div class="line"><span class="keyword">x</span>: <span class="number">5</span></div><div class="line">undefined</div><div class="line">&gt;</div></pre></td></tr></table></figure>
<h2 id="下划线-变量"><a href="#下划线-变量" class="headerlink" title="下划线(_)变量"></a>下划线(_)变量</h2><p>使用下划线(_)获取上一个表达式的运算结果</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line">$ node</div><div class="line">&gt; <span class="keyword">var</span> x = <span class="number">10</span></div><div class="line"><span class="literal">undefined</span></div><div class="line">&gt; <span class="keyword">var</span> y = <span class="number">20</span></div><div class="line"><span class="literal">undefined</span></div><div class="line">&gt; x + y</div><div class="line"><span class="number">30</span></div><div class="line">&gt; <span class="keyword">var</span> sum = _</div><div class="line"><span class="literal">undefined</span></div><div class="line">&gt; <span class="built_in">console</span>.log(sum)</div><div class="line"><span class="number">30</span></div><div class="line"><span class="literal">undefined</span></div><div class="line">&gt;</div></pre></td></tr></table></figure>
<h2 id="REPL-命令"><a href="#REPL-命令" class="headerlink" title="REPL 命令"></a>REPL 命令</h2><ul>
<li>ctrl + c - 退出当前终端</li>
<li>ctrl + c 按下两次 - 退出 Node REPL</li>
<li>ctrl + d - 退出 Node REPL</li>
<li>向上/向下 键 - 查看输入的历史命令</li>
<li>tab 键 - 列出当前命令</li>
<li>.help - 列出使用命令</li>
<li>.break - 退出多行表达式</li>
<li>.clear - 退出多行表达式</li>
<li>.save filename - 保存当前的 Node REPL 会话到指定文件</li>
<li>.load filename - 载入当前 Node REPL 会话的文件内容</li>
</ul>
<h2 id="停止-REPL"><a href="#停止-REPL" class="headerlink" title="停止 REPL"></a>停止 REPL</h2><p>两次 ctrl + c 键就能退出 REPL</p>
<figure class="highlight crmsh"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">$ <span class="keyword">node</span></div><div class="line"><span class="title">&gt;</span></div><div class="line">(^C again to quit)</div><div class="line">&gt;</div></pre></td></tr></table></figure>
<h1 id="回调函数"><a href="#回调函数" class="headerlink" title="回调函数"></a>回调函数</h1><p>Node.js 异步编程的直接体现就是回调</p>
<p>回调函数在完成任务后就会被调用，Node 使用了大量的回调函数，Node 所有 API 都支持回调函数</p>
<p>一边读取文件，一边执行其他命令，在文件读取完成后，我们将文件内容作为回调函数的参数返回。执行代码时就没有阻塞或等待文件 I/O 操作</p>
<h2 id="阻塞代码实例"><a href="#阻塞代码实例" class="headerlink" title="阻塞代码实例"></a>阻塞代码实例</h2><figure class="highlight lasso"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// 创建一个文件 input.txt</span></div><div class="line">张扬博客地址：https:<span class="comment">//github.com/zy343134464</span></div><div class="line"></div><div class="line"><span class="comment">// 创建 main.js 文件</span></div><div class="line"><span class="built_in">var</span> fs = <span class="keyword">require</span>(<span class="string">"fs"</span>);</div><div class="line"><span class="built_in">var</span> <span class="built_in">data</span> = fs.readFileSync(<span class="string">'input.txt'</span>);</div><div class="line">console.<span class="keyword">log</span>(<span class="built_in">data</span>.toString());</div><div class="line">console.<span class="keyword">log</span>(<span class="string">"程序执行结束!"</span>);</div><div class="line"></div><div class="line"><span class="comment">// 输出结果</span></div><div class="line"><span class="comment">// node main.js</span></div><div class="line">张扬博客地址：https:<span class="comment">//github.com/zy343134464</span></div><div class="line"></div><div class="line">程序执行结束!</div></pre></td></tr></table></figure>
<h2 id="非阻塞代码实例"><a href="#非阻塞代码实例" class="headerlink" title="非阻塞代码实例"></a>非阻塞代码实例</h2><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// 创建一个文件 input.txt</span></div><div class="line">张扬博客地址：https:<span class="comment">//github.com/zy343134464</span></div><div class="line"></div><div class="line"><span class="comment">// 创建 main.js 文件</span></div><div class="line"><span class="keyword">var</span> fs = <span class="built_in">require</span>(<span class="string">"fs"</span>);</div><div class="line">fs.readFile(<span class="string">'input.txt'</span>, <span class="function"><span class="keyword">function</span> (<span class="params">err, data</span>) </span>&#123;</div><div class="line">    <span class="keyword">if</span> (err) <span class="keyword">return</span> <span class="built_in">console</span>.error(err);</div><div class="line">    <span class="built_in">console</span>.log(data.toString());</div><div class="line">&#125;);</div><div class="line"><span class="built_in">console</span>.log(<span class="string">"程序执行结束!"</span>);</div><div class="line"></div><div class="line"><span class="comment">// 输出结果</span></div><div class="line"><span class="comment">// node main.js</span></div><div class="line">程序执行结束!</div><div class="line">张扬博客地址：https:<span class="comment">//github.com/zy343134464</span></div></pre></td></tr></table></figure>
<h1 id="事件循环"><a href="#事件循环" class="headerlink" title="事件循环"></a>事件循环</h1><p>Node.js 是单进程单线程应用程序，V8 引擎提供的异步执行回调接口</p>
<p>Node.js 基本上所有的事件机制都是用设计模式中观察者模式实现</p>
<p>Node.js 单线程类似进入一个while(true)的事件循环，直到没有事件观察者退出，每个异步事件都生成一个事件观察者，如果有事件发生就调用该回调函数</p>
<h2 id="事件驱动程序"><a href="#事件驱动程序" class="headerlink" title="事件驱动程序"></a>事件驱动程序</h2><p>Node.js 使用事件驱动模型，当web server接收到请求，就把它关闭然后进行处理，然后去服务下一个web请求</p>
<p>当这个请求完成，它被放回处理队列，当到达队列开头，这个结果被返回给用户</p>
<p>在事件驱动模型中，会生成一个主循环来监听事件，当检测到事件时触发回调函数</p>
<p><img src="http://www.runoob.com/wp-content/uploads/2015/09/event_loop.jpg" alt="image"></p>
<p>Node.js 有多个内置的事件，我们可以通过引入 events 模块，并通过实例化 EventEmitter 类来绑定和监听事件</p>
<figure class="highlight haxe"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// 引入 events 模块</span></div><div class="line"><span class="keyword">var</span> events = require(<span class="string">'events'</span>);</div><div class="line"><span class="comment">// 创建 eventEmitter 对象</span></div><div class="line"><span class="keyword">var</span> eventEmitter = <span class="keyword">new</span> <span class="type">events</span>.EventEmitter();</div></pre></td></tr></table></figure>
<p>绑定及触发事件处理程序</p>
<figure class="highlight less"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// 绑定事件及事件的处理程序</span></div><div class="line"><span class="selector-tag">eventEmitter</span><span class="selector-class">.on</span>(<span class="string">'eventName'</span>, eventHandler);</div><div class="line"></div><div class="line"><span class="comment">// 触发事件</span></div><div class="line"><span class="selector-tag">eventEmitter</span><span class="selector-class">.emit</span>(<span class="string">'eventName'</span>);</div></pre></td></tr></table></figure>
<h2 id="实例"><a href="#实例" class="headerlink" title="实例"></a>实例</h2><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// 创建main.js</span></div><div class="line"><span class="comment">// 引入 events 模块</span></div><div class="line"><span class="keyword">var</span> events = <span class="built_in">require</span>(<span class="string">'events'</span>);</div><div class="line"><span class="comment">// 创建 eventEmitter 对象</span></div><div class="line"><span class="keyword">var</span> eventEmitter = <span class="keyword">new</span> events.EventEmitter();</div><div class="line"></div><div class="line"><span class="comment">// 创建事件处理程序</span></div><div class="line"><span class="keyword">var</span> connectHandler = <span class="function"><span class="keyword">function</span> <span class="title">connected</span>(<span class="params"></span>) </span>&#123;</div><div class="line">   <span class="built_in">console</span>.log(<span class="string">'连接成功。'</span>);</div><div class="line">  </div><div class="line">   <span class="comment">// 触发 data_received 事件 </span></div><div class="line">   eventEmitter.emit(<span class="string">'data_received'</span>);</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="comment">// 绑定 connection 事件处理程序</span></div><div class="line">eventEmitter.on(<span class="string">'connection'</span>, connectHandler);</div><div class="line"> </div><div class="line"><span class="comment">// 使用匿名函数绑定 data_received 事件</span></div><div class="line">eventEmitter.on(<span class="string">'data_received'</span>, <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</div><div class="line">   <span class="built_in">console</span>.log(<span class="string">'数据接收成功。'</span>);</div><div class="line">&#125;);</div><div class="line"></div><div class="line"><span class="comment">// 触发 connection 事件 </span></div><div class="line">eventEmitter.emit(<span class="string">'connection'</span>);</div><div class="line"></div><div class="line"><span class="built_in">console</span>.log(<span class="string">"程序执行完毕。"</span>);</div><div class="line"></div><div class="line"><span class="comment">// 输出</span></div><div class="line"><span class="comment">// node main.js</span></div><div class="line">连接成功。</div><div class="line">数据接收成功。</div><div class="line">程序执行完毕。</div></pre></td></tr></table></figure>
<h2 id="应用程序工作机制"><a href="#应用程序工作机制" class="headerlink" title="应用程序工作机制"></a>应用程序工作机制</h2><p>在 Node 应用程序中,回调函数接收错误对象作为第一个参数，执行异步操作的函数将回调函数作为最后一个参数</p>
<figure class="highlight stata"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// fs.readFile() 是异步函数用于读取文件</span></div><div class="line"><span class="comment">// 如果在读取文件过程中发生错误，错误 err 对象就会输出错误信息</span></div><div class="line"><span class="comment">// 果没发生错误，readFile 跳过 err 对象的输出，文件内容就通过回调函数输出</span></div><div class="line"><span class="comment">// 创建一个 input.txt</span></div><div class="line">张扬博客地址：https:<span class="comment">//github.com/zy343134464</span></div><div class="line"></div><div class="line"><span class="comment">// 创建 main.js 文件</span></div><div class="line"><span class="keyword">var</span> fs = require(<span class="string">"fs"</span>);</div><div class="line">fs.readFile('<span class="keyword">input</span>.txt', function (<span class="keyword">err</span>, data) &#123;</div><div class="line">   <span class="keyword">if</span> (<span class="keyword">err</span>)&#123;</div><div class="line">      console.<span class="built_in">log</span>(<span class="keyword">err</span>.<span class="keyword">stack</span>);</div><div class="line">      <span class="keyword">return</span>;</div><div class="line">   &#125;</div><div class="line">   console.<span class="built_in">log</span>(data.<span class="keyword">toString</span>());</div><div class="line">&#125;);</div><div class="line">console.<span class="built_in">log</span>(<span class="string">"程序执行完毕"</span>);</div><div class="line"></div><div class="line"><span class="comment">// 输出</span></div><div class="line">程序执行完毕</div><div class="line">张扬博客地址：https:<span class="comment">//github.com/zy343134464</span></div><div class="line"></div><div class="line"><span class="comment">// 删除 input.txt 文件</span></div><div class="line"><span class="comment">//输出</span></div><div class="line">程序执行完毕</div><div class="line"><span class="keyword">Error</span>: ENOENT, <span class="keyword">open</span> '<span class="keyword">input</span>.txt'</div></pre></td></tr></table></figure>
<h1 id="EventEmitter"><a href="#EventEmitter" class="headerlink" title="EventEmitter"></a>EventEmitter</h1><p>Node.js 所有的异步 I/O 操作在完成时都会发送一个事件到事件队列</p>
<h2 id="EventEmitter-类"><a href="#EventEmitter-类" class="headerlink" title="EventEmitter 类"></a>EventEmitter 类</h2><p>events 模块只提供了一个对象： events.EventEmitter</p>
<p>EventEmitter 的核心就是事件触发与事件监听器功能的封装</p>
<figure class="highlight haxe"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// 引入 events 模块</span></div><div class="line"><span class="keyword">var</span> events = require(<span class="string">'events'</span>);</div><div class="line"><span class="comment">// 创建 eventEmitter 对象</span></div><div class="line"><span class="keyword">var</span> eventEmitter = <span class="keyword">new</span> <span class="type">events</span>.EventEmitter();</div></pre></td></tr></table></figure>
<p>EventEmitter 对象如果在实例化时发生错误，会触发 error 事件</p>
<p>当添加新的监听器时，newListener 事件会触发，当监听器被移除时，removeListener 事件被触发</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// 运行这段代码，1 秒后控制台输出了 'some_event 事件触发'</span></div><div class="line"><span class="comment">// 其原理是 event 对象注册了事件 some_event 的一个监听器</span></div><div class="line"><span class="comment">// 通过 setTimeout 在 1000 毫秒以后向 event 对象发送事件 some_event，此时会调用some_event 的监听器</span></div><div class="line"><span class="comment">//event.js 文件</span></div><div class="line"><span class="keyword">var</span> EventEmitter = <span class="built_in">require</span>(<span class="string">'events'</span>).EventEmitter; </div><div class="line"><span class="keyword">var</span> event = <span class="keyword">new</span> EventEmitter(); </div><div class="line">event.on(<span class="string">'some_event'</span>, <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123; </div><div class="line">    <span class="built_in">console</span>.log(<span class="string">'some_event 事件触发'</span>); </div><div class="line">&#125;); </div><div class="line">setTimeout(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123; </div><div class="line">    event.emit(<span class="string">'some_event'</span>); </div><div class="line">&#125;, <span class="number">1000</span>); </div><div class="line"></div><div class="line"><span class="comment">// 输出</span></div><div class="line"><span class="comment">// node event.js </span></div><div class="line">some_event 事件触发</div></pre></td></tr></table></figure>
<p>EventEmitter 的每个事件由一个事件名和若干个参数组成，事件名是一个字符串，通常表达一定的语义</p>
<p>对于每个事件，EventEmitter 支持 若干个事件监听器</p>
<p>当事件触发时，注册到这个事件的事件监听器被依次调用，事件参数作为回调函数参数传递</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// emitter 为事件 someEvent 注册了两个事件监听器，然后触发了 someEvent 事件</span></div><div class="line"><span class="comment">// 两个事件监听器回调函数被先后调用</span></div><div class="line"><span class="comment">//event.js 文件</span></div><div class="line"><span class="keyword">var</span> events = <span class="built_in">require</span>(<span class="string">'events'</span>); </div><div class="line"><span class="keyword">var</span> emitter = <span class="keyword">new</span> events.EventEmitter(); </div><div class="line">emitter.on(<span class="string">'someEvent'</span>, <span class="function"><span class="keyword">function</span>(<span class="params">arg1, arg2</span>) </span>&#123; </div><div class="line">    <span class="built_in">console</span>.log(<span class="string">'listener1'</span>, arg1, arg2); </div><div class="line">&#125;); </div><div class="line">emitter.on(<span class="string">'someEvent'</span>, <span class="function"><span class="keyword">function</span>(<span class="params">arg1, arg2</span>) </span>&#123; </div><div class="line">    <span class="built_in">console</span>.log(<span class="string">'listener2'</span>, arg1, arg2); </div><div class="line">&#125;); </div><div class="line">emitter.emit(<span class="string">'someEvent'</span>, <span class="string">'arg1 参数'</span>, <span class="string">'arg2 参数'</span>); </div><div class="line"></div><div class="line"><span class="comment">// 输出</span></div><div class="line"><span class="comment">// node event.js </span></div><div class="line">listener1 arg1 参数 arg2 参数</div><div class="line">listener2 arg1 参数 arg2 参数</div></pre></td></tr></table></figure>
<p>EventEmitter 提供了多个属性，如 on 和 emit。on 函数用于绑定事件函数，emit 属性用于触发一个事件</p>
<h2 id="方法"><a href="#方法" class="headerlink" title="方法"></a>方法</h2><ul>
<li><p>addListener(event, listener):为指定事件添加一个监听器到监听器数组的尾部</p>
</li>
<li><p>on(event, listener):为指定事件注册一个监听器，接受一个字符串 event 和一个回调函数</p>
</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">server.on(<span class="string">'connection'</span>, <span class="function"><span class="keyword">function</span> (<span class="params">stream</span>) </span>&#123;</div><div class="line">  <span class="built_in">console</span>.log(<span class="string">'someone connected!'</span>);</div><div class="line">&#125;);</div></pre></td></tr></table></figure>
<ul>
<li>once(event, listener):为指定事件注册一个单次监听器，即 监听器最多只会触发一次，触发后立刻解除该监听器</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">server.once(<span class="string">'connection'</span>, <span class="function"><span class="keyword">function</span> (<span class="params">stream</span>) </span>&#123;</div><div class="line">  <span class="built_in">console</span>.log(<span class="string">'Ah, we have our first user!'</span>);</div><div class="line">&#125;);</div></pre></td></tr></table></figure>
<ul>
<li>removeListener(event, listener):移除指定事件的某个监听器，监听器必须是该事件已经注册过的监听器</li>
</ul>
<figure class="highlight haxe"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> <span class="keyword">callback</span> = <span class="function"><span class="keyword">function</span></span>(stream) &#123;</div><div class="line">  console.log(<span class="string">'someone connected!'</span>);</div><div class="line">&#125;;</div><div class="line">server.on(<span class="string">'connection'</span>, <span class="keyword">callback</span>);</div><div class="line"><span class="comment">// ...</span></div><div class="line">server.removeListener(<span class="string">'connection'</span>, <span class="keyword">callback</span>);</div></pre></td></tr></table></figure>
<ul>
<li><p>removeAllListeners([event]):移除所有事件的所有监听器， 如果指定事件，则移除指定事件的所有监听器</p>
</li>
<li><p>setMaxListeners(n):setMaxListeners 函数用于提高监听器的默认限制的数量</p>
</li>
<li><p>listeners(event):返回指定事件的监听器数组</p>
</li>
<li><p>emit(event, [arg1], [arg2], […]):按参数的顺序执行每个监听器，如果事件有注册监听返回 true，否则返回 false</p>
</li>
</ul>
<h2 id="类方法"><a href="#类方法" class="headerlink" title="类方法"></a>类方法</h2><ul>
<li>listenerCount(emitter, event):返回指定事件的监听器数量</li>
</ul>
<h2 id="事件"><a href="#事件" class="headerlink" title="事件"></a>事件</h2><ul>
<li><p>newListener(emitter, event):该事件在添加新监听器时被触发</p>
</li>
<li><p>removeListener(emitter, event):从指定监听器数组中删除一个监听器</p>
</li>
</ul>
<h2 id="实例-1"><a href="#实例-1" class="headerlink" title="实例"></a>实例</h2><p>通过 connection（连接）事件演示了 EventEmitter 类的应用</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// 创建 main.js 文件</span></div><div class="line"><span class="keyword">var</span> events = <span class="built_in">require</span>(<span class="string">'events'</span>);</div><div class="line"><span class="keyword">var</span> eventEmitter = <span class="keyword">new</span> events.EventEmitter();</div><div class="line"></div><div class="line"><span class="comment">// 监听器 #1</span></div><div class="line"><span class="keyword">var</span> listener1 = <span class="function"><span class="keyword">function</span> <span class="title">listener1</span>(<span class="params"></span>) </span>&#123;</div><div class="line">   <span class="built_in">console</span>.log(<span class="string">'监听器 listener1 执行。'</span>);</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="comment">// 监听器 #2</span></div><div class="line"><span class="keyword">var</span> listener2 = <span class="function"><span class="keyword">function</span> <span class="title">listener2</span>(<span class="params"></span>) </span>&#123;</div><div class="line">  <span class="built_in">console</span>.log(<span class="string">'监听器 listener2 执行。'</span>);</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="comment">// 绑定 connection 事件，处理函数为 listener1 </span></div><div class="line">eventEmitter.addListener(<span class="string">'connection'</span>, listener1);</div><div class="line"></div><div class="line"><span class="comment">// 绑定 connection 事件，处理函数为 listener2</span></div><div class="line">eventEmitter.on(<span class="string">'connection'</span>, listener2);</div><div class="line"></div><div class="line"><span class="keyword">var</span> eventListeners = <span class="built_in">require</span>(<span class="string">'events'</span>).EventEmitter.listenerCount(eventEmitter,<span class="string">'connection'</span>);</div><div class="line"><span class="built_in">console</span>.log(eventListeners + <span class="string">" 个监听器监听连接事件。"</span>);</div><div class="line"></div><div class="line"><span class="comment">// 处理 connection 事件 </span></div><div class="line">eventEmitter.emit(<span class="string">'connection'</span>);</div><div class="line"></div><div class="line"><span class="comment">// 移除监绑定的 listener1 函数</span></div><div class="line">eventEmitter.removeListener(<span class="string">'connection'</span>, listener1);</div><div class="line"><span class="built_in">console</span>.log(<span class="string">"listener1 不再受监听。"</span>);</div><div class="line"></div><div class="line"><span class="comment">// 触发连接事件</span></div><div class="line">eventEmitter.emit(<span class="string">'connection'</span>);</div><div class="line"></div><div class="line">eventListeners = <span class="built_in">require</span>(<span class="string">'events'</span>).EventEmitter.listenerCount(eventEmitter,<span class="string">'connection'</span>);</div><div class="line"><span class="built_in">console</span>.log(eventListeners + <span class="string">" 个监听器监听连接事件。"</span>);</div><div class="line"></div><div class="line"><span class="built_in">console</span>.log(<span class="string">"程序执行完毕。"</span>);</div><div class="line"></div><div class="line"><span class="comment">// 输出</span></div><div class="line"><span class="comment">// node main.js</span></div><div class="line"><span class="number">2</span> 个监听器监听连接事件。</div><div class="line">监听器 listener1 执行。</div><div class="line">监听器 listener2 执行。</div><div class="line">listener1 不再受监听。</div><div class="line">监听器 listener2 执行。</div><div class="line"><span class="number">1</span> 个监听器监听连接事件。</div><div class="line">程序执行完毕。</div></pre></td></tr></table></figure>
<h2 id="error-事件"><a href="#error-事件" class="headerlink" title="error 事件"></a>error 事件</h2><p>EventEmitter 定义了一个特殊的事件 error，它包含了错误的语义，我们在遇到 异常的时候通常会触发 error 事件</p>
<p>一般要为会触发 error 事件的对象设置监听器，避免遇到错误后整个程序崩溃</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> events = <span class="built_in">require</span>(<span class="string">'events'</span>); </div><div class="line"><span class="keyword">var</span> emitter = <span class="keyword">new</span> events.EventEmitter(); </div><div class="line">emitter.emit(<span class="string">'error'</span>); </div><div class="line"></div><div class="line"><span class="comment">// 运行时会显示以下错误</span></div><div class="line">node.js:<span class="number">201</span> </div><div class="line"><span class="keyword">throw</span> e; <span class="comment">// process.nextTick error, or 'error' event on first tick </span></div><div class="line">^ </div><div class="line"><span class="built_in">Error</span>: Uncaught, unspecified <span class="string">'error'</span> event. </div><div class="line">at EventEmitter.emit (events.js:<span class="number">50</span>:<span class="number">15</span>) </div><div class="line">at <span class="built_in">Object</span>.&lt;anonymous&gt; (<span class="regexp">/home/</span>byvoid/error.js:<span class="number">5</span>:<span class="number">9</span>) </div><div class="line">at Module._compile (<span class="built_in">module</span>.js:<span class="number">441</span>:<span class="number">26</span>) </div><div class="line">at <span class="built_in">Object</span>..js (<span class="built_in">module</span>.js:<span class="number">459</span>:<span class="number">10</span>) </div><div class="line">at Module.load (<span class="built_in">module</span>.js:<span class="number">348</span>:<span class="number">31</span>) </div><div class="line">at <span class="built_in">Function</span>._load (<span class="built_in">module</span>.js:<span class="number">308</span>:<span class="number">12</span>) </div><div class="line">at <span class="built_in">Array</span><span class="number">.0</span> (<span class="built_in">module</span>.js:<span class="number">479</span>:<span class="number">10</span>) </div><div class="line">at EventEmitter._tickCallback (node.js:<span class="number">192</span>:<span class="number">40</span>)</div></pre></td></tr></table></figure>
<h2 id="继承-EventEmitter"><a href="#继承-EventEmitter" class="headerlink" title="继承 EventEmitter"></a>继承 EventEmitter</h2><p>大多数时候我们不会直接使用 EventEmitter，而是在对象中继承它</p>
<p>包括 fs、net、 http 在内的，只要是支持事件响应的核心模块都是 EventEmitter 的子类</p>
<h1 id="Buffer-缓冲区"><a href="#Buffer-缓冲区" class="headerlink" title="Buffer(缓冲区)"></a>Buffer(缓冲区)</h1><p>JavaScript 语言自身只有字符串数据类型，没有二进制数据类型</p>
<p>处理像TCP流或文件流时，必须使用到二进制数据</p>
<p> Node.js中，定义了一个 Buffer 类，该类用来创建一个专门存放二进制数据的缓存区</p>
<h2 id="Buffer-与字符编码"><a href="#Buffer-与字符编码" class="headerlink" title="Buffer 与字符编码"></a>Buffer 与字符编码</h2><p>Buffer 实例一般用于表示编码字符的序列，比如 UTF-8 、 UCS2 、 Base64 、或十六进制编码的数据</p>
<figure class="highlight sqf"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">const buf = Buffer.<span class="keyword">from</span>(<span class="string">'runoob'</span>, <span class="string">'ascii'</span>);</div><div class="line"></div><div class="line"><span class="comment">// 输出 72756e6f6f62</span></div><div class="line">console.<span class="built_in">log</span>(buf.<span class="built_in">toString</span>(<span class="string">'hex'</span>));</div><div class="line"></div><div class="line"><span class="comment">// 输出 cnVub29i</span></div><div class="line">console.<span class="built_in">log</span>(buf.<span class="built_in">toString</span>(<span class="string">'base64'</span>));</div></pre></td></tr></table></figure>
<p>Node.js 目前支持的字符编码包括</p>
<ul>
<li>ascii - 仅支持 7 位 ASCII 数据。如果设置去掉高位的话，这种编码是非常快的</li>
<li>utf8 - 多字节编码的 Unicode 字符。许多网页和其他文档格式都使用 UTF-8 </li>
<li>utf16le - 2 或 4 个字节，小字节序编码的 Unicode 字符。支持代理对（U+10000 至 U+10FFFF）</li>
<li>ucs2 - utf16le 的别名</li>
<li>base64 - Base64 编码</li>
<li>latin1 - 一种把 Buffer 编码成一字节编码的字符串的方式</li>
<li>binary - latin1 的别名</li>
<li>hex - 将每个字节编码为两个十六进制字</li>
</ul>
<h2 id="创建-Buffer-类"><a href="#创建-Buffer-类" class="headerlink" title="创建 Buffer 类"></a>创建 Buffer 类</h2><p>Buffer 提供了以下 API 来创建 Buffer 类</p>
<ul>
<li>Buffer.alloc(size[, fill[, encoding]])： 返回一个指定大小的 Buffer 实例，如果没有设置 fill，则默认填满 0</li>
<li>Buffer.allocUnsafe(size)： 返回一个指定大小的 Buffer 实例，但是它不会被初始化，所以它可能包含敏感的数据</li>
<li>Buffer.allocUnsafeSlow(size)</li>
<li>Buffer.from(array)： 返回一个被 array 的值初始化的新的 Buffer 实例（传入的 array 的元素只能是数字，不然就会自动被 0 覆盖）</li>
<li>Buffer.from(arrayBuffer[, byteOffset[, length]])： 返回一个新建的与给定的 ArrayBuffer 共享同一内存的 Buffer</li>
<li>Buffer.from(buffer)： 复制传入的 Buffer 实例的数据，并返回一个新的 Buffer 实例</li>
<li>Buffer.from(string[, encoding])： 返回一个被 string 的值初始化的新的 Buffer 实例</li>
</ul>
<figure class="highlight armasm"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div></pre></td><td class="code"><pre><div class="line">// 创建一个长度为 <span class="number">10</span>、且用 <span class="number">0</span> 填充的 <span class="keyword">Buffer。</span></div><div class="line"><span class="symbol">const</span> <span class="keyword">buf1 </span>= <span class="keyword">Buffer.alloc(10);</span></div><div class="line"></div><div class="line">// 创建一个长度为 <span class="number">10</span>、且用 <span class="number">0x1</span> 填充的 <span class="keyword">Buffer。 </span></div><div class="line"><span class="symbol">const</span> <span class="keyword">buf2 </span>= <span class="keyword">Buffer.alloc(10, </span><span class="number">1</span>)<span class="comment">;</span></div><div class="line"></div><div class="line">// 创建一个长度为 <span class="number">10</span>、且未初始化的 <span class="keyword">Buffer。</span></div><div class="line">// 这个方法比调用 <span class="keyword">Buffer.alloc() </span>更快，</div><div class="line">// 但返回的 <span class="keyword">Buffer </span>实例可能包含旧数据，</div><div class="line">// 因此需要使用 <span class="meta">fill</span>() 或 write() 重写。</div><div class="line"><span class="symbol">const</span> <span class="keyword">buf3 </span>= <span class="keyword">Buffer.allocUnsafe(10);</span></div><div class="line"></div><div class="line">// 创建一个包含 [<span class="number">0x1</span>, <span class="number">0x2</span>, <span class="number">0x3</span>] 的 <span class="keyword">Buffer。</span></div><div class="line"><span class="symbol">const</span> <span class="keyword">buf4 </span>= <span class="keyword">Buffer.from([1, </span><span class="number">2</span>, <span class="number">3</span>])<span class="comment">;</span></div><div class="line"></div><div class="line">// 创建一个包含 UTF-<span class="number">8</span> 字节 [<span class="number">0x74</span>, <span class="number">0xc3</span>, <span class="number">0xa9</span>, <span class="number">0x73</span>, <span class="number">0x74</span>] 的 <span class="keyword">Buffer。</span></div><div class="line"><span class="symbol">const</span> <span class="keyword">buf5 </span>= <span class="keyword">Buffer.from('tést');</span></div><div class="line"></div><div class="line">// 创建一个包含 Latin-<span class="number">1</span> 字节 [<span class="number">0x74</span>, <span class="number">0xe9</span>, <span class="number">0x73</span>, <span class="number">0x74</span>] 的 <span class="keyword">Buffer。</span></div><div class="line"><span class="symbol">const</span> <span class="keyword">buf6 </span>= <span class="keyword">Buffer.from('tést', </span><span class="string">'latin1'</span>)<span class="comment">;</span></div></pre></td></tr></table></figure>
<h2 id="写入缓冲区"><a href="#写入缓冲区" class="headerlink" title="写入缓冲区"></a>写入缓冲区</h2><p>buf.write(string[, offset[, length]][, encoding]),返回值:实际写入的大小。如果 buffer 空间不足， 则只会写入部分字符串</p>
<ul>
<li>canshu - 写入缓冲区的字符串</li>
<li>offset - 缓冲区开始写入的索引值，默认为 0 </li>
<li>length - 写入的字节数，默认为 buffer.length</li>
<li>encoding - 使用的编码。默认为 ‘utf8’</li>
</ul>
<figure class="highlight crmsh"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">buf = Buffer.alloc(<span class="number">256</span>);</div><div class="line">len = buf.<span class="keyword">write</span>(<span class="string">"www.runoob.com"</span>);</div><div class="line"></div><div class="line">console.log(<span class="string">"写入字节数 : "</span>+  len);</div><div class="line"></div><div class="line">// 输出</div><div class="line">// <span class="keyword">node</span> <span class="title">main</span>.js</div><div class="line">写入字节数 : <span class="number">14</span></div></pre></td></tr></table></figure>
<h2 id="从缓冲区读取数据"><a href="#从缓冲区读取数据" class="headerlink" title="从缓冲区读取数据"></a>从缓冲区读取数据</h2><p>buf.toString([encoding[, start[, end]]]),返回值:解码缓冲区数据并使用指定的编码返回字符串</p>
<ul>
<li>encoding - 使用的编码。默认为 ‘utf8’</li>
<li>start - 指定开始读取的索引位置，默认为 0</li>
<li>end - 结束位置，默认为缓冲区的末尾</li>
</ul>
<figure class="highlight sqf"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line">buf = Buffer.alloc(<span class="number">26</span>);</div><div class="line"><span class="keyword">for</span> (var i = <span class="number">0</span> ; i &lt; <span class="number">26</span> ; i++) &#123;</div><div class="line">  buf[i] = i + <span class="number">97</span>;</div><div class="line">&#125;</div><div class="line"></div><div class="line">console.<span class="built_in">log</span>( buf.<span class="built_in">toString</span>(<span class="string">'ascii'</span>));       <span class="comment">// 输出: abcdefghijklmnopqrstuvwxyz</span></div><div class="line">console.<span class="built_in">log</span>( buf.<span class="built_in">toString</span>(<span class="string">'ascii'</span>,<span class="number">0</span>,<span class="number">5</span>));   <span class="comment">// 输出: abcde</span></div><div class="line">console.<span class="built_in">log</span>( buf.<span class="built_in">toString</span>(<span class="string">'utf8'</span>,<span class="number">0</span>,<span class="number">5</span>));    <span class="comment">// 输出: abcde</span></div><div class="line">console.<span class="built_in">log</span>( buf.<span class="built_in">toString</span>(undefined,<span class="number">0</span>,<span class="number">5</span>)); <span class="comment">// 使用 'utf8' 编码, 并输出: abcde</span></div><div class="line"></div><div class="line"><span class="comment">// 输出</span></div><div class="line"><span class="comment">// node main.js</span></div><div class="line">abcdefghijklmnopqrstuvwxyz</div><div class="line">abcde</div><div class="line">abcde</div><div class="line">abcde</div></pre></td></tr></table></figure>
<h2 id="将-Buffer-转换为-JSON-对象"><a href="#将-Buffer-转换为-JSON-对象" class="headerlink" title="将 Buffer 转换为 JSON 对象"></a>将 Buffer 转换为 JSON 对象</h2><p>buf.toJSON(),返回值:返回 JSON 对象</p>
<figure class="highlight cs"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">const</span> buf = Buffer.<span class="keyword">from</span>([<span class="number">0x1</span>, <span class="number">0x2</span>, <span class="number">0x3</span>, <span class="number">0x4</span>, <span class="number">0x5</span>]);</div><div class="line"><span class="keyword">const</span> json = JSON.stringify(buf);</div><div class="line"></div><div class="line"><span class="comment">// 输出: &#123;"type":"Buffer","data":[1,2,3,4,5]&#125;</span></div><div class="line">console.log(json);</div><div class="line"></div><div class="line"><span class="keyword">const</span> copy = JSON.parse(json, (key, <span class="keyword">value</span>) =&gt; &#123;</div><div class="line">  <span class="keyword">return</span> <span class="keyword">value</span> &amp;&amp; <span class="keyword">value</span>.type === <span class="string">'Buffer'</span> ?</div><div class="line">    Buffer.<span class="keyword">from</span>(<span class="keyword">value</span>.data) :</div><div class="line">    <span class="keyword">value</span>;</div><div class="line">&#125;);</div><div class="line"></div><div class="line"><span class="comment">// 输出: &lt;Buffer 01 02 03 04 05&gt;</span></div><div class="line">console.log(copy);</div><div class="line"></div><div class="line"><span class="comment">// 输出</span></div><div class="line">&#123;<span class="string">"type"</span>:<span class="string">"Buffer"</span>,<span class="string">"data"</span>:[<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>,<span class="number">5</span>]&#125;</div><div class="line">&lt;Buffer <span class="number">01</span> <span class="number">02</span> <span class="number">03</span> <span class="number">04</span> <span class="number">05</span>&gt;</div></pre></td></tr></table></figure>
<h2 id="缓冲区合并"><a href="#缓冲区合并" class="headerlink" title="缓冲区合并"></a>缓冲区合并</h2><p>Buffer.concat(list[, totalLength]),返回一个多个成员合并的新 Buffer 对象</p>
<ul>
<li>list - 用于合并的 Buffer 对象数组列表</li>
<li>totalLength - 指定合并后Buffer对象的总长度</li>
</ul>
<figure class="highlight armasm"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="symbol">var</span> <span class="keyword">buffer1 </span>= <span class="keyword">Buffer.from(('张扬教程'));</span></div><div class="line"><span class="symbol">var</span> <span class="keyword">buffer2 </span>= <span class="keyword">Buffer.from(('www.zhangyang.com'));</span></div><div class="line"><span class="symbol">var</span> <span class="keyword">buffer3 </span>= <span class="keyword">Buffer.concat([buffer1,buffer2]);</span></div><div class="line"><span class="symbol">console.log</span>(<span class="string">"buffer3 内容: "</span> + <span class="keyword">buffer3.toString());</span></div><div class="line"></div><div class="line">// 输出</div><div class="line"><span class="keyword">buffer3 </span>内容: 张扬教程 www.zhangyang.com</div></pre></td></tr></table></figure>
<h2 id="缓冲区比较"><a href="#缓冲区比较" class="headerlink" title="缓冲区比较"></a>缓冲区比较</h2><p>buf.compare(otherBuffer),返回值:返回一个数字，表示 buf 在 otherBuffer 之前，之后或相同</p>
<ul>
<li>与 buf 对象比较的另外一个 Buffer 对象</li>
</ul>
<figure class="highlight armasm"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line"><span class="symbol">var</span> <span class="keyword">buffer1 </span>= <span class="keyword">Buffer.from('ABC');</span></div><div class="line"><span class="symbol">var</span> <span class="keyword">buffer2 </span>= <span class="keyword">Buffer.from('ABCD');</span></div><div class="line"><span class="symbol">var</span> result = <span class="keyword">buffer1.compare(buffer2);</span></div><div class="line"></div><div class="line"><span class="symbol">if</span>(result &lt; <span class="number">0</span>) &#123;</div><div class="line">   console.log(<span class="keyword">buffer1 </span>+ <span class="string">" 在 "</span> + <span class="keyword">buffer2 </span>+ <span class="string">"之前"</span>)<span class="comment">;</span></div><div class="line">&#125;<span class="meta">else</span> <span class="meta">if</span>(result == <span class="number">0</span>)&#123;</div><div class="line">   console.log(<span class="keyword">buffer1 </span>+ <span class="string">" 与 "</span> + <span class="keyword">buffer2 </span>+ <span class="string">"相同"</span>)<span class="comment">;</span></div><div class="line">&#125;<span class="meta">else</span> &#123;</div><div class="line">   console.log(<span class="keyword">buffer1 </span>+ <span class="string">" 在 "</span> + <span class="keyword">buffer2 </span>+ <span class="string">"之后"</span>)<span class="comment">;</span></div><div class="line">&#125;</div><div class="line"></div><div class="line">// 输出</div><div class="line"><span class="symbol">ABC</span>再ABCD之前</div></pre></td></tr></table></figure>
<h2 id="拷贝缓冲区"><a href="#拷贝缓冲区" class="headerlink" title="拷贝缓冲区"></a>拷贝缓冲区</h2><p>buf.copy(targetBuffer[, targetStart[, sourceStart[, sourceEnd]]]),没有返回值</p>
<ul>
<li>targetBuffer - 要拷贝的 Buffer 对象</li>
<li>targetStart - 数字, 可选, 默认: 0</li>
<li>sourceStart - 数字, 可选, 默认: 0</li>
<li>sourceEnd - 数字, 可选, 默认: buffer.length</li>
</ul>
<figure class="highlight armasm"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line"><span class="symbol">var</span> <span class="keyword">buf1 </span>= <span class="keyword">Buffer.from('abcdefghijkl');</span></div><div class="line"><span class="symbol">var</span> <span class="keyword">buf2 </span>= <span class="keyword">Buffer.from('RUNOOB');</span></div><div class="line"></div><div class="line">//将 <span class="keyword">buf2 </span>插入到 <span class="keyword">buf1 </span>指定位置上</div><div class="line"><span class="keyword">buf2.copy(buf1, </span><span class="number">2</span>)<span class="comment">;</span></div><div class="line"></div><div class="line"><span class="symbol">console.log</span>(<span class="keyword">buf1.toString());</span></div><div class="line"></div><div class="line">// 输出</div><div class="line"><span class="symbol">abRUNOOBijkl</span></div></pre></td></tr></table></figure>
<h2 id="缓冲区裁剪"><a href="#缓冲区裁剪" class="headerlink" title="缓冲区裁剪"></a>缓冲区裁剪</h2><p>buf.slice([start[, end]]),返回值:返回一个新的缓冲区，它和旧缓冲区指向同一块内存，但是从索引 start 到 end 的位置剪切</p>
<ul>
<li>start - 数字, 可选, 默认: 0</li>
<li>end - 数字, 可选, 默认: buffer.length</li>
</ul>
<figure class="highlight stata"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> buffer1 = Buffer.from('runoob');</div><div class="line"><span class="comment">// 剪切缓冲区</span></div><div class="line"><span class="keyword">var</span> buffer2 = buffer1.slice(0,2);</div><div class="line">console.<span class="built_in">log</span>(<span class="string">"buffer2 content: "</span> + buffer2.<span class="keyword">toString</span>());</div><div class="line"></div><div class="line"><span class="comment">// 输出</span></div><div class="line">buffer2 content: <span class="keyword">ru</span></div></pre></td></tr></table></figure>
<h2 id="缓冲区长度"><a href="#缓冲区长度" class="headerlink" title="缓冲区长度"></a>缓冲区长度</h2><p>buf.length,返回值:返回 Buffer 对象所占据的内存长度</p>
<figure class="highlight arduino"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">var <span class="built_in">buffer</span> = Buffer.from(<span class="string">'www.runoob.com'</span>);</div><div class="line"><span class="comment">//  缓冲区长度</span></div><div class="line">console.log(<span class="string">"buffer length: "</span> + <span class="built_in">buffer</span>.length);</div><div class="line"></div><div class="line"><span class="comment">// 输出</span></div><div class="line"><span class="built_in">buffer</span> length: <span class="number">14</span></div></pre></td></tr></table></figure>
<h1 id="Stream-流"><a href="#Stream-流" class="headerlink" title="Stream(流)"></a>Stream(流)</h1><p>Stream 是一个抽象接口，Node 中有很多对象实现了这个接口</p>
<p>Node.js，Stream 有四种流类型</p>
<ul>
<li>Readable - 可读操作</li>
<li>Writable - 可写操作</li>
<li>Duplex - 可读可写操作</li>
<li>Transform - 操作被写入数据，然后读出结果</li>
</ul>
<p>所有的 Stream 对象都是 EventEmitter 的实例。常用的事件有</p>
<ul>
<li>data - 当有数据可读时触发</li>
<li>end - 没有更多的数据可读时触发</li>
<li>error - 在接收和写入过程中发生错误时触发</li>
<li>finish - 所有数据已被写入到底层系统时触发</li>
</ul>
<h2 id="从流中读取数据"><a href="#从流中读取数据" class="headerlink" title="从流中读取数据"></a>从流中读取数据</h2><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// 创建 input.txt 文件</span></div><div class="line">菜鸟教程官网地址：www.runoob.com</div><div class="line"></div><div class="line"><span class="comment">// 创建 main.js 文件</span></div><div class="line"><span class="keyword">var</span> fs = <span class="built_in">require</span>(<span class="string">"fs"</span>);</div><div class="line"><span class="keyword">var</span> data = <span class="string">''</span>;</div><div class="line"></div><div class="line"><span class="comment">// 创建可读流</span></div><div class="line"><span class="keyword">var</span> readerStream = fs.createReadStream(<span class="string">'input.txt'</span>);</div><div class="line"></div><div class="line"><span class="comment">// 设置编码为 utf8。</span></div><div class="line">readerStream.setEncoding(<span class="string">'UTF8'</span>);</div><div class="line"></div><div class="line"><span class="comment">// 处理流事件 --&gt; data, end, and error</span></div><div class="line">readerStream.on(<span class="string">'data'</span>, <span class="function"><span class="keyword">function</span>(<span class="params">chunk</span>) </span>&#123;</div><div class="line">   data += chunk;</div><div class="line">&#125;);</div><div class="line"></div><div class="line">readerStream.on(<span class="string">'end'</span>,<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</div><div class="line">   <span class="built_in">console</span>.log(data);</div><div class="line">&#125;);</div><div class="line"></div><div class="line">readerStream.on(<span class="string">'error'</span>, <span class="function"><span class="keyword">function</span>(<span class="params">err</span>)</span>&#123;</div><div class="line">   <span class="built_in">console</span>.log(err.stack);</div><div class="line">&#125;);</div><div class="line"></div><div class="line"><span class="built_in">console</span>.log(<span class="string">"程序执行完毕"</span>);</div><div class="line"></div><div class="line"><span class="comment">// 运行 node main.js</span></div><div class="line">程序执行完毕</div><div class="line">菜鸟教程官网地址：www.runoob.com</div></pre></td></tr></table></figure>
<h2 id="写入流"><a href="#写入流" class="headerlink" title="写入流"></a>写入流</h2><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// 创建 main.js 文件</span></div><div class="line"><span class="keyword">var</span> fs = <span class="built_in">require</span>(<span class="string">"fs"</span>);</div><div class="line"><span class="keyword">var</span> data = <span class="string">'菜鸟教程官网地址：www.runoob.com'</span>;</div><div class="line"></div><div class="line"><span class="comment">// 创建一个可以写入的流，写入到文件 output.txt 中</span></div><div class="line"><span class="keyword">var</span> writerStream = fs.createWriteStream(<span class="string">'output.txt'</span>);</div><div class="line"></div><div class="line"><span class="comment">// 使用 utf8 编码写入数据</span></div><div class="line">writerStream.write(data,<span class="string">'UTF8'</span>);</div><div class="line"></div><div class="line"><span class="comment">// 标记文件末尾</span></div><div class="line">writerStream.end();</div><div class="line"></div><div class="line"><span class="comment">// 处理流事件 --&gt; data, end, and error</span></div><div class="line">writerStream.on(<span class="string">'finish'</span>, <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</div><div class="line">    <span class="built_in">console</span>.log(<span class="string">"写入完成。"</span>);</div><div class="line">&#125;);</div><div class="line"></div><div class="line">writerStream.on(<span class="string">'error'</span>, <span class="function"><span class="keyword">function</span>(<span class="params">err</span>)</span>&#123;</div><div class="line">   <span class="built_in">console</span>.log(err.stack);</div><div class="line">&#125;);</div><div class="line"></div><div class="line"><span class="built_in">console</span>.log(<span class="string">"程序执行完毕"</span>);</div><div class="line"></div><div class="line"><span class="comment">// 将 data 变量的数据写入到 output.txt 文件中</span></div><div class="line"><span class="comment">// 运行 node main.js</span></div><div class="line">程序执行完毕</div><div class="line">写入完成。</div><div class="line"></div><div class="line"><span class="comment">// 查看output.txt文件的内容</span></div><div class="line">cat output.txt</div><div class="line">菜鸟教程官网地址：www.runoob.com</div></pre></td></tr></table></figure>
<h2 id="管道流"><a href="#管道流" class="headerlink" title="管道流"></a>管道流</h2><p>管道提供了一个输出流到输入流的机制。通常我们用于从一个流中获取数据并将数据传递到另外一个流中</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// 设置 input.txt 文件内容</span></div><div class="line">菜鸟教程官网地址：www.runoob.com</div><div class="line">管道流操作实例</div><div class="line"></div><div class="line"><span class="comment">// 创建 main.js 文件</span></div><div class="line"><span class="keyword">var</span> fs = <span class="built_in">require</span>(<span class="string">"fs"</span>);</div><div class="line"></div><div class="line"><span class="comment">// 创建一个可读流</span></div><div class="line"><span class="keyword">var</span> readerStream = fs.createReadStream(<span class="string">'input.txt'</span>);</div><div class="line"></div><div class="line"><span class="comment">// 创建一个可写流</span></div><div class="line"><span class="keyword">var</span> writerStream = fs.createWriteStream(<span class="string">'output.txt'</span>);</div><div class="line"></div><div class="line"><span class="comment">// 管道读写操作</span></div><div class="line"><span class="comment">// 读取 input.txt 文件内容，并将内容写入到 output.txt 文件中</span></div><div class="line">readerStream.pipe(writerStream);</div><div class="line"></div><div class="line"><span class="built_in">console</span>.log(<span class="string">"程序执行完毕"</span>);</div><div class="line"></div><div class="line"><span class="comment">// node main.js </span></div><div class="line">程序执行完毕</div><div class="line"></div><div class="line"><span class="comment">// 查看 output.txt 文件的内容</span></div><div class="line">cat output.txt </div><div class="line">菜鸟教程官网地址：www.runoob.com</div><div class="line">管道流操作实例</div></pre></td></tr></table></figure>
<h2 id="链式流"><a href="#链式流" class="headerlink" title="链式流"></a>链式流</h2><p>链式是通过连接输出流到另外一个流并创建多个流操作链的机制。链式流一般用于管道操作</p>
<p>用管道和链式来压缩和解压文件</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// 当前目录下生成了 input.txt 的压缩文件 input.txt.gz</span></div><div class="line"><span class="comment">// 创建 compress.js 文件</span></div><div class="line"><span class="keyword">var</span> fs = <span class="built_in">require</span>(<span class="string">"fs"</span>);</div><div class="line"><span class="keyword">var</span> zlib = <span class="built_in">require</span>(<span class="string">'zlib'</span>);</div><div class="line"></div><div class="line"><span class="comment">// 压缩 input.txt 文件为 input.txt.gz</span></div><div class="line">fs.createReadStream(<span class="string">'input.txt'</span>)</div><div class="line">  .pipe(zlib.createGzip())</div><div class="line">  .pipe(fs.createWriteStream(<span class="string">'input.txt.gz'</span>));</div><div class="line">  </div><div class="line"><span class="built_in">console</span>.log(<span class="string">"文件压缩完成。"</span>);</div><div class="line"></div><div class="line"><span class="comment">// 运行 node compress.js </span></div><div class="line">文件压缩完成。</div></pre></td></tr></table></figure>
<p>解压该文件，创建 decompress.js 文件</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> fs = <span class="built_in">require</span>(<span class="string">"fs"</span>);</div><div class="line"><span class="keyword">var</span> zlib = <span class="built_in">require</span>(<span class="string">'zlib'</span>);</div><div class="line"></div><div class="line"><span class="comment">// 解压 input.txt.gz 文件为 input.txt</span></div><div class="line">fs.createReadStream(<span class="string">'input.txt.gz'</span>)</div><div class="line">  .pipe(zlib.createGunzip())</div><div class="line">  .pipe(fs.createWriteStream(<span class="string">'input.txt'</span>));</div><div class="line">  </div><div class="line"><span class="built_in">console</span>.log(<span class="string">"文件解压完成。"</span>);</div><div class="line"></div><div class="line"><span class="comment">// 运行 node decompress.js </span></div><div class="line">文件解压完成。</div></pre></td></tr></table></figure>
<h1 id="模块系统"><a href="#模块系统" class="headerlink" title="模块系统"></a>模块系统</h1><p>为了让Node.js的文件可以相互调用，Node.js提供了一个简单的模块系统</p>
<p>Node.js 提供了 exports 和 require 两个对象</p>
<ul>
<li>exports 是模块公开的接口</li>
<li>require 用于从外部获取一个模块的接口，即所获取模块的 exports 对象</li>
</ul>
<h2 id="创建模块-1"><a href="#创建模块-1" class="headerlink" title="创建模块"></a>创建模块</h2><p>hello.js 通过 exports 对象把 world 作为模块的访问接口</p>
<p>main.js 中通过 require(‘./hello’) 加载这个模块</p>
<p>直接访 问 hello.js 中 exports 对象的成员函数</p>
<p>创建一个 main.js 文件</p>
<figure class="highlight coffeescript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="regexp">//</span>  <span class="built_in">require</span>(<span class="string">'./hello'</span>) 引入了当前目录下的 hello.js 文件</div><div class="line">var hello = <span class="built_in">require</span>(<span class="string">'./hello'</span>);</div><div class="line">hello.world();</div></pre></td></tr></table></figure>
<p>创建 hello.js 文件</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">exports.world = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</div><div class="line">  <span class="built_in">console</span>.log(<span class="string">'Hello World'</span>);</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>把一个对象封装到模块中</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line"><span class="comment">//hello.js </span></div><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">Hello</span>(<span class="params"></span>) </span>&#123; </div><div class="line">    <span class="keyword">var</span> name; </div><div class="line">    <span class="keyword">this</span>.setName = <span class="function"><span class="keyword">function</span>(<span class="params">thyName</span>) </span>&#123; </div><div class="line">        name = thyName; </div><div class="line">    &#125;; </div><div class="line">    <span class="keyword">this</span>.sayHello = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123; </div><div class="line">        <span class="built_in">console</span>.log(<span class="string">'Hello '</span> + name); </div><div class="line">    &#125;; </div><div class="line">&#125;; </div><div class="line"><span class="built_in">module</span>.exports = Hello;</div></pre></td></tr></table></figure>
<p>获得这个对象</p>
<figure class="highlight haxe"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="comment">//main.js </span></div><div class="line"><span class="keyword">var</span> Hello = require(<span class="string">'./hello'</span>); </div><div class="line">hello = <span class="keyword">new</span> <span class="type">Hello</span>(); </div><div class="line">hello.setName(<span class="string">'BYVoid'</span>); </div><div class="line">hello.sayHello();</div></pre></td></tr></table></figure>
<h2 id="服务端的模块加载"><a href="#服务端的模块加载" class="headerlink" title="服务端的模块加载"></a>服务端的模块加载</h2><p>Node.js 的 require 方法中的文件查找策略:4 类模块(原生模块和3种文件模块)</p>
<p>从文件模块缓存中加载:尽管原生模块与文件模块的优先级不同，但是都会优先从文件模块的缓存中加载已经存在的模块</p>
<p>从原生模块加载:原生模块的优先级仅次于文件模块缓存的优先级。require 方法在解析文件名之后，优先检查模块是否在原生模块列表中</p>
<p>从文件加载:当文件模块缓存中不存在,而且不是原生模块的时候,Node.js会解析require方法传入的参数，并从文件系统中加载实际的文件</p>
<p>require方法接受以下几种参数的传递</p>
<ul>
<li>http、fs、path等，原生模块</li>
<li>./mod或../mod，相对路径的文件模块</li>
<li>/pathtomodule/mod，绝对路径的文件模块</li>
<li>mod，非原生模块的文件模块</li>
</ul>
<h1 id="函数"><a href="#函数" class="headerlink" title="函数"></a>函数</h1><p>Node.js中函数的使用与Javascript类似</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">say</span>(<span class="params">word</span>) </span>&#123;</div><div class="line">  <span class="built_in">console</span>.log(word);</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">execute</span>(<span class="params">someFunction, value</span>) </span>&#123;</div><div class="line">  someFunction(value);</div><div class="line">&#125;</div><div class="line"></div><div class="line">execute(say, <span class="string">"Hello"</span>);</div></pre></td></tr></table></figure>
<h2 id="匿名函数"><a href="#匿名函数" class="headerlink" title="匿名函数"></a>匿名函数</h2><p>没有名字的函数叫做匿名函数</p>
<figure class="highlight fortran"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">function</span></span> execute(someFunction, <span class="keyword">value</span>) &#123;</div><div class="line">  someFunction(<span class="keyword">value</span>);</div><div class="line">&#125;</div><div class="line"></div><div class="line">execute(<span class="function"><span class="keyword">function</span><span class="params">(word)</span></span>&#123; console.<span class="built_in">log</span>(word) &#125;, <span class="string">"Hello"</span>);</div></pre></td></tr></table></figure>
<h2 id="HTTP服务器工作机制"><a href="#HTTP服务器工作机制" class="headerlink" title="HTTP服务器工作机制"></a>HTTP服务器工作机制</h2><p>我们向 createServer 函数传递了一个匿名函数</p>
<figure class="highlight vbscript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">var http = require(<span class="string">"http"</span>);</div><div class="line"></div><div class="line">http.createServer(<span class="keyword">function</span>(<span class="built_in">request</span>, <span class="built_in">response</span>) &#123;</div><div class="line">  <span class="built_in">response</span>.writeHead(<span class="number">200</span>, &#123;<span class="string">"Content-Type"</span>: <span class="string">"text/plain"</span>&#125;);</div><div class="line">  <span class="built_in">response</span>.write(<span class="string">"Hello World"</span>);</div><div class="line">  <span class="built_in">response</span>.<span class="keyword">end</span>();</div><div class="line">&#125;).listen(<span class="number">8888</span>);</div></pre></td></tr></table></figure>
<p>用这样的代码也可以达到同样的目的</p>
<figure class="highlight vbscript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">var http = require(<span class="string">"http"</span>);</div><div class="line"></div><div class="line"><span class="keyword">function</span> onRequest(<span class="built_in">request</span>, <span class="built_in">response</span>) &#123;</div><div class="line">  <span class="built_in">response</span>.writeHead(<span class="number">200</span>, &#123;<span class="string">"Content-Type"</span>: <span class="string">"text/plain"</span>&#125;);</div><div class="line">  <span class="built_in">response</span>.write(<span class="string">"Hello World"</span>);</div><div class="line">  <span class="built_in">response</span>.<span class="keyword">end</span>();</div><div class="line">&#125;</div><div class="line"></div><div class="line">http.createServer(onRequest).listen(<span class="number">8888</span>);</div></pre></td></tr></table></figure>
<h1 id="路由"><a href="#路由" class="headerlink" title="路由"></a>路由</h1><p>为路由提供请求的 URL 和其他需要的 GET 及 POST 参数，随后路由需要根据这些数据来执行相应的代码</p>
<p>所有数据都会包含在 request 对象中，该对象作为 onRequest() 回调函数的第一个参数传递</p>
<p>解析这些数据，需要Node.JS 模块，它们分别是 url 和 querystring 模块</p>
<figure class="highlight gauss"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">如:http:<span class="comment">//localhost:8888/start?foo=bar&amp;hello=world</span></div><div class="line"></div><div class="line">url.<span class="built_in">parse</span>(<span class="keyword">string</span>).query <span class="comment">// foo=bar&amp;hello=world</span></div><div class="line">url.<span class="built_in">parse</span>(<span class="keyword">string</span>).pathname <span class="comment">// start</span></div><div class="line">querystring.<span class="built_in">parse</span>(queryString)[<span class="string">"foo"</span>] <span class="comment">// bar</span></div><div class="line">querystring.<span class="built_in">parse</span>(queryString)[<span class="string">"hello"</span>] <span class="comment">// world</span></div></pre></td></tr></table></figure>
<p>onRequest() 函数加上一些逻辑，用来找出浏览器请求的 URL 路径</p>
<figure class="highlight qml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// server.js</span></div><div class="line"><span class="built_in">var</span> http = <span class="built_in">require</span>(<span class="string">"http"</span>);</div><div class="line"><span class="built_in">var</span> <span class="built_in">url</span> = <span class="built_in">require</span>(<span class="string">"url"</span>);</div><div class="line"> </div><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">start</span>(<span class="params"></span>) </span>&#123;</div><div class="line">  <span class="function"><span class="keyword">function</span> <span class="title">onRequest</span>(<span class="params">request, response</span>) </span>&#123;</div><div class="line">    <span class="built_in">var</span> pathname = <span class="built_in">url</span>.parse(request.url).pathname;</div><div class="line">    <span class="built_in">console</span>.log(<span class="string">"Request for "</span> + pathname + <span class="string">" received."</span>);</div><div class="line">    response.writeHead(<span class="number">200</span>, &#123;<span class="string">"Content-Type"</span>: <span class="string">"text/plain"</span>&#125;);</div><div class="line">    response.write(<span class="string">"Hello World"</span>);</div><div class="line">    response.end();</div><div class="line">  &#125;</div><div class="line"> </div><div class="line">  http.createServer(onRequest).listen(<span class="number">8888</span>);</div><div class="line">  <span class="built_in">console</span>.log(<span class="string">"Server has started."</span>);</div><div class="line">&#125;</div><div class="line"> </div><div class="line">exports.start = start;</div></pre></td></tr></table></figure>
<p>编写路由,新建router.js</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">route</span>(<span class="params">pathname</span>) </span>&#123;</div><div class="line">  <span class="built_in">console</span>.log(<span class="string">"About to route a request for "</span> + pathname);</div><div class="line">&#125;</div><div class="line"> </div><div class="line">exports.route = route;</div></pre></td></tr></table></figure>
<p>路由和服务器整合</p>
<figure class="highlight qml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// 扩展一下服务器的 start() 函数，以便将路由函数作为参数传递过去</span></div><div class="line"><span class="comment">// server.js 文件</span></div><div class="line"><span class="built_in">var</span> http = <span class="built_in">require</span>(<span class="string">"http"</span>);</div><div class="line"><span class="built_in">var</span> <span class="built_in">url</span> = <span class="built_in">require</span>(<span class="string">"url"</span>);</div><div class="line"> </div><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">start</span>(<span class="params">route</span>) </span>&#123;</div><div class="line">  <span class="function"><span class="keyword">function</span> <span class="title">onRequest</span>(<span class="params">request, response</span>) </span>&#123;</div><div class="line">    <span class="built_in">var</span> pathname = <span class="built_in">url</span>.parse(request.url).pathname;</div><div class="line">    <span class="built_in">console</span>.log(<span class="string">"Request for "</span> + pathname + <span class="string">" received."</span>);</div><div class="line"> </div><div class="line">    route(pathname);</div><div class="line"> </div><div class="line">    response.writeHead(<span class="number">200</span>, &#123;<span class="string">"Content-Type"</span>: <span class="string">"text/plain"</span>&#125;);</div><div class="line">    response.write(<span class="string">"Hello World"</span>);</div><div class="line">    response.end();</div><div class="line">  &#125;</div><div class="line"> </div><div class="line">  http.createServer(onRequest).listen(<span class="number">8888</span>);</div><div class="line">  <span class="built_in">console</span>.log(<span class="string">"Server has started."</span>);</div><div class="line">&#125;</div><div class="line"> </div><div class="line">exports.start = start;</div><div class="line"></div><div class="line"><span class="comment">// 相应扩展 index.js，使得路由函数可以被注入到服务器中</span></div><div class="line"><span class="comment">// index.js</span></div><div class="line"><span class="built_in">var</span> server = <span class="built_in">require</span>(<span class="string">"./server"</span>);</div><div class="line"><span class="built_in">var</span> router = <span class="built_in">require</span>(<span class="string">"./router"</span>);</div><div class="line"> </div><div class="line">server.start(router.route);</div><div class="line"></div><div class="line"><span class="comment">// 运行命令</span></div><div class="line">node index.js</div><div class="line">Server has started.</div></pre></td></tr></table></figure>
<h1 id="全局对象"><a href="#全局对象" class="headerlink" title="全局对象"></a>全局对象</h1><p>Node.js 中的全局对象是 global，所有全局变量都是 global 对象的属性</p>
<h2 id="filename"><a href="#filename" class="headerlink" title="__filename"></a>__filename</h2><p>当前正在执行的脚本的文件名,输出文件所在位置的绝对路径</p>
<figure class="highlight awk"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="regexp">//</span> main.js</div><div class="line"><span class="regexp">//</span> 输出全局变量 __filename 的值</div><div class="line">console.log( __filename );</div><div class="line"></div><div class="line"><span class="regexp">//</span> 运行命令行</div><div class="line">node main.js</div><div class="line"><span class="regexp">/web/</span>com<span class="regexp">/runoob/</span>nodejs<span class="regexp">/main.js</span></div></pre></td></tr></table></figure>
<h2 id="dirname"><a href="#dirname" class="headerlink" title="__dirname"></a>__dirname</h2><p>当前执行脚本所在的目录</p>
<figure class="highlight awk"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="regexp">//</span> main.js</div><div class="line"><span class="regexp">//</span> 输出全局变量 __dirname 的值</div><div class="line">console.log( __dirname );</div><div class="line"></div><div class="line"><span class="regexp">//</span> 运行命令行</div><div class="line">node main.js</div><div class="line"><span class="regexp">/web/</span>com<span class="regexp">/runoob/</span>nodejs</div></pre></td></tr></table></figure>
<h2 id="process"><a href="#process" class="headerlink" title="process"></a>process</h2><p>当前Node.js 进程状态的对象，提供了一个与操作系统的简单接口</p>
<p>常用的方法</p>
<ul>
<li>exit: 当进程准备退出时触发</li>
<li>beforeExit: 当 node 清空事件循环，并且没有其他安排时触发这个事件</li>
<li>uncaughtException: 当一个异常冒泡回到事件循环，触发这个事件</li>
<li>Signal事件: 当进程接收到信号时就触发</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// main.js</span></div><div class="line">process.on(<span class="string">'exit'</span>, <span class="function"><span class="keyword">function</span>(<span class="params">code</span>) </span>&#123;</div><div class="line"></div><div class="line">  <span class="comment">// 以下代码永远不会执行</span></div><div class="line">  setTimeout(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</div><div class="line">    <span class="built_in">console</span>.log(<span class="string">"该代码不会执行"</span>);</div><div class="line">  &#125;, <span class="number">0</span>);</div><div class="line">  </div><div class="line">  <span class="built_in">console</span>.log(<span class="string">'退出码为:'</span>, code);</div><div class="line">&#125;);</div><div class="line"><span class="built_in">console</span>.log(<span class="string">"程序执行结束"</span>);</div><div class="line"></div><div class="line">运行命令行 node main.js</div><div class="line">程序执行结束</div><div class="line">退出码为: <span class="number">0</span></div></pre></td></tr></table></figure>
<p>退出状态码</p>
<ul>
<li>1-Uncaught Fatal Exception:有未捕获异常，并且没有被域或 uncaughtException 处理函数处理</li>
<li>2-Unused:保留</li>
<li>3-Internal JavaScript Parse Error:JavaScript的源码启动 Node 进程时引起解析错误</li>
<li>4-Internal JavaScript Evaluation Failure:JavaScript 的源码启动 Node 进程，评估时返回函数失败</li>
<li>5-Fatal Error:V8 里致命的不可恢复的错误。通常会打印到 stderr ，内容为： FATAL ERROR</li>
<li>6-Non-function Internal Exception Handler:未捕获异常，内部异常处理函数不知为何设置为on-function，并且不能被调用</li>
<li>7-Internal Exception Handler Run-Time Failure:未捕获的异常， 并且异常处理函数处理时自己抛出了异常</li>
<li>8-Unused:保留</li>
<li>9-Invalid Argument:可能是给了未知的参数，或者给的参数没有值</li>
<li>10-Internal JavaScript Run-Time Failure:JavaScript的源码启动 Node 进程时抛出错误</li>
<li>12-Invalid Debug Argument:设置了参数–debug 和/或 –debug-brk，但是选择了错误端口</li>
<li>128-Signal Exits:如果 Node 接收到致命信号，比如SIGKILL 或 SIGHUP，那么退出代码就是128 加信号代码</li>
</ul>
<p>Process 属性</p>
<p>Process 提供了很多有用的属性，便于我们更好的控制系统的交互(查文档)</p>
<figure class="highlight crmsh"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div></pre></td><td class="code"><pre><div class="line">// main.js</div><div class="line">// 输出到终端</div><div class="line">process.stdout.<span class="keyword">write</span>(<span class="string">"Hello World!"</span> + <span class="string">"\n"</span>);</div><div class="line"></div><div class="line">// 通过参数读取</div><div class="line">process.argv.forEach(function(val, index, array) &#123;</div><div class="line">   console.log(index + ': ' + val);</div><div class="line">&#125;);</div><div class="line"></div><div class="line">// 获取执行路径</div><div class="line">console.log(process.execPath);</div><div class="line"></div><div class="line"></div><div class="line">// 平台信息</div><div class="line">console.log(process.platform);</div><div class="line"></div><div class="line">// 运行命令行</div><div class="line"><span class="keyword">node</span> <span class="title">main</span>.js</div><div class="line">Hello World!</div><div class="line"><span class="number">0</span>: <span class="keyword">node</span></div><div class="line">1:<span class="title"> /web</span>/www/<span class="keyword">node</span><span class="title">/main</span>.js</div><div class="line">/usr/local/<span class="keyword">node</span><span class="title">/0</span>.<span class="number">10.36</span>/bin/<span class="keyword">node</span></div><div class="line"><span class="title">darwin</span></div></pre></td></tr></table></figure>
<h1 id="常用工具"><a href="#常用工具" class="headerlink" title="常用工具"></a>常用工具</h1><p>util 是一个Node.js 核心模块，提供常用函数的集合</p>
<h2 id="util-inherits"><a href="#util-inherits" class="headerlink" title="util.inherits"></a>util.inherits</h2><p>util.inherits(constructor, superConstructor)是一个实现对象间原型继承 的函数</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// 定义了一个基础对象Base 和一个继承自Base 的Sub，Base 有三个在构造函数 内定义的属性和一个原型中定义的函数，通过util.inherits 实现继承</span></div><div class="line"><span class="keyword">var</span> util = <span class="built_in">require</span>(<span class="string">'util'</span>); </div><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">Base</span>(<span class="params"></span>) </span>&#123; </div><div class="line">    <span class="keyword">this</span>.name = <span class="string">'base'</span>; </div><div class="line">    <span class="keyword">this</span>.base = <span class="number">1991</span>; </div><div class="line">    <span class="keyword">this</span>.sayHello = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123; </div><div class="line">    <span class="built_in">console</span>.log(<span class="string">'Hello '</span> + <span class="keyword">this</span>.name); </div><div class="line">    &#125;; </div><div class="line">&#125; </div><div class="line">Base.prototype.showName = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123; </div><div class="line">    <span class="built_in">console</span>.log(<span class="keyword">this</span>.name);</div><div class="line">&#125;; </div><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">Sub</span>(<span class="params"></span>) </span>&#123; </div><div class="line">    <span class="keyword">this</span>.name = <span class="string">'sub'</span>; </div><div class="line">&#125; </div><div class="line">util.inherits(Sub, Base); </div><div class="line"><span class="keyword">var</span> objBase = <span class="keyword">new</span> Base(); </div><div class="line">objBase.showName(); </div><div class="line">objBase.sayHello(); </div><div class="line"><span class="built_in">console</span>.log(objBase); </div><div class="line"><span class="keyword">var</span> objSub = <span class="keyword">new</span> Sub(); </div><div class="line">objSub.showName(); </div><div class="line"><span class="comment">//objSub.sayHello(); </span></div><div class="line"><span class="built_in">console</span>.log(objSub); </div><div class="line"></div><div class="line"><span class="comment">// 运行命令行 </span></div><div class="line">base </div><div class="line">Hello base </div><div class="line">&#123; <span class="attr">name</span>: <span class="string">'base'</span>, <span class="attr">base</span>: <span class="number">1991</span>, <span class="attr">sayHello</span>: [<span class="built_in">Function</span>] &#125; </div><div class="line">sub </div><div class="line">&#123; <span class="attr">name</span>: <span class="string">'sub'</span> &#125;</div></pre></td></tr></table></figure>
<h2 id="util-inspect"><a href="#util-inspect" class="headerlink" title="util.inspect"></a>util.inspect</h2><p>util.inspect(object,[showHidden],[depth],[colors])是一个将任意对象转换 为字符串的方法，通常用于调试和错误输出</p>
<p>至少接受一个参数 object，即要转换的对象</p>
<p>showHidden 是一个可选参数，如果值为 true，将会输出更多隐藏信息</p>
<p>depth 表示最大递归的层数，如果对象很复杂，你可以指定层数以控制输出信息的多少,默认2层</p>
<p>color 值为 true，输出格式将会以ANSI 颜色编码</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> util = <span class="built_in">require</span>(<span class="string">'util'</span>); </div><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">Person</span>(<span class="params"></span>) </span>&#123; </div><div class="line">    <span class="keyword">this</span>.name = <span class="string">'byvoid'</span>; </div><div class="line">    <span class="keyword">this</span>.toString = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123; </div><div class="line">    <span class="keyword">return</span> <span class="keyword">this</span>.name; </div><div class="line">    &#125;; </div><div class="line">&#125; </div><div class="line"><span class="keyword">var</span> obj = <span class="keyword">new</span> Person(); </div><div class="line"><span class="built_in">console</span>.log(util.inspect(obj)); </div><div class="line"><span class="built_in">console</span>.log(util.inspect(obj, <span class="literal">true</span>)); </div><div class="line"></div><div class="line"><span class="comment">//运行命令行</span></div><div class="line">Person &#123; <span class="attr">name</span>: <span class="string">'byvoid'</span>, <span class="attr">toString</span>: [<span class="built_in">Function</span>] &#125;</div><div class="line">Person &#123;</div><div class="line">  <span class="attr">name</span>: <span class="string">'byvoid'</span>,</div><div class="line">  <span class="attr">toString</span>: </div><div class="line">   &#123; [<span class="built_in">Function</span>]</div><div class="line">     [length]: <span class="number">0</span>,</div><div class="line">     [name]: <span class="string">''</span>,</div><div class="line">     [<span class="built_in">arguments</span>]: <span class="literal">null</span>,</div><div class="line">     [caller]: <span class="literal">null</span>,</div><div class="line">     [prototype]: &#123; [<span class="keyword">constructor</span>]: [Circular] &#125; &#125; &#125;</div></pre></td></tr></table></figure>
<h2 id="util-isArray-object"><a href="#util-isArray-object" class="headerlink" title="util.isArray(object)"></a>util.isArray(object)</h2><p>如果给定的参数 “object” 是一个数组返回true，否则返回false</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> util = <span class="built_in">require</span>(<span class="string">'util'</span>);</div><div class="line"></div><div class="line">util.isArray([])</div><div class="line">  <span class="comment">// true</span></div><div class="line">util.isArray(<span class="keyword">new</span> <span class="built_in">Array</span>)</div><div class="line">  <span class="comment">// true</span></div><div class="line">util.isArray(&#123;&#125;)</div><div class="line">  <span class="comment">// false</span></div></pre></td></tr></table></figure>
<h2 id="util-isRegExp-object"><a href="#util-isRegExp-object" class="headerlink" title="util.isRegExp(object)"></a>util.isRegExp(object)</h2><p>如果给定的参数 “object” 是一个正则表达式返回true，否则返回false</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> util = <span class="built_in">require</span>(<span class="string">'util'</span>);</div><div class="line"></div><div class="line">util.isRegExp(<span class="regexp">/some regexp/</span>)</div><div class="line">  <span class="comment">// true</span></div><div class="line">util.isRegExp(<span class="keyword">new</span> <span class="built_in">RegExp</span>(<span class="string">'another regexp'</span>))</div><div class="line">  <span class="comment">// true</span></div><div class="line">util.isRegExp(&#123;&#125;)</div><div class="line">  <span class="comment">// false</span></div></pre></td></tr></table></figure>
<h2 id="util-isDate-object"><a href="#util-isDate-object" class="headerlink" title="util.isDate(object)"></a>util.isDate(object)</h2><p>如果给定的参数 “object” 是一个日期返回true，否则返回false</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> util = <span class="built_in">require</span>(<span class="string">'util'</span>);</div><div class="line"></div><div class="line">util.isDate(<span class="keyword">new</span> <span class="built_in">Date</span>())</div><div class="line">  <span class="comment">// true</span></div><div class="line">util.isDate(<span class="built_in">Date</span>())</div><div class="line">  <span class="comment">// false (without 'new' returns a String)</span></div><div class="line">util.isDate(&#123;&#125;)</div><div class="line">  <span class="comment">// false</span></div></pre></td></tr></table></figure>
<h2 id="util-isError-object"><a href="#util-isError-object" class="headerlink" title="util.isError(object)"></a>util.isError(object)</h2><p>如果给定的参数 “object” 是一个错误对象返回true，否则返回false</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> util = <span class="built_in">require</span>(<span class="string">'util'</span>);</div><div class="line"></div><div class="line">util.isError(<span class="keyword">new</span> <span class="built_in">Error</span>())</div><div class="line">  <span class="comment">// true</span></div><div class="line">util.isError(<span class="keyword">new</span> <span class="built_in">TypeError</span>())</div><div class="line">  <span class="comment">// true</span></div><div class="line">util.isError(&#123; <span class="attr">name</span>: <span class="string">'Error'</span>, <span class="attr">message</span>: <span class="string">'an error occurred'</span> &#125;)</div><div class="line">  <span class="comment">// false</span></div></pre></td></tr></table></figure>
<h1 id="文件系统"><a href="#文件系统" class="headerlink" title="文件系统"></a>文件系统</h1><p>Node.js 提供一组类似 UNIX（POSIX）标准的文件操作API</p>
<p>Node 导入文件系统模块(fs)</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> fs = <span class="built_in">require</span>(<span class="string">"fs"</span>)</div></pre></td></tr></table></figure>
<h2 id="异步和同步"><a href="#异步和同步" class="headerlink" title="异步和同步"></a>异步和同步</h2><p>Node.js 文件系统（fs 模块）模块中的方法均有异步和同步版本</p>
<p>读取文件内容的函数有异步的 fs.readFile() 和同步的 fs.readFileSync()</p>
<figure class="highlight stata"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// 创建 input.txt 文件</span></div><div class="line">菜鸟教程官网地址：www.runoob.com</div><div class="line">文件读取实例</div><div class="line"></div><div class="line"><span class="comment">// 创建 file.js 文件</span></div><div class="line"><span class="keyword">var</span> fs = require(<span class="string">"fs"</span>);</div><div class="line"></div><div class="line"><span class="comment">// 异步读取</span></div><div class="line">fs.readFile('<span class="keyword">input</span>.txt', function (<span class="keyword">err</span>, data) &#123;</div><div class="line">   <span class="keyword">if</span> (<span class="keyword">err</span>) &#123;</div><div class="line">       <span class="keyword">return</span> console.<span class="keyword">error</span>(<span class="keyword">err</span>);</div><div class="line">   &#125;</div><div class="line">   console.<span class="built_in">log</span>(<span class="string">"异步读取: "</span> + data.<span class="keyword">toString</span>());</div><div class="line">&#125;);</div><div class="line"></div><div class="line"><span class="comment">// 同步读取</span></div><div class="line"><span class="keyword">var</span> data = fs.readFileSync('<span class="keyword">input</span>.txt');</div><div class="line">console.<span class="built_in">log</span>(<span class="string">"同步读取: "</span> + data.<span class="keyword">toString</span>());</div><div class="line"></div><div class="line">console.<span class="built_in">log</span>(<span class="string">"程序执行完毕。"</span>);</div><div class="line"></div><div class="line"><span class="comment">// 运行命令行</span></div><div class="line">node <span class="keyword">file</span>.js </div><div class="line">同步读取: 菜鸟教程官网地址：www.runoob.com</div><div class="line">文件读取实例</div><div class="line"></div><div class="line">程序执行完毕。</div><div class="line">异步读取: 菜鸟教程官网地址：www.runoob.com</div><div class="line">文件读取实例</div></pre></td></tr></table></figure>
<h2 id="打开文件"><a href="#打开文件" class="headerlink" title="打开文件"></a>打开文件</h2><p>fs.open(path, flags[, mode], callback)</p>
<ul>
<li>path - 文件的路径</li>
<li>flags - 文件打开的行为。具体值详见下文</li>
<li>mode - 设置文件模式(权限)，文件创建默认权限为 0666(可读，可写)</li>
<li>callback - 回调函数，带有两个参数如：callback(err, fd)</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// 创建 file.js 文件，并打开 input.txt 文件进行读写</span></div><div class="line"><span class="keyword">var</span> fs = <span class="built_in">require</span>(<span class="string">"fs"</span>);</div><div class="line"></div><div class="line"><span class="comment">// 异步打开文件</span></div><div class="line"><span class="built_in">console</span>.log(<span class="string">"准备打开文件！"</span>);</div><div class="line">fs.open(<span class="string">'input.txt'</span>, <span class="string">'r+'</span>, <span class="function"><span class="keyword">function</span>(<span class="params">err, fd</span>) </span>&#123;</div><div class="line">   <span class="keyword">if</span> (err) &#123;</div><div class="line">       <span class="keyword">return</span> <span class="built_in">console</span>.error(err);</div><div class="line">   &#125;</div><div class="line">  <span class="built_in">console</span>.log(<span class="string">"文件打开成功！"</span>);     </div><div class="line">&#125;);</div><div class="line"></div><div class="line"><span class="comment">// 运行命令行</span></div><div class="line">node file.js </div><div class="line">准备打开文件！</div><div class="line">文件打开成功！</div></pre></td></tr></table></figure>
<h2 id="获取文件信息"><a href="#获取文件信息" class="headerlink" title="获取文件信息"></a>获取文件信息</h2><p>fs.stat(path, callback)</p>
<ul>
<li>path - 文件路径</li>
<li>callback - 回调函数，带有两个参数如：(err, stats), stats 是 fs.Stats 对象</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// 创建 file.js</span></div><div class="line"><span class="keyword">var</span> fs = <span class="built_in">require</span>(<span class="string">"fs"</span>);</div><div class="line"></div><div class="line"><span class="built_in">console</span>.log(<span class="string">"准备打开文件！"</span>);</div><div class="line">fs.stat(<span class="string">'input.txt'</span>, <span class="function"><span class="keyword">function</span> (<span class="params">err, stats</span>) </span>&#123;</div><div class="line">   <span class="keyword">if</span> (err) &#123;</div><div class="line">       <span class="keyword">return</span> <span class="built_in">console</span>.error(err);</div><div class="line">   &#125;</div><div class="line">   <span class="built_in">console</span>.log(stats);</div><div class="line">   <span class="built_in">console</span>.log(<span class="string">"读取文件信息成功！"</span>);</div><div class="line">   </div><div class="line">   <span class="comment">// 检测文件类型</span></div><div class="line">   <span class="built_in">console</span>.log(<span class="string">"是否为文件(isFile) ? "</span> + stats.isFile());</div><div class="line">   <span class="built_in">console</span>.log(<span class="string">"是否为目录(isDirectory) ? "</span> + stats.isDirectory());    </div><div class="line">&#125;);</div><div class="line"></div><div class="line"><span class="comment">// 运行命令行</span></div><div class="line">node file.js </div><div class="line">准备打开文件！</div><div class="line">&#123; <span class="attr">dev</span>: <span class="number">16777220</span>,</div><div class="line">  <span class="attr">mode</span>: <span class="number">33188</span>,</div><div class="line">  <span class="attr">nlink</span>: <span class="number">1</span>,</div><div class="line">  <span class="attr">uid</span>: <span class="number">501</span>,</div><div class="line">  <span class="attr">gid</span>: <span class="number">20</span>,</div><div class="line">  <span class="attr">rdev</span>: <span class="number">0</span>,</div><div class="line">  <span class="attr">blksize</span>: <span class="number">4096</span>,</div><div class="line">  <span class="attr">ino</span>: <span class="number">40333161</span>,</div><div class="line">  <span class="attr">size</span>: <span class="number">61</span>,</div><div class="line">  <span class="attr">blocks</span>: <span class="number">8</span>,</div><div class="line">  <span class="attr">atime</span>: Mon Sep <span class="number">07</span> <span class="number">2015</span> <span class="number">17</span>:<span class="number">43</span>:<span class="number">55</span> GMT+<span class="number">0800</span> (CST),</div><div class="line">  <span class="attr">mtime</span>: Mon Sep <span class="number">07</span> <span class="number">2015</span> <span class="number">17</span>:<span class="number">22</span>:<span class="number">35</span> GMT+<span class="number">0800</span> (CST),</div><div class="line">  <span class="attr">ctime</span>: Mon Sep <span class="number">07</span> <span class="number">2015</span> <span class="number">17</span>:<span class="number">22</span>:<span class="number">35</span> GMT+<span class="number">0800</span> (CST) &#125;</div><div class="line">读取文件信息成功！</div><div class="line">是否为文件(isFile) ? <span class="literal">true</span></div><div class="line">是否为目录(isDirectory) ? <span class="literal">false</span></div></pre></td></tr></table></figure>
<h2 id="写入文件"><a href="#写入文件" class="headerlink" title="写入文件"></a>写入文件</h2><p>fs.writeFile(file, data[, options], callback)</p>
<ul>
<li>file - 文件名或文件描述符</li>
<li>data - 要写入文件的数据，可以是 String(字符串) 或 Buffer(流) 对象</li>
<li>options - 该参数是一个对象，包含 {encoding, mode, flag}。默认编码为 utf8,模式为 0666 ， flag 为 ‘w’</li>
<li>callback - 回调函数，回调函数只包含错误信息参数(err)，在写入失败时返回</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// 创建 file.js</span></div><div class="line"><span class="keyword">var</span> fs = <span class="built_in">require</span>(<span class="string">"fs"</span>);</div><div class="line"></div><div class="line"><span class="built_in">console</span>.log(<span class="string">"准备写入文件"</span>);</div><div class="line">fs.writeFile(<span class="string">'input.txt'</span>, <span class="string">'我是通 过fs.writeFile 写入文件的内容'</span>,  <span class="function"><span class="keyword">function</span>(<span class="params">err</span>) </span>&#123;</div><div class="line">   <span class="keyword">if</span> (err) &#123;</div><div class="line">       <span class="keyword">return</span> <span class="built_in">console</span>.error(err);</div><div class="line">   &#125;</div><div class="line">   <span class="built_in">console</span>.log(<span class="string">"数据写入成功！"</span>);</div><div class="line">   <span class="built_in">console</span>.log(<span class="string">"--------我是分割线-------------"</span>)</div><div class="line">   <span class="built_in">console</span>.log(<span class="string">"读取写入的数据！"</span>);</div><div class="line">   fs.readFile(<span class="string">'input.txt'</span>, <span class="function"><span class="keyword">function</span> (<span class="params">err, data</span>) </span>&#123;</div><div class="line">      <span class="keyword">if</span> (err) &#123;</div><div class="line">         <span class="keyword">return</span> <span class="built_in">console</span>.error(err);</div><div class="line">      &#125;</div><div class="line">      <span class="built_in">console</span>.log(<span class="string">"异步读取文件数据: "</span> + data.toString());</div><div class="line">   &#125;);</div><div class="line">&#125;);</div><div class="line"></div><div class="line"><span class="comment">// 运行命令行</span></div><div class="line">node file.js </div><div class="line">准备写入文件</div><div class="line">数据写入成功！</div><div class="line">--------我是分割线-------------</div><div class="line">读取写入的数据！</div><div class="line">异步读取文件数据: 我是通 过fs.writeFile 写入文件的内容</div></pre></td></tr></table></figure>
<h2 id="读取文件"><a href="#读取文件" class="headerlink" title="读取文件"></a>读取文件</h2><p>fs.read(fd, buffer, offset, length, position, callback)</p>
<ul>
<li>fd - 通过 fs.open() 方法返回的文件描述符</li>
<li>buffer - 数据写入的缓冲区</li>
<li>offset - 缓冲区写入的写入偏移量</li>
<li>length - 要从文件中读取的字节数</li>
<li>position - 文件读取的起始位置，如果 position 的值为 null，则会从当前文件指针的位置读取</li>
<li>callback - 回调函数，有三个参数err, bytesRead, buffer，err 为错误信息， bytesRead 表示读取的字节数，buffer 为缓冲区对象</li>
</ul>
<figure class="highlight stata"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// input.txt 文件内容</span></div><div class="line">菜鸟教程官网地址：www.runoob.com</div><div class="line"></div><div class="line"><span class="comment">// 创建 file.js 文件</span></div><div class="line"><span class="keyword">var</span> fs = require(<span class="string">"fs"</span>);</div><div class="line"><span class="keyword">var</span> buf = new Buffer.alloc(1024);</div><div class="line"></div><div class="line">console.<span class="built_in">log</span>(<span class="string">"准备打开已存在的文件！"</span>);</div><div class="line">fs.<span class="keyword">open</span>('<span class="keyword">input</span>.txt', 'r+', function(<span class="keyword">err</span>, fd) &#123;</div><div class="line">   <span class="keyword">if</span> (<span class="keyword">err</span>) &#123;</div><div class="line">       <span class="keyword">return</span> console.<span class="keyword">error</span>(<span class="keyword">err</span>);</div><div class="line">   &#125;</div><div class="line">   console.<span class="built_in">log</span>(<span class="string">"文件打开成功！"</span>);</div><div class="line">   console.<span class="built_in">log</span>(<span class="string">"准备读取文件："</span>);</div><div class="line">   fs.<span class="keyword">read</span>(fd, buf, 0, buf.length, 0, function(<span class="keyword">err</span>, bytes)&#123;</div><div class="line">      <span class="keyword">if</span> (<span class="keyword">err</span>)&#123;</div><div class="line">         console.<span class="built_in">log</span>(<span class="keyword">err</span>);</div><div class="line">      &#125;</div><div class="line">      console.<span class="built_in">log</span>(bytes + <span class="string">"  字节被读取"</span>);</div><div class="line">      </div><div class="line">      <span class="comment">// 仅输出读取的字节</span></div><div class="line">      <span class="keyword">if</span>(bytes &gt; 0)&#123;</div><div class="line">         console.<span class="built_in">log</span>(buf.slice(0, bytes).<span class="keyword">toString</span>());</div><div class="line">      &#125;</div><div class="line">   &#125;);</div><div class="line">&#125;);</div><div class="line"></div><div class="line"><span class="comment">// 运行命令行</span></div><div class="line">node <span class="keyword">file</span>.js </div><div class="line">准备打开已存在的文件！</div><div class="line">文件打开成功！</div><div class="line">准备读取文件：</div><div class="line">42  字节被读取</div><div class="line">菜鸟教程官网地址：www.runoob.com</div></pre></td></tr></table></figure>
<h2 id="关闭文件"><a href="#关闭文件" class="headerlink" title="关闭文件"></a>关闭文件</h2><p>fs.close(fd, callback)</p>
<ul>
<li>fd - 通过 fs.open() 方法返回的文件描述符</li>
<li>callback - 回调函数，没有参数</li>
</ul>
<figure class="highlight stata"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// input.txt</span></div><div class="line">菜鸟教程官网地址：www.runoob.com</div><div class="line"></div><div class="line"><span class="comment">// 创建 file.js 文件</span></div><div class="line"><span class="keyword">var</span> fs = require(<span class="string">"fs"</span>);</div><div class="line"><span class="keyword">var</span> buf = new Buffer.alloc(1024);</div><div class="line"></div><div class="line">console.<span class="built_in">log</span>(<span class="string">"准备打开文件！"</span>);</div><div class="line">fs.<span class="keyword">open</span>('<span class="keyword">input</span>.txt', 'r+', function(<span class="keyword">err</span>, fd) &#123;</div><div class="line">   <span class="keyword">if</span> (<span class="keyword">err</span>) &#123;</div><div class="line">       <span class="keyword">return</span> console.<span class="keyword">error</span>(<span class="keyword">err</span>);</div><div class="line">   &#125;</div><div class="line">   console.<span class="built_in">log</span>(<span class="string">"文件打开成功！"</span>);</div><div class="line">   console.<span class="built_in">log</span>(<span class="string">"准备读取文件！"</span>);</div><div class="line">   fs.<span class="keyword">read</span>(fd, buf, 0, buf.length, 0, function(<span class="keyword">err</span>, bytes)&#123;</div><div class="line">      <span class="keyword">if</span> (<span class="keyword">err</span>)&#123;</div><div class="line">         console.<span class="built_in">log</span>(<span class="keyword">err</span>);</div><div class="line">      &#125;</div><div class="line"></div><div class="line">      <span class="comment">// 仅输出读取的字节</span></div><div class="line">      <span class="keyword">if</span>(bytes &gt; 0)&#123;</div><div class="line">         console.<span class="built_in">log</span>(buf.slice(0, bytes).<span class="keyword">toString</span>());</div><div class="line">      &#125;</div><div class="line"></div><div class="line">      <span class="comment">// 关闭文件</span></div><div class="line">      fs.<span class="keyword">close</span>(fd, function(<span class="keyword">err</span>)&#123;</div><div class="line">         <span class="keyword">if</span> (<span class="keyword">err</span>)&#123;</div><div class="line">            console.<span class="built_in">log</span>(<span class="keyword">err</span>);</div><div class="line">         &#125; </div><div class="line">         console.<span class="built_in">log</span>(<span class="string">"文件关闭成功"</span>);</div><div class="line">      &#125;);</div><div class="line">   &#125;);</div><div class="line">&#125;);</div><div class="line"></div><div class="line"><span class="comment">// 运行命令行</span></div><div class="line">node <span class="keyword">file</span>.js </div><div class="line">准备打开文件！</div><div class="line">文件打开成功！</div><div class="line">准备读取文件！</div><div class="line">菜鸟教程官网地址：www.runoob.com</div><div class="line">文件关闭成功</div></pre></td></tr></table></figure>
<h2 id="截取文件"><a href="#截取文件" class="headerlink" title="截取文件"></a>截取文件</h2><p>fs.ftruncate(fd, len, callback)</p>
<ul>
<li>fd - 通过 fs.open() 方法返回的文件描述符</li>
<li>len - 文件内容截取的长度</li>
<li>callback - 回调函数，没有参数</li>
</ul>
<figure class="highlight stata"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// input.txt</span></div><div class="line">site:www.runoob.com</div><div class="line"></div><div class="line"><span class="comment">// file.js</span></div><div class="line"><span class="keyword">var</span> fs = require(<span class="string">"fs"</span>);</div><div class="line"><span class="keyword">var</span> buf = new Buffer.alloc(1024);</div><div class="line"></div><div class="line">console.<span class="built_in">log</span>(<span class="string">"准备打开文件！"</span>);</div><div class="line">fs.<span class="keyword">open</span>('<span class="keyword">input</span>.txt', 'r+', function(<span class="keyword">err</span>, fd) &#123;</div><div class="line">   <span class="keyword">if</span> (<span class="keyword">err</span>) &#123;</div><div class="line">       <span class="keyword">return</span> console.<span class="keyword">error</span>(<span class="keyword">err</span>);</div><div class="line">   &#125;</div><div class="line">   console.<span class="built_in">log</span>(<span class="string">"文件打开成功！"</span>);</div><div class="line">   console.<span class="built_in">log</span>(<span class="string">"截取了10字节后的文件内容。"</span>);</div><div class="line">   </div><div class="line">   <span class="comment">// 截取文件</span></div><div class="line">   fs.ftruncate(fd, 10, function(<span class="keyword">err</span>)&#123;</div><div class="line">      <span class="keyword">if</span> (<span class="keyword">err</span>)&#123;</div><div class="line">         console.<span class="built_in">log</span>(<span class="keyword">err</span>);</div><div class="line">      &#125; </div><div class="line">      console.<span class="built_in">log</span>(<span class="string">"文件截取成功。"</span>);</div><div class="line">      console.<span class="built_in">log</span>(<span class="string">"读取相同的文件"</span>); </div><div class="line">      fs.<span class="keyword">read</span>(fd, buf, 0, buf.length, 0, function(<span class="keyword">err</span>, bytes)&#123;</div><div class="line">         <span class="keyword">if</span> (<span class="keyword">err</span>)&#123;</div><div class="line">            console.<span class="built_in">log</span>(<span class="keyword">err</span>);</div><div class="line">         &#125;</div><div class="line"></div><div class="line">         <span class="comment">// 仅输出读取的字节</span></div><div class="line">         <span class="keyword">if</span>(bytes &gt; 0)&#123;</div><div class="line">            console.<span class="built_in">log</span>(buf.slice(0, bytes).<span class="keyword">toString</span>());</div><div class="line">         &#125;</div><div class="line"></div><div class="line">         <span class="comment">// 关闭文件</span></div><div class="line">         fs.<span class="keyword">close</span>(fd, function(<span class="keyword">err</span>)&#123;</div><div class="line">            <span class="keyword">if</span> (<span class="keyword">err</span>)&#123;</div><div class="line">               console.<span class="built_in">log</span>(<span class="keyword">err</span>);</div><div class="line">            &#125; </div><div class="line">            console.<span class="built_in">log</span>(<span class="string">"文件关闭成功！"</span>);</div><div class="line">         &#125;);</div><div class="line">      &#125;);</div><div class="line">   &#125;);</div><div class="line">&#125;);</div><div class="line"></div><div class="line"><span class="comment">// 运行命令行</span></div><div class="line">node <span class="keyword">file</span>.js </div><div class="line">准备打开文件！</div><div class="line">文件打开成功！</div><div class="line">截取了10字节后的文件内容。</div><div class="line">文件截取成功。</div><div class="line">读取相同的文件</div><div class="line">site:www.<span class="built_in">r</span></div><div class="line">文件关闭成功</div></pre></td></tr></table></figure>
<h2 id="删除文件"><a href="#删除文件" class="headerlink" title="删除文件"></a>删除文件</h2><p>fs.unlink(path, callback)</p>
<ul>
<li>path - 文件路径</li>
<li>callback - 回调函数，没有参数</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// input.txt</span></div><div class="line">site:www.runoob.com</div><div class="line"></div><div class="line"><span class="comment">// 创建 file.js</span></div><div class="line"><span class="keyword">var</span> fs = <span class="built_in">require</span>(<span class="string">"fs"</span>);</div><div class="line"></div><div class="line"><span class="built_in">console</span>.log(<span class="string">"准备删除文件！"</span>);</div><div class="line">fs.unlink(<span class="string">'input.txt'</span>, <span class="function"><span class="keyword">function</span>(<span class="params">err</span>) </span>&#123;</div><div class="line">   <span class="keyword">if</span> (err) &#123;</div><div class="line">       <span class="keyword">return</span> <span class="built_in">console</span>.error(err);</div><div class="line">   &#125;</div><div class="line">   <span class="built_in">console</span>.log(<span class="string">"文件删除成功！"</span>);</div><div class="line">&#125;);</div><div class="line"></div><div class="line"><span class="comment">// 运行命令行</span></div><div class="line">node file.js </div><div class="line">准备删除文件！</div><div class="line">文件删除成功！</div></pre></td></tr></table></figure>
<h2 id="创建目录"><a href="#创建目录" class="headerlink" title="创建目录"></a>创建目录</h2><p>fs.mkdir(path[, mode], callback)</p>
<ul>
<li>path - 文件路径</li>
<li>mode - 设置目录权限，默认为 0777</li>
<li>callback - 回调函数，没有参数</li>
</ul>
<figure class="highlight stata"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> fs = require(<span class="string">"fs"</span>);</div><div class="line"></div><div class="line">console.<span class="built_in">log</span>(<span class="string">"创建目录 /tmp/test/"</span>);</div><div class="line">fs.<span class="keyword">mkdir</span>(<span class="string">"/tmp/test/"</span>,function(<span class="keyword">err</span>)&#123;</div><div class="line">   <span class="keyword">if</span> (<span class="keyword">err</span>) &#123;</div><div class="line">       <span class="keyword">return</span> console.<span class="keyword">error</span>(<span class="keyword">err</span>);</div><div class="line">   &#125;</div><div class="line">   console.<span class="built_in">log</span>(<span class="string">"目录创建成功。"</span>);</div><div class="line">&#125;);</div><div class="line"></div><div class="line"><span class="comment">// 运行命令行</span></div><div class="line">node <span class="keyword">file</span>.js </div><div class="line">创建目录 /tmp/<span class="keyword">test</span>/</div><div class="line">目录创建成功。</div></pre></td></tr></table></figure>
<h2 id="读取目录"><a href="#读取目录" class="headerlink" title="读取目录"></a>读取目录</h2><p>fs.readdir(path, callback)</p>
<ul>
<li>path - 文件路径</li>
<li>callback - 回调函数，回调函数带有两个参数err, files，err 为错误信息，files 为 目录下的文件数组列表</li>
</ul>
<figure class="highlight stata"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// 创建file.js</span></div><div class="line"><span class="keyword">var</span> fs = require(<span class="string">"fs"</span>);</div><div class="line"></div><div class="line">console.<span class="built_in">log</span>(<span class="string">"查看 /tmp 目录"</span>);</div><div class="line">fs.readdir(<span class="string">"/tmp/"</span>,function(<span class="keyword">err</span>, files)&#123;</div><div class="line">   <span class="keyword">if</span> (<span class="keyword">err</span>) &#123;</div><div class="line">       <span class="keyword">return</span> console.<span class="keyword">error</span>(<span class="keyword">err</span>);</div><div class="line">   &#125;</div><div class="line">   files.<span class="keyword">forEach</span>( function (<span class="keyword">file</span>)&#123;</div><div class="line">       console.<span class="built_in">log</span>( <span class="keyword">file</span> );</div><div class="line">   &#125;);</div><div class="line">&#125;);</div><div class="line"></div><div class="line"><span class="comment">// 运行命令行</span></div><div class="line">node <span class="keyword">file</span>.js </div><div class="line">查看 /tmp 目录</div><div class="line"><span class="keyword">input</span>.<span class="keyword">out</span></div><div class="line">output.<span class="keyword">out</span></div><div class="line"><span class="keyword">test</span></div><div class="line"><span class="keyword">test</span>.txt</div></pre></td></tr></table></figure>
<h2 id="删除目录"><a href="#删除目录" class="headerlink" title="删除目录"></a>删除目录</h2><p>fs.rmdir(path, callback)</p>
<ul>
<li>path - 文件路径</li>
<li>callback - 回调函数，没有参数</li>
</ul>
<figure class="highlight stata"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// 创建file.js</span></div><div class="line"><span class="keyword">var</span> fs = require(<span class="string">"fs"</span>);</div><div class="line"><span class="comment">// 执行前创建一个空的 /tmp/test 目录</span></div><div class="line">console.<span class="built_in">log</span>(<span class="string">"准备删除目录 /tmp/test"</span>);</div><div class="line">fs.<span class="keyword">rmdir</span>(<span class="string">"/tmp/test"</span>,function(<span class="keyword">err</span>)&#123;</div><div class="line">   <span class="keyword">if</span> (<span class="keyword">err</span>) &#123;</div><div class="line">       <span class="keyword">return</span> console.<span class="keyword">error</span>(<span class="keyword">err</span>);</div><div class="line">   &#125;</div><div class="line">   console.<span class="built_in">log</span>(<span class="string">"读取 /tmp 目录"</span>);</div><div class="line">   fs.readdir(<span class="string">"/tmp/"</span>,function(<span class="keyword">err</span>, files)&#123;</div><div class="line">      <span class="keyword">if</span> (<span class="keyword">err</span>) &#123;</div><div class="line">          <span class="keyword">return</span> console.<span class="keyword">error</span>(<span class="keyword">err</span>);</div><div class="line">      &#125;</div><div class="line">      files.<span class="keyword">forEach</span>( function (<span class="keyword">file</span>)&#123;</div><div class="line">          console.<span class="built_in">log</span>( <span class="keyword">file</span> );</div><div class="line">      &#125;);</div><div class="line">   &#125;);</div><div class="line">&#125;);</div><div class="line"></div><div class="line"><span class="comment">// 运行命令行</span></div><div class="line">node <span class="keyword">file</span>.js </div><div class="line">准备删除目录 /tmp/<span class="keyword">test</span></div><div class="line">读取 /tmp 目录</div><div class="line">……</div></pre></td></tr></table></figure>
<h1 id="GET-POST请求"><a href="#GET-POST请求" class="headerlink" title="GET/POST请求"></a>GET/POST请求</h1><p>表单提交到服务器一般都使用 GET/POST 请求</p>
<h2 id="获取GET请求内容"><a href="#获取GET请求内容" class="headerlink" title="获取GET请求内容"></a>获取GET请求内容</h2><p>node.js 中 url 模块中的 parse 函数提供了这个功能</p>
<figure class="highlight qml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// 在浏览器中访问 http://localhost:3000/user?name=菜鸟教程&amp;url=www.runoob.com 然后查看返回结果</span></div><div class="line"><span class="built_in">var</span> http = <span class="built_in">require</span>(<span class="string">'http'</span>);</div><div class="line"><span class="built_in">var</span> <span class="built_in">url</span> = <span class="built_in">require</span>(<span class="string">'url'</span>);</div><div class="line"><span class="built_in">var</span> util = <span class="built_in">require</span>(<span class="string">'util'</span>);</div><div class="line"> </div><div class="line">http.createServer(<span class="function"><span class="keyword">function</span>(<span class="params">req, res</span>)</span>&#123;</div><div class="line">    res.writeHead(<span class="number">200</span>, &#123;<span class="string">'Content-Type'</span>: <span class="string">'text/plain; charset=utf-8'</span>&#125;);</div><div class="line">    res.end(util.inspect(<span class="built_in">url</span>.parse(req.url, <span class="literal">true</span>)));</div><div class="line">&#125;).listen(<span class="number">3000</span>);</div></pre></td></tr></table></figure>
<p>使用 url.parse 方法来解析 URL 中的参数</p>
<figure class="highlight qml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// 在浏览器中访问 http://localhost:3000/user?name=菜鸟教程&amp;url=www.runoob.com 然后查看返回结果</span></div><div class="line"><span class="built_in">var</span> http = <span class="built_in">require</span>(<span class="string">'http'</span>);</div><div class="line"><span class="built_in">var</span> <span class="built_in">url</span> = <span class="built_in">require</span>(<span class="string">'url'</span>);</div><div class="line"><span class="built_in">var</span> util = <span class="built_in">require</span>(<span class="string">'util'</span>);</div><div class="line"> </div><div class="line">http.createServer(<span class="function"><span class="keyword">function</span>(<span class="params">req, res</span>)</span>&#123;</div><div class="line">    res.writeHead(<span class="number">200</span>, &#123;<span class="string">'Content-Type'</span>: <span class="string">'text/plain'</span>&#125;);</div><div class="line"> </div><div class="line">    <span class="comment">// 解析 url 参数</span></div><div class="line">    <span class="built_in">var</span> params = <span class="built_in">url</span>.parse(req.url, <span class="literal">true</span>).query;</div><div class="line">    res.write(<span class="string">"网站名："</span> + params.name);</div><div class="line">    res.write(<span class="string">"\n"</span>);</div><div class="line">    res.write(<span class="string">"网站 URL："</span> + params.url);</div><div class="line">    res.end();</div><div class="line"> </div><div class="line">&#125;).listen(<span class="number">3000</span>);</div></pre></td></tr></table></figure>
<h2 id="获取-POST-请求内容"><a href="#获取-POST-请求内容" class="headerlink" title="获取 POST 请求内容"></a>获取 POST 请求内容</h2><p>POST 请求的内容全部的都在请求体中，http.ServerRequest 并没有一个属性内容为请求体</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// node.js 默认是不会解析请求体的，当你需要的时候，需要手动来做</span></div><div class="line"><span class="keyword">var</span> http = <span class="built_in">require</span>(<span class="string">'http'</span>);</div><div class="line"><span class="keyword">var</span> querystring = <span class="built_in">require</span>(<span class="string">'querystring'</span>);</div><div class="line"> </div><div class="line">http.createServer(<span class="function"><span class="keyword">function</span>(<span class="params">req, res</span>)</span>&#123;</div><div class="line">    <span class="comment">// 定义了一个post变量，用于暂存请求体的信息</span></div><div class="line">    <span class="keyword">var</span> post = <span class="string">''</span>;     </div><div class="line"> </div><div class="line">    <span class="comment">// 通过req的data事件监听函数，每当接受到请求体的数据，就累加到post变量中</span></div><div class="line">    req.on(<span class="string">'data'</span>, <span class="function"><span class="keyword">function</span>(<span class="params">chunk</span>)</span>&#123;    </div><div class="line">        post += chunk;</div><div class="line">    &#125;);</div><div class="line"> </div><div class="line">    <span class="comment">// 在end事件触发后，通过querystring.parse将post解析为真正的POST请求格式，然后向客户端返回。</span></div><div class="line">    req.on(<span class="string">'end'</span>, <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;    </div><div class="line">        post = querystring.parse(post);</div><div class="line">        res.end(util.inspect(post));</div><div class="line">    &#125;);</div><div class="line">&#125;).listen(<span class="number">3000</span>);</div></pre></td></tr></table></figure>
<p>实例表单通过 POST 提交并输出数据</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> http = <span class="built_in">require</span>(<span class="string">'http'</span>);</div><div class="line"><span class="keyword">var</span> querystring = <span class="built_in">require</span>(<span class="string">'querystring'</span>);</div><div class="line"> </div><div class="line"><span class="keyword">var</span> postHTML = </div><div class="line">  <span class="string">'&lt;html&gt;&lt;head&gt;&lt;meta charset="utf-8"&gt;&lt;title&gt;菜鸟教程 Node.js 实例&lt;/title&gt;&lt;/head&gt;'</span> +</div><div class="line">  <span class="string">'&lt;body&gt;'</span> +</div><div class="line">  <span class="string">'&lt;form method="post"&gt;'</span> +</div><div class="line">  <span class="string">'网站名： &lt;input name="name"&gt;&lt;br&gt;'</span> +</div><div class="line">  <span class="string">'网站 URL： &lt;input name="url"&gt;&lt;br&gt;'</span> +</div><div class="line">  <span class="string">'&lt;input type="submit"&gt;'</span> +</div><div class="line">  <span class="string">'&lt;/form&gt;'</span> +</div><div class="line">  <span class="string">'&lt;/body&gt;&lt;/html&gt;'</span>;</div><div class="line"> </div><div class="line">http.createServer(<span class="function"><span class="keyword">function</span> (<span class="params">req, res</span>) </span>&#123;</div><div class="line">  <span class="keyword">var</span> body = <span class="string">""</span>;</div><div class="line">  req.on(<span class="string">'data'</span>, <span class="function"><span class="keyword">function</span> (<span class="params">chunk</span>) </span>&#123;</div><div class="line">    body += chunk;</div><div class="line">  &#125;);</div><div class="line">  req.on(<span class="string">'end'</span>, <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</div><div class="line">    <span class="comment">// 解析参数</span></div><div class="line">    body = querystring.parse(body);</div><div class="line">    <span class="comment">// 设置响应头部信息及编码</span></div><div class="line">    res.writeHead(<span class="number">200</span>, &#123;<span class="string">'Content-Type'</span>: <span class="string">'text/html; charset=utf8'</span>&#125;);</div><div class="line"> </div><div class="line">    <span class="keyword">if</span>(body.name &amp;&amp; body.url) &#123; <span class="comment">// 输出提交的数据</span></div><div class="line">        res.write(<span class="string">"网站名："</span> + body.name);</div><div class="line">        res.write(<span class="string">"&lt;br&gt;"</span>);</div><div class="line">        res.write(<span class="string">"网站 URL："</span> + body.url);</div><div class="line">    &#125; <span class="keyword">else</span> &#123;  <span class="comment">// 输出表单</span></div><div class="line">        res.write(postHTML);</div><div class="line">    &#125;</div><div class="line">    res.end();</div><div class="line">  &#125;);</div><div class="line">&#125;).listen(<span class="number">3000</span>);</div></pre></td></tr></table></figure>
<h1 id="工具模块"><a href="#工具模块" class="headerlink" title="工具模块"></a>工具模块</h1><h2 id="OS模块"><a href="#OS模块" class="headerlink" title="OS模块"></a>OS模块</h2><p>提供了一些基本的系统操作函数</p>
<p>var os = require(“os”)</p>
<figure class="highlight lasso"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// main.js文件</span></div><div class="line"><span class="built_in">var</span> os = <span class="keyword">require</span>(<span class="string">"os"</span>);</div><div class="line"></div><div class="line"><span class="comment">// CPU 的字节序</span></div><div class="line">console.<span class="keyword">log</span>(<span class="string">'endianness : '</span> + os.endianness());</div><div class="line"></div><div class="line"><span class="comment">// 操作系统名</span></div><div class="line">console.<span class="keyword">log</span>(<span class="string">'type : '</span> + os.<span class="keyword">type</span>());</div><div class="line"></div><div class="line"><span class="comment">// 操作系统名</span></div><div class="line">console.<span class="keyword">log</span>(<span class="string">'platform : '</span> + os.platform());</div><div class="line"></div><div class="line"><span class="comment">// 系统内存总量</span></div><div class="line">console.<span class="keyword">log</span>(<span class="string">'total memory : '</span> + os.totalmem() + <span class="string">" bytes."</span>);</div><div class="line"></div><div class="line"><span class="comment">// 操作系统空闲内存量</span></div><div class="line">console.<span class="keyword">log</span>(<span class="string">'free memory : '</span> + os.freemem() + <span class="string">" bytes."</span>);</div><div class="line"></div><div class="line"><span class="comment">// 运行命令行</span></div><div class="line">node main.js </div><div class="line">endianness : LE</div><div class="line"><span class="keyword">type</span> : Linux</div><div class="line">platform : linux</div><div class="line">total memory : <span class="number">25103400960</span> <span class="built_in">bytes</span>.</div><div class="line">free memory : <span class="number">20676710400</span> <span class="built_in">bytes</span>.</div></pre></td></tr></table></figure>
<h2 id="Path-模块"><a href="#Path-模块" class="headerlink" title="Path 模块"></a>Path 模块</h2><p>提供了一些用于处理文件路径的小工具</p>
<p>var path = require(“path”)</p>
<figure class="highlight xl"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// 创建main.js</span></div><div class="line">var <span class="built_in">path</span> = require(<span class="string">"path"</span>);</div><div class="line"></div><div class="line"><span class="comment">// 格式化路径</span></div><div class="line">console.<span class="built_in">log</span>(<span class="string">'normalization : '</span> + <span class="built_in">path</span>.normalize(<span class="string">'/test/test1//2slashes/1slash/tab/..'</span>));</div><div class="line"></div><div class="line"><span class="comment">// 连接路径</span></div><div class="line">console.<span class="built_in">log</span>(<span class="string">'joint path : '</span> + <span class="built_in">path</span>.join(<span class="string">'/test'</span>, <span class="string">'test1'</span>, <span class="string">'2slashes/1slash'</span>, <span class="string">'tab'</span>, <span class="string">'..'</span>));</div><div class="line"></div><div class="line"><span class="comment">// 转换为绝对路径</span></div><div class="line">console.<span class="built_in">log</span>(<span class="string">'resolve : '</span> + <span class="built_in">path</span>.resolve(<span class="string">'main.js'</span>));</div><div class="line"></div><div class="line"><span class="comment">// 路径中文件的后缀名</span></div><div class="line">console.<span class="built_in">log</span>(<span class="string">'ext name : '</span> + <span class="built_in">path</span>.extname(<span class="string">'main.js'</span>));</div><div class="line"></div><div class="line"><span class="comment">// 运行命令行</span></div><div class="line">node main.js </div><div class="line">normalization : /test/test1/<span class="number">2</span>slashes/<span class="number">1</span>slash</div><div class="line">joint <span class="built_in">path</span> : /test/test1/<span class="number">2</span>slashes/<span class="number">1</span>slash</div><div class="line">resolve : /web/com/<span class="number">1427176256</span>_27423/main.js</div><div class="line">ext <span class="keyword">name</span> : .js</div></pre></td></tr></table></figure>
<h2 id="Net-模块"><a href="#Net-模块" class="headerlink" title="Net 模块"></a>Net 模块</h2><p>提供了一些用于底层的网络通信的小工具，包含了创建服务器/客户端的方法</p>
<p>var net = require(“net”)</p>
<p>net.Server通常用于创建一个 TCP 或本地服务器</p>
<p>net.Socket 对象是 TCP 或 UNIX Socket 的抽象</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// server.js</span></div><div class="line"><span class="keyword">var</span> net = <span class="keyword">require</span>(<span class="string">'net'</span>);</div><div class="line"><span class="keyword">var</span> server = net.createServer(<span class="function"><span class="keyword">function</span><span class="params">(connection)</span> </span>&#123; </div><div class="line">   console.log(<span class="string">'client connected'</span>);</div><div class="line">   connection.on(<span class="string">'end'</span>, <span class="function"><span class="keyword">function</span><span class="params">()</span> </span>&#123;</div><div class="line">      console.log(<span class="string">'客户端关闭连接'</span>);</div><div class="line">   &#125;);</div><div class="line">   connection.write(<span class="string">'Hello World!\r\n'</span>);</div><div class="line">   connection.pipe(connection);</div><div class="line">&#125;);</div><div class="line">server.listen(<span class="number">8080</span>, <span class="function"><span class="keyword">function</span><span class="params">()</span> </span>&#123; </div><div class="line">  console.log(<span class="string">'server is listening'</span>);</div><div class="line">&#125;);</div><div class="line"></div><div class="line"><span class="comment">// 运行命令行</span></div><div class="line">node server.js</div><div class="line">server is listening   <span class="comment"># 服务已创建并监听 8080 端口</span></div></pre></td></tr></table></figure>
<p>新开一个窗口，创建 client.js 文件</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// client.js</span></div><div class="line"><span class="keyword">var</span> net = <span class="built_in">require</span>(<span class="string">'net'</span>);</div><div class="line"><span class="keyword">var</span> client = net.connect(&#123;<span class="attr">port</span>: <span class="number">8080</span>&#125;, <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</div><div class="line">   <span class="built_in">console</span>.log(<span class="string">'连接到服务器！'</span>);  </div><div class="line">&#125;);</div><div class="line">client.on(<span class="string">'data'</span>, <span class="function"><span class="keyword">function</span>(<span class="params">data</span>) </span>&#123;</div><div class="line">   <span class="built_in">console</span>.log(data.toString());</div><div class="line">   client.end();</div><div class="line">&#125;);</div><div class="line">client.on(<span class="string">'end'</span>, <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123; </div><div class="line">   <span class="built_in">console</span>.log(<span class="string">'断开与服务器的连接'</span>);</div><div class="line">&#125;);</div><div class="line"></div><div class="line"><span class="comment">// 运行命令行</span></div><div class="line">连接到服务器！</div><div class="line">Hello World!</div><div class="line"></div><div class="line">断开与服务器的连接</div></pre></td></tr></table></figure>
<h1 id="DNS-模块"><a href="#DNS-模块" class="headerlink" title="DNS 模块"></a>DNS 模块</h1><p>DNS 模块用于解析域名</p>
<p>var dns = require(“dns”)</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// main.js</span></div><div class="line"><span class="keyword">var</span> dns = <span class="built_in">require</span>(<span class="string">'dns'</span>);</div><div class="line"></div><div class="line">dns.lookup(<span class="string">'www.github.com'</span>, <span class="function"><span class="keyword">function</span> <span class="title">onLookup</span>(<span class="params">err, address, family</span>) </span>&#123;</div><div class="line">   <span class="built_in">console</span>.log(<span class="string">'ip 地址:'</span>, address);</div><div class="line">   dns.reverse(address, <span class="function"><span class="keyword">function</span> (<span class="params">err, hostnames</span>) </span>&#123;</div><div class="line">   <span class="keyword">if</span> (err) &#123;</div><div class="line">      <span class="built_in">console</span>.log(err.stack);</div><div class="line">   &#125;</div><div class="line"></div><div class="line">   <span class="built_in">console</span>.log(<span class="string">'反向解析 '</span> + address + <span class="string">': '</span> + <span class="built_in">JSON</span>.stringify(hostnames));</div><div class="line">&#125;);  </div><div class="line">&#125;);</div><div class="line"></div><div class="line"><span class="comment">// 运行命令行</span></div><div class="line">address: <span class="number">192.30</span><span class="number">.252</span><span class="number">.130</span></div><div class="line">reverse <span class="keyword">for</span> <span class="number">192.30</span><span class="number">.252</span><span class="number">.130</span>: [<span class="string">"github.com"</span>]</div></pre></td></tr></table></figure>
<h1 id="Domain-模块"><a href="#Domain-模块" class="headerlink" title="Domain 模块"></a>Domain 模块</h1><p>Domain(域) 简化异步代码的异常处理，可以捕捉处理try catch无法捕捉的异常</p>
<p>var domain = require(“domain”)</p>
<p>Domain 模块可分为隐式绑定和显式绑定</p>
<ul>
<li>隐式绑定: 把在domain上下文中定义的变量，自动绑定到domain对象</li>
<li>显式绑定: 把不是在domain上下文中定义的变量，以代码的方式绑定到domain对象</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// 创建 main.js</span></div><div class="line"><span class="keyword">var</span> EventEmitter = <span class="built_in">require</span>(<span class="string">"events"</span>).EventEmitter;</div><div class="line"><span class="keyword">var</span> domain = <span class="built_in">require</span>(<span class="string">"domain"</span>);</div><div class="line"></div><div class="line"><span class="keyword">var</span> emitter1 = <span class="keyword">new</span> EventEmitter();</div><div class="line"></div><div class="line"><span class="comment">// 创建域</span></div><div class="line"><span class="keyword">var</span> domain1 = domain.create();</div><div class="line"></div><div class="line">domain1.on(<span class="string">'error'</span>, <span class="function"><span class="keyword">function</span>(<span class="params">err</span>)</span>&#123;</div><div class="line">   <span class="built_in">console</span>.log(<span class="string">"domain1 处理这个错误 ("</span>+err.message+<span class="string">")"</span>);</div><div class="line">&#125;);</div><div class="line"></div><div class="line"><span class="comment">// 显式绑定</span></div><div class="line">domain1.add(emitter1);</div><div class="line"></div><div class="line">emitter1.on(<span class="string">'error'</span>,<span class="function"><span class="keyword">function</span>(<span class="params">err</span>)</span>&#123;</div><div class="line">   <span class="built_in">console</span>.log(<span class="string">"监听器处理此错误 ("</span>+err.message+<span class="string">")"</span>);</div><div class="line">&#125;);</div><div class="line"></div><div class="line">emitter1.emit(<span class="string">'error'</span>,<span class="keyword">new</span> <span class="built_in">Error</span>(<span class="string">'通过监听器来处理'</span>));</div><div class="line"></div><div class="line">emitter1.removeAllListeners(<span class="string">'error'</span>);</div><div class="line"></div><div class="line">emitter1.emit(<span class="string">'error'</span>,<span class="keyword">new</span> <span class="built_in">Error</span>(<span class="string">'通过 domain1 处理'</span>));</div><div class="line"></div><div class="line"><span class="keyword">var</span> domain2 = domain.create();</div><div class="line"></div><div class="line">domain2.on(<span class="string">'error'</span>, <span class="function"><span class="keyword">function</span>(<span class="params">err</span>)</span>&#123;</div><div class="line">   <span class="built_in">console</span>.log(<span class="string">"domain2 处理这个错误 ("</span>+err.message+<span class="string">")"</span>);</div><div class="line">&#125;);</div><div class="line"></div><div class="line"><span class="comment">// 隐式绑定</span></div><div class="line">domain2.run(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</div><div class="line">   <span class="keyword">var</span> emitter2 = <span class="keyword">new</span> EventEmitter();</div><div class="line">   emitter2.emit(<span class="string">'error'</span>,<span class="keyword">new</span> <span class="built_in">Error</span>(<span class="string">'通过 domain2 处理'</span>));   </div><div class="line">&#125;);</div><div class="line"></div><div class="line"></div><div class="line">domain1.remove(emitter1);</div><div class="line">emitter1.emit(<span class="string">'error'</span>, <span class="keyword">new</span> <span class="built_in">Error</span>(<span class="string">'转换为异常，系统将崩溃!'</span>));</div><div class="line"></div><div class="line"><span class="comment">// 运行命令行</span></div><div class="line">监听器处理此错误 (通过监听器来处理)</div><div class="line">domain1 处理这个错误 (通过 domain1 处理)</div><div class="line">domain2 处理这个错误 (通过 domain2 处理)</div><div class="line"></div><div class="line">events.js:<span class="number">72</span></div><div class="line">        <span class="keyword">throw</span> er; <span class="comment">// Unhandled 'error' event</span></div><div class="line">              ^</div><div class="line"><span class="built_in">Error</span>: 转换为异常，系统将崩溃!</div><div class="line">    at <span class="built_in">Object</span>.&lt;anonymous&gt; (<span class="regexp">/www/</span>node/main.js:<span class="number">40</span>:<span class="number">24</span>)</div><div class="line">    at Module._compile (<span class="built_in">module</span>.js:<span class="number">456</span>:<span class="number">26</span>)</div><div class="line">    at <span class="built_in">Object</span>.Module._extensions..js (<span class="built_in">module</span>.js:<span class="number">474</span>:<span class="number">10</span>)</div><div class="line">    at Module.load (<span class="built_in">module</span>.js:<span class="number">356</span>:<span class="number">32</span>)</div><div class="line">    at <span class="built_in">Function</span>.Module._load (<span class="built_in">module</span>.js:<span class="number">312</span>:<span class="number">12</span>)</div><div class="line">    at <span class="built_in">Function</span>.Module.runMain (<span class="built_in">module</span>.js:<span class="number">497</span>:<span class="number">10</span>)</div><div class="line">    at startup (node.js:<span class="number">119</span>:<span class="number">16</span>)</div><div class="line">    at node.js:<span class="number">929</span>:<span class="number">3</span></div></pre></td></tr></table></figure>
<h1 id="Web-模块"><a href="#Web-模块" class="headerlink" title="Web 模块"></a>Web 模块</h1><p>Web服务器一般指网站服务器，是指驻留于因特网上某种类型计算机的程序，Web服务器的基本功能就是提供Web信息浏览服务</p>
<p>只需支持HTTP协议、HTML文档格式及URL，与客户端的网络浏览器配合</p>
<p>web 服务器支持服务端的脚本语言（php、python、ruby）等，并通过脚本语言从数据库获取数据，将结果返回给客户端浏览器</p>
<p>目前最主流的三个Web服务器是Apache、Nginx、IIS</p>
<h2 id="Web-应用架构"><a href="#Web-应用架构" class="headerlink" title="Web 应用架构"></a>Web 应用架构</h2><ul>
<li>Client - 客户端，一般指浏览器，浏览器可以通过 HTTP 协议向服务器请求数据</li>
<li>Server - 服务端，一般指 Web 服务器，可以接收客户端请求，并向客户端发送响应数据</li>
<li>Business - 业务层， 通过 Web 服务器处理应用程序，如与数据库交互，逻辑运算，调用外部程序等</li>
<li>Data - 数据层，一般由数据库组成</li>
</ul>
<h2 id="Node-创建-Web-服务器"><a href="#Node-创建-Web-服务器" class="headerlink" title="Node 创建 Web 服务器"></a>Node 创建 Web 服务器</h2><p>Node.js 提供了 http 模块，http 模块主要用于搭建 HTTP 服务端和客户端，使用 HTTP 服务器或客户端功能必须调用 http 模块</p>
<p>var http = require(‘http’);</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// 最基本的 HTTP 服务器架构(使用 8080 端口)</span></div><div class="line"><span class="comment">// 创建 server.js</span></div><div class="line"></div><div class="line"><span class="keyword">var</span> http = <span class="built_in">require</span>(<span class="string">'http'</span>);</div><div class="line"><span class="keyword">var</span> fs = <span class="built_in">require</span>(<span class="string">'fs'</span>);</div><div class="line"><span class="keyword">var</span> url = <span class="built_in">require</span>(<span class="string">'url'</span>);</div><div class="line"> </div><div class="line"><span class="comment">// 创建服务器</span></div><div class="line">http.createServer( <span class="function"><span class="keyword">function</span> (<span class="params">request, response</span>) </span>&#123;  </div><div class="line">   <span class="comment">// 解析请求，包括文件名</span></div><div class="line">   <span class="keyword">var</span> pathname = url.parse(request.url).pathname;</div><div class="line">   </div><div class="line">   <span class="comment">// 输出请求的文件名</span></div><div class="line">   <span class="built_in">console</span>.log(<span class="string">"Request for "</span> + pathname + <span class="string">" received."</span>);</div><div class="line">   </div><div class="line">   <span class="comment">// 从文件系统中读取请求的文件内容</span></div><div class="line">   fs.readFile(pathname.substr(<span class="number">1</span>), <span class="function"><span class="keyword">function</span> (<span class="params">err, data</span>) </span>&#123;</div><div class="line">      <span class="keyword">if</span> (err) &#123;</div><div class="line">         <span class="built_in">console</span>.log(err);</div><div class="line">         <span class="comment">// HTTP 状态码: 404 : NOT FOUND</span></div><div class="line">         <span class="comment">// Content Type: text/plain</span></div><div class="line">         response.writeHead(<span class="number">404</span>, &#123;<span class="string">'Content-Type'</span>: <span class="string">'text/html'</span>&#125;);</div><div class="line">      &#125;<span class="keyword">else</span>&#123;             </div><div class="line">         <span class="comment">// HTTP 状态码: 200 : OK</span></div><div class="line">         <span class="comment">// Content Type: text/plain</span></div><div class="line">         response.writeHead(<span class="number">200</span>, &#123;<span class="string">'Content-Type'</span>: <span class="string">'text/html'</span>&#125;);    </div><div class="line">         </div><div class="line">         <span class="comment">// 响应文件内容</span></div><div class="line">         response.write(data.toString());        </div><div class="line">      &#125;</div><div class="line">      <span class="comment">//  发送响应数据</span></div><div class="line">      response.end();</div><div class="line">   &#125;);   </div><div class="line">&#125;).listen(<span class="number">8080</span>);</div><div class="line"> </div><div class="line"><span class="comment">// 控制台会输出以下信息</span></div><div class="line"><span class="built_in">console</span>.log(<span class="string">'Server running at http://127.0.0.1:8080/'</span>);</div><div class="line"></div><div class="line"><span class="comment">// 创建一个 index.html</span></div><div class="line">&lt;!DOCTYPE html&gt;</div><div class="line"><span class="xml"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span></div><div class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">"utf-8"</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">title</span>&gt;</span>菜鸟教程(runoob.com)<span class="tag">&lt;/<span class="name">title</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">h1</span>&gt;</span>我的第一个标题<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">p</span>&gt;</span>我的第一个段落。<span class="tag">&lt;/<span class="name">p</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></div><div class="line"></div><div class="line">// 运行命令行</div><div class="line">node server.js</div><div class="line">Server running at http://127.0.0.1:8080/</div></pre></td></tr></table></figure>
<p>打开地址：<a href="http://127.0.0.1:8080/index.html" target="_blank" rel="external">http://127.0.0.1:8080/index.html</a></p>
<figure class="highlight arduino"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// 执行 server.js 的控制台输出信息</span></div><div class="line"><span class="built_in">Server</span> <span class="built_in">running</span> at http:<span class="comment">//127.0.0.1:8080/</span></div><div class="line">Request <span class="built_in">for</span> /index.html received.     #  客户端请求信息</div></pre></td></tr></table></figure>
<h2 id="Node-创建-Web-客户端"><a href="#Node-创建-Web-客户端" class="headerlink" title="Node 创建 Web 客户端"></a>Node 创建 Web 客户端</h2><p>Node 创建 Web 客户端需要引入 http 模块</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// 创建client.js</span></div><div class="line"><span class="keyword">var</span> http = <span class="built_in">require</span>(<span class="string">'http'</span>);</div><div class="line"> </div><div class="line"><span class="comment">// 用于请求的选项</span></div><div class="line"><span class="keyword">var</span> options = &#123;</div><div class="line">   <span class="attr">host</span>: <span class="string">'localhost'</span>,</div><div class="line">   <span class="attr">port</span>: <span class="string">'8080'</span>,</div><div class="line">   <span class="attr">path</span>: <span class="string">'/index.html'</span>  </div><div class="line">&#125;;</div><div class="line"> </div><div class="line"><span class="comment">// 处理响应的回调函数</span></div><div class="line"><span class="keyword">var</span> callback = <span class="function"><span class="keyword">function</span>(<span class="params">response</span>)</span>&#123;</div><div class="line">   <span class="comment">// 不断更新数据</span></div><div class="line">   <span class="keyword">var</span> body = <span class="string">''</span>;</div><div class="line">   response.on(<span class="string">'data'</span>, <span class="function"><span class="keyword">function</span>(<span class="params">data</span>) </span>&#123;</div><div class="line">      body += data;</div><div class="line">   &#125;);</div><div class="line">   </div><div class="line">   response.on(<span class="string">'end'</span>, <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</div><div class="line">      <span class="comment">// 数据接收完成</span></div><div class="line">      <span class="built_in">console</span>.log(body);</div><div class="line">   &#125;);</div><div class="line">&#125;</div><div class="line"><span class="comment">// 向服务端发送请求</span></div><div class="line"><span class="keyword">var</span> req = http.request(options, callback);</div><div class="line">req.end();</div><div class="line"></div><div class="line"><span class="comment">// 运行命令行</span></div><div class="line">node  client.js </div><div class="line">&lt;!DOCTYPE html&gt;</div><div class="line"><span class="xml"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span></div><div class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">"utf-8"</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">title</span>&gt;</span>菜鸟教程(runoob.com)<span class="tag">&lt;/<span class="name">title</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">h1</span>&gt;</span>我的第一个标题<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">p</span>&gt;</span>我的第一个段落。<span class="tag">&lt;/<span class="name">p</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></div><div class="line"></div><div class="line">// 执行 server.js 的控制台输出信息</div><div class="line">Server running at http://127.0.0.1:8080/</div><div class="line">Request for /index.html received.   # 客户端请求信息</div></pre></td></tr></table></figure>
<h1 id="RESTful-API"><a href="#RESTful-API" class="headerlink" title="RESTful API"></a>RESTful API</h1><p>REST即表述性状态传递</p>
<p>表述性状态转移是一组架构约束条件和原则。满足这些约束条件和原则的应用程序或设计就是RESTful</p>
<p>REST 通常使用 JSON 数据格式</p>
<p>REST 基本架构的四个方法</p>
<ul>
<li>GET - 用于获取数据</li>
<li>PUT - 用于更新或添加数据</li>
<li>DELETE - 用于删除数据</li>
<li>POST - 用于添加数据</li>
</ul>
<h2 id="RESTful-Web-Services"><a href="#RESTful-Web-Services" class="headerlink" title="RESTful Web Services"></a>RESTful Web Services</h2><p>基于 REST 架构的 Web Services 即是 RESTful</p>
<p>由于轻量级以及通过 HTTP 直接传输数据的特性，Web 服务的 RESTful 方法已经成为最常见的替代方法</p>
<p>可以使用各种语言（比如 Java 程序、Perl、Ruby、Python、PHP 和 Javascript[包括 Ajax]）实现客户端</p>
<h2 id="创建-RESTful"><a href="#创建-RESTful" class="headerlink" title="创建 RESTful"></a>创建 RESTful</h2><p>创建一个 json 数据资源文件 users.json</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div></pre></td><td class="code"><pre><div class="line">&#123;</div><div class="line">   <span class="attr">"user1"</span> : &#123;</div><div class="line">      <span class="attr">"name"</span> : <span class="string">"mahesh"</span>,</div><div class="line">      <span class="attr">"password"</span> : <span class="string">"password1"</span>,</div><div class="line">      <span class="attr">"profession"</span> : <span class="string">"teacher"</span>,</div><div class="line">      <span class="attr">"id"</span>: <span class="number">1</span></div><div class="line">   &#125;,</div><div class="line">   <span class="attr">"user2"</span> : &#123;</div><div class="line">      <span class="attr">"name"</span> : <span class="string">"suresh"</span>,</div><div class="line">      <span class="attr">"password"</span> : <span class="string">"password2"</span>,</div><div class="line">      <span class="attr">"profession"</span> : <span class="string">"librarian"</span>,</div><div class="line">      <span class="attr">"id"</span>: <span class="number">2</span></div><div class="line">   &#125;,</div><div class="line">   <span class="attr">"user3"</span> : &#123;</div><div class="line">      <span class="attr">"name"</span> : <span class="string">"ramesh"</span>,</div><div class="line">      <span class="attr">"password"</span> : <span class="string">"password3"</span>,</div><div class="line">      <span class="attr">"profession"</span> : <span class="string">"clerk"</span>,</div><div class="line">      <span class="attr">"id"</span>: <span class="number">3</span></div><div class="line">   &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>基于以上数据，我们创建以下 RESTful API</p>
<table>
<thead>
<tr>
<th>序号</th>
<th>URI</th>
<th>HTTP方法</th>
<th>发送内容</th>
<th>结果</th>
</tr>
</thead>
<tbody>
<tr>
<td>1</td>
<td>listUsers</td>
<td>GET</td>
<td>空</td>
<td>显示所有用户列表</td>
</tr>
<tr>
<td>2</td>
<td>addUser</td>
<td>POST</td>
<td>JSON 字符串</td>
<td>添加新用户</td>
</tr>
<tr>
<td>3</td>
<td>deleteUser</td>
<td>DELETE</td>
<td>JSON 字符串</td>
<td>删除用户</td>
</tr>
<tr>
<td>4</td>
<td>:id</td>
<td>GET</td>
<td>空</td>
<td>显示用户详细信息</td>
</tr>
</tbody>
</table>
<h3 id="获取用户列表"><a href="#获取用户列表" class="headerlink" title="获取用户列表"></a>获取用户列表</h3><p>创建了 RESTful API listUsers，用于读取用户的信息列表</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// server.js</span></div><div class="line"><span class="keyword">var</span> express = <span class="built_in">require</span>(<span class="string">'express'</span>);</div><div class="line"><span class="keyword">var</span> app = express();</div><div class="line"><span class="keyword">var</span> fs = <span class="built_in">require</span>(<span class="string">"fs"</span>);</div><div class="line"></div><div class="line">app.get(<span class="string">'/listUsers'</span>, <span class="function"><span class="keyword">function</span> (<span class="params">req, res</span>) </span>&#123;</div><div class="line">   fs.readFile( __dirname + <span class="string">"/"</span> + <span class="string">"users.json"</span>, <span class="string">'utf8'</span>, <span class="function"><span class="keyword">function</span> (<span class="params">err, data</span>) </span>&#123;</div><div class="line">       <span class="built_in">console</span>.log( data );</div><div class="line">       res.end( data );</div><div class="line">   &#125;);</div><div class="line">&#125;)</div><div class="line"></div><div class="line"><span class="keyword">var</span> server = app.listen(<span class="number">8081</span>, <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</div><div class="line"></div><div class="line">  <span class="keyword">var</span> host = server.address().address</div><div class="line">  <span class="keyword">var</span> port = server.address().port</div><div class="line"></div><div class="line">  <span class="built_in">console</span>.log(<span class="string">"应用实例，访问地址为 http://%s:%s"</span>, host, port)</div><div class="line"></div><div class="line">&#125;)</div><div class="line"></div><div class="line"><span class="comment">// 运行命令行</span></div><div class="line">node server.js </div><div class="line">应用实例，访问地址为 http:<span class="comment">//0.0.0.0:8081</span></div><div class="line"></div><div class="line"><span class="comment">// 在浏览器中访问 http://127.0.0.1:8081/listUsers</span></div><div class="line">&#123;</div><div class="line">   <span class="string">"user1"</span> : &#123;</div><div class="line">      <span class="string">"name"</span> : <span class="string">"mahesh"</span>,</div><div class="line">      <span class="string">"password"</span> : <span class="string">"password1"</span>,</div><div class="line">      <span class="string">"profession"</span> : <span class="string">"teacher"</span>,</div><div class="line">      <span class="string">"id"</span>: <span class="number">1</span></div><div class="line">   &#125;,</div><div class="line">   <span class="string">"user2"</span> : &#123;</div><div class="line">      <span class="string">"name"</span> : <span class="string">"suresh"</span>,</div><div class="line">      <span class="string">"password"</span> : <span class="string">"password2"</span>,</div><div class="line">      <span class="string">"profession"</span> : <span class="string">"librarian"</span>,</div><div class="line">      <span class="string">"id"</span>: <span class="number">2</span></div><div class="line">   &#125;,</div><div class="line">   <span class="string">"user3"</span> : &#123;</div><div class="line">      <span class="string">"name"</span> : <span class="string">"ramesh"</span>,</div><div class="line">      <span class="string">"password"</span> : <span class="string">"password3"</span>,</div><div class="line">      <span class="string">"profession"</span> : <span class="string">"clerk"</span>,</div><div class="line">      <span class="string">"id"</span>: <span class="number">3</span></div><div class="line">   &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h3 id="添加用户"><a href="#添加用户" class="headerlink" title="添加用户"></a>添加用户</h3><p>创建了 RESTful API addUser， 用于添加新的用户数据</p>
<figure class="highlight qml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// server.js</span></div><div class="line"><span class="built_in">var</span> express = <span class="built_in">require</span>(<span class="string">'express'</span>);</div><div class="line"><span class="built_in">var</span> app = express();</div><div class="line"><span class="built_in">var</span> fs = <span class="built_in">require</span>(<span class="string">"fs"</span>);</div><div class="line"></div><div class="line"><span class="comment">//添加的新用户数据</span></div><div class="line"><span class="built_in">var</span> user = &#123;</div><div class="line">   <span class="string">"user4"</span> : &#123;</div><div class="line">      <span class="string">"name"</span> : <span class="string">"mohit"</span>,</div><div class="line">      <span class="string">"password"</span> : <span class="string">"password4"</span>,</div><div class="line">      <span class="string">"profession"</span> : <span class="string">"teacher"</span>,</div><div class="line">      <span class="string">"id"</span>: <span class="number">4</span></div><div class="line">   &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line">app.get(<span class="string">'/addUser'</span>, <span class="function"><span class="keyword">function</span> (<span class="params">req, res</span>) </span>&#123;</div><div class="line">   <span class="comment">// 读取已存在的数据</span></div><div class="line">   fs.readFile( __dirname + <span class="string">"/"</span> + <span class="string">"users.json"</span>, <span class="string">'utf8'</span>, <span class="function"><span class="keyword">function</span> (<span class="params">err, data</span>) </span>&#123;</div><div class="line">       data = <span class="built_in">JSON</span>.parse( data );</div><div class="line">       data[<span class="string">"user4"</span>] = user[<span class="string">"user4"</span>];</div><div class="line">       <span class="built_in">console</span>.log( data );</div><div class="line">       res.end( <span class="built_in">JSON</span>.stringify(data));</div><div class="line">   &#125;);</div><div class="line">&#125;)</div><div class="line"></div><div class="line"><span class="built_in">var</span> server = app.listen(<span class="number">8081</span>, <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</div><div class="line"></div><div class="line">  <span class="built_in">var</span> host = server.address().address</div><div class="line">  <span class="built_in">var</span> port = server.address().port</div><div class="line">  <span class="built_in">console</span>.log(<span class="string">"应用实例，访问地址为 http://%s:%s"</span>, host, port)</div><div class="line"></div><div class="line">&#125;)</div><div class="line"></div><div class="line"><span class="comment">// 运行命令行</span></div><div class="line">node server.js </div><div class="line">应用实例，访问地址为 <span class="attribute">http</span>:<span class="comment">//0.0.0.0:8081</span></div><div class="line"></div><div class="line"><span class="comment">// 在浏览器中访问 http://127.0.0.1:8081/addUser</span></div><div class="line">&#123; <span class="attribute">user1</span>:</div><div class="line">   &#123; <span class="attribute">name</span>: <span class="string">'mahesh'</span>,</div><div class="line">     <span class="attribute">password</span>: <span class="string">'password1'</span>,</div><div class="line">     <span class="attribute">profession</span>: <span class="string">'teacher'</span>,</div><div class="line">     <span class="attribute">id:</span><span class="string"> 1 &#125;,</span></div><div class="line">  user2:</div><div class="line">   &#123; <span class="attribute">name</span>: <span class="string">'suresh'</span>,</div><div class="line">     <span class="attribute">password</span>: <span class="string">'password2'</span>,</div><div class="line">     <span class="attribute">profession</span>: <span class="string">'librarian'</span>,</div><div class="line">     <span class="attribute">id:</span><span class="string"> 2 &#125;,</span></div><div class="line">  user3:</div><div class="line">   &#123; <span class="attribute">name</span>: <span class="string">'ramesh'</span>,</div><div class="line">     <span class="attribute">password</span>: <span class="string">'password3'</span>,</div><div class="line">     <span class="attribute">profession</span>: <span class="string">'clerk'</span>,</div><div class="line">     <span class="attribute">id:</span><span class="string"> 3 &#125;,</span></div><div class="line">  user4:</div><div class="line">   &#123; <span class="attribute">name</span>: <span class="string">'mohit'</span>,</div><div class="line">     <span class="attribute">password</span>: <span class="string">'password4'</span>,</div><div class="line">     <span class="attribute">profession</span>: <span class="string">'teacher'</span>,</div><div class="line">     <span class="attribute">id:</span><span class="string"> 4 &#125; </span></div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h3 id="显示用户详情"><a href="#显示用户详情" class="headerlink" title="显示用户详情"></a>显示用户详情</h3><p>创建了 RESTful API :id（用户id）， 用于读取指定用户的详细信息</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// server.js</span></div><div class="line"><span class="keyword">var</span> express = <span class="built_in">require</span>(<span class="string">'express'</span>);</div><div class="line"><span class="keyword">var</span> app = express();</div><div class="line"><span class="keyword">var</span> fs = <span class="built_in">require</span>(<span class="string">"fs"</span>);</div><div class="line"></div><div class="line">app.get(<span class="string">'/:id'</span>, <span class="function"><span class="keyword">function</span> (<span class="params">req, res</span>) </span>&#123;</div><div class="line">   <span class="comment">// 首先我们读取已存在的用户</span></div><div class="line">   fs.readFile( __dirname + <span class="string">"/"</span> + <span class="string">"users.json"</span>, <span class="string">'utf8'</span>, <span class="function"><span class="keyword">function</span> (<span class="params">err, data</span>) </span>&#123;</div><div class="line">       data = <span class="built_in">JSON</span>.parse( data );</div><div class="line">       <span class="keyword">var</span> user = data[<span class="string">"user"</span> + req.params.id] </div><div class="line">       <span class="built_in">console</span>.log( user );</div><div class="line">       res.end( <span class="built_in">JSON</span>.stringify(user));</div><div class="line">   &#125;);</div><div class="line">&#125;)</div><div class="line"></div><div class="line"><span class="keyword">var</span> server = app.listen(<span class="number">8081</span>, <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</div><div class="line"></div><div class="line">  <span class="keyword">var</span> host = server.address().address</div><div class="line">  <span class="keyword">var</span> port = server.address().port</div><div class="line">  <span class="built_in">console</span>.log(<span class="string">"应用实例，访问地址为 http://%s:%s"</span>, host, port)</div><div class="line"></div><div class="line">&#125;)</div><div class="line"></div><div class="line"><span class="comment">// 运行命令行</span></div><div class="line">node server.js </div><div class="line">应用实例，访问地址为 http:<span class="comment">//0.0.0.0:8081</span></div><div class="line"></div><div class="line"><span class="comment">// 在浏览器中访问 http://127.0.0.1:8081/2</span></div><div class="line">&#123;</div><div class="line">   <span class="string">"name"</span>:<span class="string">"suresh"</span>,</div><div class="line">   <span class="string">"password"</span>:<span class="string">"password2"</span>,</div><div class="line">   <span class="string">"profession"</span>:<span class="string">"librarian"</span>,</div><div class="line">   <span class="string">"id"</span>:<span class="number">2</span></div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h3 id="删除用户"><a href="#删除用户" class="headerlink" title="删除用户"></a>删除用户</h3><p>创建了 RESTful API deleteUser， 用于删除指定用户的详细信息</p>
<figure class="highlight qml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// server.js</span></div><div class="line"><span class="built_in">var</span> express = <span class="built_in">require</span>(<span class="string">'express'</span>);</div><div class="line"><span class="built_in">var</span> app = express();</div><div class="line"><span class="built_in">var</span> fs = <span class="built_in">require</span>(<span class="string">"fs"</span>);</div><div class="line"></div><div class="line"><span class="built_in">var</span> id = <span class="number">2</span>;</div><div class="line"></div><div class="line">app.get(<span class="string">'/deleteUser'</span>, <span class="function"><span class="keyword">function</span> (<span class="params">req, res</span>) </span>&#123;</div><div class="line"></div><div class="line">   <span class="comment">// First read existing users.</span></div><div class="line">   fs.readFile( __dirname + <span class="string">"/"</span> + <span class="string">"users.json"</span>, <span class="string">'utf8'</span>, <span class="function"><span class="keyword">function</span> (<span class="params">err, data</span>) </span>&#123;</div><div class="line">       data = <span class="built_in">JSON</span>.parse( data );</div><div class="line">       <span class="keyword">delete</span> data[<span class="string">"user"</span> + <span class="number">2</span>];</div><div class="line">       </div><div class="line">       <span class="built_in">console</span>.log( data );</div><div class="line">       res.end( <span class="built_in">JSON</span>.stringify(data));</div><div class="line">   &#125;);</div><div class="line">&#125;)</div><div class="line"></div><div class="line"><span class="built_in">var</span> server = app.listen(<span class="number">8081</span>, <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</div><div class="line"></div><div class="line">  <span class="built_in">var</span> host = server.address().address</div><div class="line">  <span class="built_in">var</span> port = server.address().port</div><div class="line">  <span class="built_in">console</span>.log(<span class="string">"应用实例，访问地址为 http://%s:%s"</span>, host, port)</div><div class="line"></div><div class="line">&#125;)</div><div class="line"></div><div class="line"><span class="comment">// 运行命令行</span></div><div class="line">node server.js </div><div class="line">应用实例，访问地址为 <span class="attribute">http</span>:<span class="comment">//0.0.0.0:8081</span></div><div class="line"></div><div class="line"><span class="comment">// 在浏览器中访问 http://127.0.0.1:8081/deleteUser</span></div><div class="line">&#123; <span class="attribute">user1</span>:</div><div class="line">   &#123; <span class="attribute">name</span>: <span class="string">'mahesh'</span>,</div><div class="line">     <span class="attribute">password</span>: <span class="string">'password1'</span>,</div><div class="line">     <span class="attribute">profession</span>: <span class="string">'teacher'</span>,</div><div class="line">     <span class="attribute">id:</span><span class="string"> 1 &#125;,</span></div><div class="line">  user3:</div><div class="line">   &#123; <span class="attribute">name</span>: <span class="string">'ramesh'</span>,</div><div class="line">     <span class="attribute">password</span>: <span class="string">'password3'</span>,</div><div class="line">     <span class="attribute">profession</span>: <span class="string">'clerk'</span>,</div><div class="line">     <span class="attribute">id:</span><span class="string"> 3 &#125; </span></div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h1 id="多进程"><a href="#多进程" class="headerlink" title="多进程"></a>多进程</h1><p>Node.js 是以单线程的模式运行的，但它使用的是事件驱动来处理并发</p>
<p>每个子进程总是带有三个流对象：child.stdin, child.stdout 和child.stderr</p>
<p>Node 提供了 child_process 模块来创建子进程,方法有</p>
<ul>
<li>exec - child_process.exec 使用子进程执行命令，缓存子进程的输出，并将子进程的输出以回调函数参数的形式返回</li>
<li>spawn - child_process.spawn 使用指定的命令行参数创建新进程</li>
<li>fork - child_process.fork 是 spawn()的特殊形式，用于在子进程中运行的模块，如 fork(‘./son.js’) 相当于 spawn(‘node’, [‘./son.js’])</li>
</ul>
<h2 id="exec-方法"><a href="#exec-方法" class="headerlink" title="exec() 方法"></a>exec() 方法</h2><p>child_process.exec 使用子进程执行命令，缓存子进程的输出，并将子进程的输出以回调函数参数的形式返回</p>
<p>exec() 方法返回最大的缓冲区，并等待进程结束，一次性返回缓冲区的内容</p>
<p>child_process.exec(command[, options], callback)</p>
<ul>
<li>command： 字符串， 将要运行的命令，参数使用空格隔开</li>
<li>options ：对象</li>
<li>callback ：回调函数，包含三个参数error, stdout 和 stderr</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// support.js</span></div><div class="line"><span class="built_in">console</span>.log(<span class="string">"进程 "</span> + process.argv[<span class="number">2</span>] + <span class="string">" 执行。"</span> );</div><div class="line"></div><div class="line"><span class="comment">// master.js</span></div><div class="line"><span class="keyword">const</span> fs = <span class="built_in">require</span>(<span class="string">'fs'</span>);</div><div class="line"><span class="keyword">const</span> child_process = <span class="built_in">require</span>(<span class="string">'child_process'</span>);</div><div class="line"> </div><div class="line"><span class="keyword">for</span>(<span class="keyword">var</span> i=<span class="number">0</span>; i&lt;<span class="number">3</span>; i++) &#123;</div><div class="line">    <span class="keyword">var</span> workerProcess = child_process.exec(<span class="string">'node support.js '</span>+i, <span class="function"><span class="keyword">function</span> (<span class="params">error, stdout, stderr</span>) </span>&#123;</div><div class="line">        <span class="keyword">if</span> (error) &#123;</div><div class="line">            <span class="built_in">console</span>.log(error.stack);</div><div class="line">            <span class="built_in">console</span>.log(<span class="string">'Error code: '</span>+error.code);</div><div class="line">            <span class="built_in">console</span>.log(<span class="string">'Signal received: '</span>+error.signal);</div><div class="line">        &#125;</div><div class="line">        <span class="built_in">console</span>.log(<span class="string">'stdout: '</span> + stdout);</div><div class="line">        <span class="built_in">console</span>.log(<span class="string">'stderr: '</span> + stderr);</div><div class="line">    &#125;);</div><div class="line"> </div><div class="line">    workerProcess.on(<span class="string">'exit'</span>, <span class="function"><span class="keyword">function</span> (<span class="params">code</span>) </span>&#123;</div><div class="line">        <span class="built_in">console</span>.log(<span class="string">'子进程已退出，退出码 '</span>+code);</div><div class="line">    &#125;);</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="comment">// 运行命令行</span></div><div class="line">node master.js </div><div class="line">子进程已退出，退出码 <span class="number">0</span></div><div class="line">stdout: 进程 <span class="number">1</span> 执行。</div><div class="line"></div><div class="line">stderr: </div><div class="line">子进程已退出，退出码 <span class="number">0</span></div><div class="line">stdout: 进程 <span class="number">0</span> 执行。</div><div class="line"></div><div class="line">stderr: </div><div class="line">子进程已退出，退出码 <span class="number">0</span></div><div class="line">stdout: 进程 <span class="number">2</span> 执行。</div><div class="line"></div><div class="line">stderr:</div></pre></td></tr></table></figure>
<h2 id="spawn-方法"><a href="#spawn-方法" class="headerlink" title="spawn() 方法"></a>spawn() 方法</h2><p>child_process.spawn 使用指定的命令行参数创建新进程</p>
<p>spawn() 方法返回流 (stdout &amp; stderr)，在进程返回大量数据时使用。进程一旦开始执行时 spawn() 就开始接收响应</p>
<p>child_process.spawn(command[, args][, options])</p>
<ul>
<li>command： 将要运行的命令</li>
<li>args： Array 字符串参数数组</li>
<li>options Object</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// support.js</span></div><div class="line"><span class="built_in">console</span>.log(<span class="string">"进程 "</span> + process.argv[<span class="number">2</span>] + <span class="string">" 执行。"</span> );</div><div class="line"></div><div class="line"><span class="comment">// master.js</span></div><div class="line"><span class="keyword">const</span> fs = <span class="built_in">require</span>(<span class="string">'fs'</span>);</div><div class="line"><span class="keyword">const</span> child_process = <span class="built_in">require</span>(<span class="string">'child_process'</span>);</div><div class="line"> </div><div class="line"><span class="keyword">for</span>(<span class="keyword">var</span> i=<span class="number">0</span>; i&lt;<span class="number">3</span>; i++) &#123;</div><div class="line">   <span class="keyword">var</span> workerProcess = child_process.spawn(<span class="string">'node'</span>, [<span class="string">'support.js'</span>, i]);</div><div class="line"> </div><div class="line">   workerProcess.stdout.on(<span class="string">'data'</span>, <span class="function"><span class="keyword">function</span> (<span class="params">data</span>) </span>&#123;</div><div class="line">      <span class="built_in">console</span>.log(<span class="string">'stdout: '</span> + data);</div><div class="line">   &#125;);</div><div class="line"> </div><div class="line">   workerProcess.stderr.on(<span class="string">'data'</span>, <span class="function"><span class="keyword">function</span> (<span class="params">data</span>) </span>&#123;</div><div class="line">      <span class="built_in">console</span>.log(<span class="string">'stderr: '</span> + data);</div><div class="line">   &#125;);</div><div class="line"> </div><div class="line">   workerProcess.on(<span class="string">'close'</span>, <span class="function"><span class="keyword">function</span> (<span class="params">code</span>) </span>&#123;</div><div class="line">      <span class="built_in">console</span>.log(<span class="string">'子进程已退出，退出码 '</span>+code);</div><div class="line">   &#125;);</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="comment">// 运行命令行</span></div><div class="line">node master.js stdout: 进程 <span class="number">0</span> 执行。</div><div class="line"></div><div class="line">子进程已退出，退出码 <span class="number">0</span></div><div class="line">stdout: 进程 <span class="number">1</span> 执行。</div><div class="line"></div><div class="line">子进程已退出，退出码 <span class="number">0</span></div><div class="line">stdout: 进程 <span class="number">2</span> 执行。</div><div class="line"></div><div class="line">子进程已退出，退出码 <span class="number">0</span></div></pre></td></tr></table></figure>
<h2 id="fork-方法"><a href="#fork-方法" class="headerlink" title="fork 方法"></a>fork 方法</h2><p>child_process.fork 是 spawn() 方法的特殊形式，用于创建进程</p>
<p>返回的对象除了拥有ChildProcess实例的所有方法，还有一个内建的通信信道</p>
<p>child_process.fork(modulePath[, args][, options])</p>
<ul>
<li>modulePath： String，将要在子进程中运行的模块</li>
<li>args： Array 字符串参数数组</li>
<li>options：Object</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// support.js</span></div><div class="line"><span class="built_in">console</span>.log(<span class="string">"进程 "</span> + process.argv[<span class="number">2</span>] + <span class="string">" 执行。"</span> );</div><div class="line"></div><div class="line"><span class="comment">// master.js</span></div><div class="line"><span class="keyword">const</span> fs = <span class="built_in">require</span>(<span class="string">'fs'</span>);</div><div class="line"><span class="keyword">const</span> child_process = <span class="built_in">require</span>(<span class="string">'child_process'</span>);</div><div class="line"> </div><div class="line"><span class="keyword">for</span>(<span class="keyword">var</span> i=<span class="number">0</span>; i&lt;<span class="number">3</span>; i++) &#123;</div><div class="line">   <span class="keyword">var</span> worker_process = child_process.fork(<span class="string">"support.js"</span>, [i]);    </div><div class="line"> </div><div class="line">   worker_process.on(<span class="string">'close'</span>, <span class="function"><span class="keyword">function</span> (<span class="params">code</span>) </span>&#123;</div><div class="line">      <span class="built_in">console</span>.log(<span class="string">'子进程已退出，退出码 '</span> + code);</div><div class="line">   &#125;);</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="comment">// 运行命令行</span></div><div class="line">node master.js </div><div class="line">进程 <span class="number">0</span> 执行。</div><div class="line">子进程已退出，退出码 <span class="number">0</span></div><div class="line">进程 <span class="number">1</span> 执行。</div><div class="line">子进程已退出，退出码 <span class="number">0</span></div><div class="line">进程 <span class="number">2</span> 执行。</div><div class="line">子进程已退出，退出码 <span class="number">0</span></div></pre></td></tr></table></figure>
<h1 id="JXcore打包"><a href="#JXcore打包" class="headerlink" title="JXcore打包"></a>JXcore打包</h1><p>JXcore 是一个支持多线程的 Node.js 发行版本</p>
<h2 id="JXcore安装"><a href="#JXcore安装" class="headerlink" title="JXcore安装"></a>JXcore安装</h2><p>下载 JXcore 安装包，并解压，在解压的的目录下提供了 jx 二进制文件命令</p>
<h2 id="包代码"><a href="#包代码" class="headerlink" title="包代码"></a>包代码</h2><p>Node.js 项目包含以下几个文件，其中 index.js 是主文件</p>
<figure class="highlight tap"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">drwxr-xr-x <span class="number"> 2 </span>root root <span class="number"> 4096 </span>Nov<span class="number"> 13 </span>12:42 images</div><div class="line">-rwxr-xr-x <span class="number"> 1 </span>root root<span class="number"> 30457 </span>Mar <span class="number"> 6 </span>12:19 index.htm</div><div class="line">-rwxr-xr-x <span class="number"> 1 </span>root root<span class="number"> 30452 </span>Mar <span class="number"> 1 </span>12:54 index.js</div><div class="line">drwxr-xr-x<span class="number"> 23 </span>root root <span class="number"> 4096 </span>Jan<span class="number"> 15 </span>03:48 node_modules</div><div class="line">drwxr-xr-x <span class="number"> 2 </span>root root <span class="number"> 4096 </span>Mar<span class="number"> 21 </span>06:10 scripts</div><div class="line">drwxr-xr-x <span class="number"> 2 </span>root root <span class="number"> 4096 </span>Feb<span class="number"> 15 </span>11:56 style</div></pre></td></tr></table></figure>
<p>使用 jx 命令打包以上项目，并指定 index.js 为 Node.js 项目的主文件</p>
<figure class="highlight ada"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">jx <span class="keyword">package</span> <span class="title">index.js index</span></div></pre></td></tr></table></figure>
<p>命令执行成功，会生成以下两个文件</p>
<ul>
<li>index.jxp 这是一个中间件文件，包含了需要编译的完整项目信息</li>
<li>index.jx 这是一个完整包信息的二进制文件，可运行在客户端上</li>
</ul>
<h2 id="载入-JX-文件"><a href="#载入-JX-文件" class="headerlink" title="载入 JX 文件"></a>载入 JX 文件</h2><p>Node.js 的项目运行</p>
<figure class="highlight crmsh"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">node</span> <span class="title">index</span>.js command_line_arguments</div></pre></td></tr></table></figure>
<p>使用 JXcore 编译后，我们可以使用以下命令来执行生成的 jx 二进制文件</p>
<figure class="highlight mipsasm"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">jx </span>index.<span class="keyword">jx </span>command_line_arguments</div></pre></td></tr></table></figure>
<h1 id="连接-MySQL"><a href="#连接-MySQL" class="headerlink" title="连接 MySQL"></a>连接 MySQL</h1><p>略</p>
<h1 id="连接-MongoDB"><a href="#连接-MongoDB" class="headerlink" title="连接 MongoDB"></a>连接 MongoDB</h1><p>略</p>

      
       <hr><span style="font-style: italic;color: gray;"> 转载请注明来源，欢迎对文章中的引用来源进行考证，欢迎指出任何有错误或不够清晰的表达。可以在下面评论区评论，也可以邮件至 jaytp@qq.com </span>
    </div>
</article>


<p>
    <a href="javascript:void(0)" class="dashang" onclick="dashangToggle()">赏</a>
</p>


<div class="article_copyright">
    <p><span class="copy-title">文章标题:</span>Node.js基础</p>
    
    <p><span class="copy-title">本文作者:</span><a href="javascript:void(0)" title="ZhangYang">ZhangYang</a></p>
    <p><span class="copy-title">发布时间:</span>2018-07-14, 23:16:41</p>
    <p><span class="copy-title">最后更新:</span>2018-10-10, 21:03:36</p>
    <span class="copy-title">原始链接:</span><a class="post-url" href="/2018/07/14/2018.7.14/" title="Node.js基础">http://yoursite.com/2018/07/14/2018.7.14/</a>
    <p>
        <span class="copy-title">版权声明:</span><i class="fa fa-creative-commons"></i> <a rel="license" href="http://creativecommons.org/licenses/by-nc-sa/4.0/" title="CC BY-NC-SA 4.0 International" target = "_blank">"署名-非商用-相同方式共享 4.0"</a> 转载请保留原文链接及作者。
    </p>
</div>





    




    </div>
    <div class="copyright">
        <p class="footer-entry">©2016-2019 Yelog</p>
<p class="footer-entry">Built with <a href="https://hexo.io/" target="_blank">Hexo</a> and <a href="https://github.com/yelog/hexo-theme-3-hexo" target="_blank">3-hexo</a> theme</p>

    </div>
    <div class="full-toc">
        <button class="full"><span class="min "></span></button>
<button class="post-toc-menu"><span class="post-toc-menu-icons"></span></button>
<div class="post-toc"><span class="post-toc-title">目录</span>
    <div class="post-toc-content">

    </div>
</div>
<a class="" id="rocket" href="javascript:void(0)"></a>
    </div>
</div>
<div class="acParent"></div>

<div class="hide_box" onclick="dashangToggle()"></div>
<div class="shang_box">
    <a class="shang_close" href="javascript:void(0)" onclick="dashangToggle()">×</a>
    <div class="shang_tit">
        <p>喜欢就点赞,疼爱就打赏</p>
    </div>
    <div class="shang_payimg">
        <div class="pay_img">
            <img src="/img/alipay.jpg" class="alipay" title="扫码支持">
            <img src="/img/weixin.jpg" class="weixin" title="扫码支持">
        </div>
    </div>
    <div class="shang_payselect">
        <span><label><input type="radio" name="pay" checked value="alipay">支付宝</label></span><span><label><input type="radio" name="pay" value="weixin">微信</label></span>
    </div>
</div>


</body>
<script src="/js/jquery.pjax.js?v=1.0.1" ></script>

<script src="/js/script.js?v=1.0.1" ></script>
<script>
    var img_resize = 'default';
    /*作者、标签的自动补全*/
    $(function () {
        $('.search').AutoComplete({
            'data': ['#学习方法','#个人总结','#JavaScript','#网页性能','#CSS','#MVC','#Redux','#PHP','#英语','#MySQL','#React Router','#React','#angular','#bootstrap','#算法','#vim','#linux','#git','#HTTP','#ES6','#HTML','#CMD','#AMD','#Common.js','#require.js','#r.js','#node.js','#设计模式','#响应式','#媒体查询','#栅格系统','#Vue','#面向对象','#npm','#npmscript','#gulp','#webpack','#flex布局','#php','#xmapp','#前端职责','#ajax','#json','#jsonp','#Handlerbars.js','#模板引擎','#柯里化','#Express','#Node.js','#Promise','#CacheControl','#MD5','#Cookie','#Session','#Canvas',],
            'itemHeight': 20,
            'width': 418
        }).AutoComplete('show');
    })
    function initArticle() {
        /*渲染对应的表格样式*/
        
            $(".post .pjax table").addClass("green_title");
        

        /*渲染打赏样式*/
        
        $("input[name=pay]").on("click", function () {
            if($("input[name=pay]:checked").val()=="weixin"){
                $(".shang_box .shang_payimg .pay_img").addClass("weixin_img");
            } else {
                $(".shang_box .shang_payimg .pay_img").removeClass("weixin_img");
            }
        })
        

        /*高亮代码块行号*/
        
        $('pre code').each(function(){
            var lines = $(this).text().split('\n').length - 1, widther='';
            if (lines>99) {
                widther = 'widther'
            }
            var $numbering = $('<ul/>').addClass('pre-numbering ' + widther).attr("unselectable","on");
            $(this).addClass('has-numbering ' + widther)
                    .parent()
                    .append($numbering);
            for(var i=1;i<=lines;i++){
                $numbering.append($('<li/>').text(i));
            }
        });
        

        /*访问数量*/
        
        $.getScript("//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js");
        

        /*代码高亮，行号对齐*/
        $('.pre-numbering').css('line-height',$('.has-numbering').css('line-height'));

        
    }

    /*打赏页面隐藏与展示*/
    
    function dashangToggle() {
        $(".shang_box").fadeToggle();
        $(".hide_box").fadeToggle();
    }
    

</script>

<!--加入行号的高亮代码块样式-->

<style>
    pre{
        position: relative;
        margin-bottom: 24px;
        border-radius: 10px;
        border: 1px solid #e2dede;
        background: #FFF;
        overflow: hidden;
    }
    code.has-numbering{
        margin-left: 30px;
    }
    code.has-numbering.widther{
        margin-left: 35px;
    }
    .pre-numbering{
        margin: 0px;
        position: absolute;
        top: 0;
        left: 0;
        width: 20px;
        padding: 0.5em 3px 0.7em 5px;
        border-right: 1px solid #C3CCD0;
        text-align: right;
        color: #AAA;
        background-color: #fafafa;
    }
    .pre-numbering.widther {
        width: 35px;
    }
</style>

<!--自定义样式设置-->
<style>
    
    
    .nav {
        width: 542px;
    }
    .nav.fullscreen {
        margin-left: -542px;
    }
    .nav-left {
        width: 120px;
    }
    
    
    @media screen and (max-width: 1468px) {
        .nav {
            width: 492px;
        }
        .nav.fullscreen {
            margin-left: -492px;
        }
        .nav-left {
            width: 100px;
        }
    }
    
    
    @media screen and (max-width: 1024px) {
        .nav {
            width: 492px;
            margin-left: -492px
        }
        .nav.fullscreen {
            margin-left: 0;
        }
        .nav .hide-list.fullscreen {
            left: 492px
        }
    }
    
    @media screen and (max-width: 426px) {
        .nav {
            width: 100%;
        }
        .nav-left {
            width: 100%;
        }
    }
    
    
    .nav-right .title-list nav a .post-title, .nav-right .title-list #local-search-result a .post-title {
        color: #383636;
    }
    
    
    .nav-right .title-list nav a .post-date, .nav-right .title-list #local-search-result a .post-date {
        color: #5e5e5f;
    }
    
    
    .nav-right nav a.hover, #local-search-result a.hover{
        background-color: #e2e0e0;
    }
    
    

    /*列表样式*/
    
    .post .pjax article .article-entry>ol, .post .pjax article .article-entry>ul, .post .pjax article>ol, .post .pjax article>ul{
        border: #e2dede solid 1px;
        border-radius: 10px;
        padding: 10px 32px 10px 56px;
    }
    .post .pjax article .article-entry li>ol, .post .pjax article .article-entry li>ul,.post .pjax article li>ol, .post .pjax article li>ul{
        padding-top: 5px;
        padding-bottom: 5px;
    }
    .post .pjax article .article-entry>ol>li, .post .pjax article .article-entry>ul>li,.post .pjax article>ol>li, .post .pjax article>ul>li{
        margin-bottom: auto;
        margin-left: auto;
    }
    .post .pjax article .article-entry li>ol>li, .post .pjax article .article-entry li>ul>li,.post .pjax article li>ol>li, .post .pjax article li>ul>li{
        margin-bottom: auto;
        margin-left: auto;
    }
    

    /* 背景图样式 */
    
    


    /*引用块样式*/
    

    /*文章列表背景图*/
    
    .nav-right:before {
        content: ' ';
        display: block;
        position: absolute;
        left: 0;
        top: 0;
        width: 100%;
        height: 100%;
        opacity: 0.3;
        background: url("https://i.loli.net/2019/07/22/5d3521411f3f169375.png");
        background-repeat: no-repeat;
        background-position: 50% 0;
        -ms-background-size: cover;
        -o-background-size: cover;
        -moz-background-size: cover;
        -webkit-background-size: cover;
        background-size: cover;
    }
    

    
</style>







</html>
